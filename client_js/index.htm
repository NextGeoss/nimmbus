<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title id="head_title">NiMMbus login</title>
<!--script src="//ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script-->

<link href="favicon.ico" rel="shortcut icon" type="image/x-icon">
<link rel="stylesheet" href="nimmbus.css">

<script language="JavaScript" src="xml.js"></script>
<script language="JavaScript" src="owc_atom.js"></script>
<script language="JavaScript" src="wps_iso_guf.js"></script>
<script language="JavaScript" src="guf_locale.js"></script>

<script language="JavaScript" src="Nmmblang.js"></script>

<script language="JavaScript" src="hello.all.min.js"></script>
<!-- https://adodson.com/hello.js/modules#hellojs-already-has-you-connected -->
<!--script language="JavaScript" src="google.js"></script-->
<script language="JavaScript" src="landsense.js"></script>
<script language="JavaScript" src="nextgeoss.js"></script>

<script>
<!--

//var ServersNB=["http://localhost/cgi-bin/server1/nimmbus.cgi","http://localhost/cgi-bin/server2/nimmbus.cgi"];
var ServersNB=["https://www.opengis.uab.cat/cgi-bin/nimmbus/nimmbus.cgi"];
var LastServerNB=0;


https://stackoverflow.com/questions/13356493/decode-utf-8-with-javascript
/*function encode_utf8(s) {
  return unescape(encodeURIComponent(s));
}*/

function decode_utf8(s) {
  return decodeURIComponent(escape(s));
}

//Després de intentar fer servir l'objecte link() sense exit he hagut de fer això.
//Returns the hostname and port number of a URL
function DonaHost(s)
{
var pos_barrabarra, pos_barra;
		
	if (-1!=(pos_barrabarra=s.indexOf("//")))
	{
		s2=s.substring(pos_barrabarra+2,s.length);
		if (-1!=(pos_barra=s2.indexOf("/")))
			return s2.substring(0,pos_barra);
		return s2;
	}
	else
	{
		if (-1!=(pos_barra=s.indexOf("/")))
			return s.substring(0,pos_barra);		
		return s;
	}
}
		
//Returns the protocol, hostname and port number of a URL
function DonaHrefOrigin(s)
	{
var pos_barrabarra, pos_barra;
		
	if (-1!=(pos_barrabarra=s.indexOf("//")))
	{
		s2=s.substring(pos_barrabarra+2,s.length);
		if (-1!=(pos_barra=s2.indexOf("/")))
			return s.substring(0,pos_barrabarra+2+pos_barra);
		return s;
	}
	else
	{
		if (-1!=(pos_barra=s.indexOf("/")))
			return s.substring(0,pos_barra);	
		return s;
}
}

//Returns the protocol of a URL
function DonaProtocol(s)
{
var pos_barrabarra;
		
	if (-1!=(pos_barrabarra=s.indexOf("//")))
		return s.substring(0,pos_barrabarra);
	return "";
}

function ConfirmExit()
{
	return DonaCadenaJSON(Msg_Exit_NiMMbus_Question);
}

// Inspirat en https://www.webdesignerdepot.com/2013/03/how-to-manage-the-back-button-with-javascript/
function GoBackOnePage()
{
	if (location.hash.length > 0)
		ChangePannel(location.hash.replace('#',''), false);
	else
		SurtDeNimmbus();
}
window.onhashchange = GoBackOnePage;

function RevisaCrossSserverServersNB(servers)
{
var s_host; 
	for (var i=0; i<servers.length; i++)
	{
		s_host=DonaHost(servers[i]);		
		if (s_host.toLowerCase()=="localhost" && location.host.toLowerCase()!="localhost")
		{
			alert("Error en pujar la versió als servidors. ServersNB[] encara diu \"localhost\"!");
			break;
		}

		s_host=DonaHrefOrigin(servers[i]);
		if (s_host.toLowerCase()!=location.origin.toLowerCase())
		{
			//Canvio l'arrel del servidor local per l'arrel de la plana del navegador per estar segur que l'ajax funcionarà sense "cross server vulnerability".
			//var pos_host=(-1!=servers[i].indexOf("//")) ? servers[i].indexOf("//")+2 : 0;
			//servers[i]=servers[i].substring(0,pos_host)+location.host+servers[i].substring(pos_host+s_host.length, servers[i].length);

			//Canvio l'arrel de la plana del navegador per l'arrel del servidor local, per estar segur que l'ajax funcionarà sense "cross server vulnerability" i que els servidors d'autentificació rebran el nom de domini que tenen registrat (assumint que servers està bé).
			location.replace(s_host+location.href.substring(location.origin.length, location.href.length));
		}
	}
	if (location.host.toLowerCase()=="localhost")
	{
		document.getElementById("sso-debug-button").style.display="inline";
		document.getElementById("sso-debug-button").disabled=false;
	}
}

/*
function RevisaProtocolServersNB(servers)
{
var s_protocol, pos_protocol;
	
	//En aquest cas mirem només el primer perquè haurien de ser tots iguals i perquè sovint això està només a un servidor
	//Volem mirar que el protocol de la plana amb el protocol del servidor i, si no és igual, forçar el del servidor
	//(i.e. si em demanen http:// i és un https:// el canvio
	
	s_protocol=DonaProtocol(servers[0]);
	
	if (s_protocol.toLowerCase()!=location.protocol.toLowerCase())
	{
		//Canvio l'indicador de protocol de la plana per la que té el servidor
		pos_protocol=(-1!=location.href.indexOf("//")) ? location.href.indexOf("//")+2 : 0;		
		location.replace(s_protocol+"//"+location.href.substring(pos_protocol,location.href.length));
		//Canvio l'arrel del servidor local per l'arrel de la plana del navegador per estar segur que l'ajax funcionarà sense "cross server vulnerability".
		pos_host=(-1!=servers[i].indexOf("//")) ? servers[i].indexOf("//")+2 : 0;
		servers[i]=servers[i].substring(0,pos_host)+location.host+servers[i].substring(pos_host+s_host.length, servers[i].length);

	}
}

RevisaProtocolServersNB(ServersNB);*/

//From: http://www.technicaladvices.com/2012/07/16/preventing-backspace-from-navigating-back-in-all-the-browsers/
document.onkeydown = function (event) 
{
	
	if (!event) { /* This will happen in IE */
		event = window.event;
	}
		
	var keyCode = event.keyCode;
	
	if (keyCode == 8 &&
		((event.target || event.srcElement).tagName != "TEXTAREA") && 
		((event.target || event.srcElement).tagName != "INPUT")) { 
		
		if (navigator.userAgent.toLowerCase().indexOf("msie") == -1) {
			event.stopPropagation();
		} else {
			event.returnValue = false;
		}
		
		return false;
	}
};	

function UpdateLastServer()
{
	LastServerNB++;
	if (LastServerNB>=ServersNB.length)
		LastServerNB=0;
}

function DonaCadenaCodelistDeSelect(selector)
{
	if (selector.selectedIndex!=-1)
		return selector.options[selector.selectedIndex].value;
	else
		return "";
}

function DonaCadenaCodelistDeRadio(radio)
{
	for (var i=0; i<radio.length; i++)
	{
		if (radio[i].checked)
			return radio[i].value;
	}
	return "";
}


function SeleccionaSelectDesDeValor(selector, valor)
{
	if (valor)
	{
		for (var i=0; i<selector.length; i++)
		{
			if (selector.options[i].value==valor)
			{
				selector.selectedIndex=i;
				return;
			}					
		}
	} 
}

function SeleccionaRadioDesDeValor(radio, valor)
{
	if (valor)
	{
		for (var i=0; i<radio.length; i++)
			radio[i].checked=(radio[i].value==valor) ? true : false;
}
	else
	{
		for (var i=0; i<radio.length; i++)
			radio[i].checked=false;
}
}

function DonaCadenaIdNoPotSerBuit(id)
{
	return document.getElementById(id).innerHTML + " "+ DonaCadenaJSON(Msg_cannot_be_blank);
}


// Funció inspirada en una de SitePoint Pty. Ltd, www.sitepoint.com
function Ajax() 
{
	this.req = null;
	this.url = null;
	this.status = null;
	this.statusText = '';
	this.method = 'GET';
	this.async = true;
	this.dataPayload = "";
	this.readyState = null;
	this.responseText = null;
	this.responseXML = null;
	this.handleResp = null;
	this.responseFormat = 'text/plain', // 'text/plain', 'text/xml', 'object'
	this.requestFormat = 'application/x-www-form-urlencoded'  //només per POST
	this.structResp=null;
	this.mimeType = null;  
	//this.headers = [];
	this.requestHeaders=[];

	this.init = function() {
		var i = 0;
		var reqTry = [ 
			function() { return new XMLHttpRequest(); },
			function() { return new ActiveXObject('Msxml2.XMLHTTP') },
			function() { return new ActiveXObject('Microsoft.XMLHTTP' )} ];
      
		while (!this.req && (i < reqTry.length)) {
			try { 
				this.req = reqTry[i++]();
			} 
			catch(e) {}
		}
		return true;
	};
	this.doGet = function(url, hand, response_format, struct) 
	{
			this.url = url;
			this.handleResp = hand;
			this.responseFormat = response_format || 'text/plain';
			this.structResp = struct;
			this.doReq();
	};

	this.doPost = function(url, request_format, dataPayload, hand, response_format, struct) 
	{
		this.url = url;
		this.requestFormat = request_format || 'application/x-www-form-urlencoded';    
		this.dataPayload = dataPayload;
		this.handleResp = hand;
		this.responseFormat = response_format || 'text/plain';
		this.structResp = struct;
		this.method = 'POST';
		this.doReq();
	};


	this.doReq = function()
	{
		if (AccessTokenType=="landsense" || AccessTokenType=="nextgeoss")
		{
			//In external authentication, session expires. We need to be sure that it is valid or we risc that a server that is slow on responding could try to validate a token that has already expired.
			var currentTime, expires;

			if (AccessTokenType=="nextgeoss")
				expires=AccessTokenExpires;
			else
				expires=OmpleHelloAccessTokenIType(AccessTokenType);  //Automatic regenerated token is valid
			
			var currentTime = (new Date()).getTime() / 1000;  //in seconds since 1970/01/01
			if ((expires-19) <= currentTime)
			{
				if (expires<currentTime)
					ValidaSSO(true, null, this);
				else
				{
					//Session is close to expire. Since forced authentication does not work, we simply wait until the access token is invalid and then we will request it again.
					ShowInfo("long", DonaCadenaJSON(Msg_Revalidating_authentication) +": "+ Math.floor(expires-currentTime+3) + DonaCadenaJSON(Msg_seconds)+".");
					setTimeout(ValidaSSO, (expires-currentTime+3)*1000, true, null, this);
				}
				return;  //this.doReqAutenticated es fa després de fer altres coses.
			}
		}
		this.doReqAutenticated();
	}
	this.doReqAutenticated = function()
	{
		var self = null;
		var req = null;
		var headArr = [];    
	
		if (!this.init()) {
			alert('Could not create XMLHttpRequest object.');
			return;
		}

		if (AccessTokenType=="landsense" || AccessTokenType=="nextgeoss")
			OmpleHelloAccessTokenIType(AccessTokenType);
		AfegeixCredencialsToken(this);

		req = this.req;
		req.open(this.method, this.url, this.async);
		if (this.method == 'POST') 
			req.setRequestHeader('Content-Type', this.requestFormat);
		for (var i=0; i<this.requestHeaders.length; i++)
			req.setRequestHeader(this.requestHeaders[i].name, this.requestHeaders[i].value);

		self = this;
	
		req.onreadystatechange = function() {
			var resp = null;
			self.readyState = req.readyState;
			if (req.readyState == 4) {
				self.status = req.status;
				self.statusText = req.statusText;
				self.responseText = req.responseText;
				self.responseXML = req.responseXML;
				switch(self.responseFormat) {
					case 'text/plain':
						resp = self.responseText;
						break;
					case 'text/xml':
						resp = self.responseXML;
						break;
					case 'object':
						resp = req;
						break;
				}
		
				if(self.structResp)
					self.structResp.text=self.responseText;
				if (self.status > 199 && self.status < 300) {
					if (!self.handleResp) {
						alert('No response handler defined for this XMLHttpRequest object.');
            					return;
					}
					if(self.structResp) 
					{
						try
						{
					            	self.handleResp(resp, self.structResp);
						}
						catch(e)
						{
							alert("Error on handling server response")
						}
					}
					else
						self.handleResp(resp);
				} else {
					self.handleErr(resp);
				}
			}
		}
		req.send(this.dataPayload);
	};
	this.abort = function() {
		if (this.req) {
			this.req.onreadystatechange = function() { };
			this.req.abort();
			this.req = null;
		}
	};
	this.handleErr = function() {
		var errorWin;
		// Create new window and display error
		try {
			errorWin = window.open('', 'errorWin');
			errorWin.document.body.innerHTML = this.responseText;
		}
		// If pop-up gets blocked, inform user
		catch(e) {
			alert('An error occurred, but the error message cannot be displayed because of your browser\'s pop-up blocker.\n' +
				'You could try to allow pop-ups from this Web site. Meanwhile, the text version of the error is:\n' + this.responseText);
		}
	};
	this.setMimeType = function(mimeType) {
		this.mimeType = mimeType;
	};  
	this.setHandlerResp = function(funcRef) {
		this.handleResp = funcRef;
	};
	this.setHandlerErr = function(funcRef) {
		this.handleErr = funcRef; 
	};
	this.setHandlerBoth = function(funcRef) {
		this.handleResp = funcRef;
		this.handleErr = funcRef;
	};
	this.setRequestHeader = function(headerName, headerValue) {
		this.requestHeaders.push({"name": headerName, "value": headerValue});
    		//this.headers.push(headerName + ': ' + headerValue);
  	};
}

var ShowInfoShortTimeOut=0;
var ShowInfoOtherTimeOut=0;

function RemoveInfo(id)
{
var id_div;
	if (id=="permanent")
		id_div="short-note";
	else
		id_div=id+"-note";
	document.getElementById(id_div).innerHTML="";
	document.getElementById(id_div).style.opacity='0';
	if (id=="short" || id=="permanent")
	{
		if (ShowInfoShortTimeOut)
			clearTimeout(ShowInfoShortTimeOut);
	}
	else
	{
		if (ShowInfoOtherTimeOut)
			clearTimeout(ShowInfoOtherTimeOut);
	}
}

function ShowInfo(id, s)
{
var id_div;
	if (id=="permanent")
		id_div="short-note";
	else
		id_div=id+"-note";
	document.getElementById(id_div).innerHTML=s;
	document.getElementById(id_div).style.opacity='1';
        if (id=="permanent")
	{
		if (ShowInfoShortTimeOut)
			clearTimeout(ShowInfoShortTimeOut);
	}
	else if (id=="short")
	{
		if (ShowInfoShortTimeOut)
			clearTimeout(ShowInfoShortTimeOut);
		ShowInfoShortTimeOut=setTimeout("RemoveInfo(\""+id+"\")",3000);
	}
	else
	{
		if (ShowInfoOtherTimeOut)
			clearTimeout(ShowInfoOtherTimeOut);
		ShowInfoOtherTimeOut=setTimeout("RemoveInfo(\""+id+"\")",15000);
	}
}

//Inspired in http://stackoverflow.com/questions/387736/how-to-stop-event-propagation-with-inline-onclick-attribute
function StopPropagationClick(e)
{
	if (!e)
		e = window.event;

	if (e.stopPropagation)    //IE9 & Other Browsers
		e.stopPropagation();
	
	else if (e.cancelBubble)  //IE8 and Lower
		e.cancelBubble = true;
}

function DonaDataJSComAText(d)
{
	return d.getFullYear()+ "-" + ((d.getMonth() + 1>9) ? "":"0") + (d.getMonth() + 1)+ "-" + ((d.getDate()>9) ? "":"0") + d.getDate()+ " " + ((d.getHours()>9) ? "":"0") + d.getHours()+ ":" +((d.getMinutes()>9) ? "":"0") + d.getMinutes()+ ":" +((d.getSeconds()>9) ? "":"0") + d.getSeconds();
}

function DonaValorDeFormulari(clau_a_buscar, contingut, inclou_servidor)
{
var clau=clau_a_buscar.toUpperCase()+"=";
	if (inclou_servidor==true)
		contingut=contingut.substring(contingut.indexOf("?")+1,contingut.length);
	if (contingut.charAt(0)=="?")
		contingut=contingut.substring(1,contingut.length);

	var kvp=contingut.split("&");
	for (var i_kvp=0; i_kvp<kvp.length; i_kvp++)
	{
		if (kvp[i_kvp].substring(0, clau.length).toUpperCase()==clau)
			return unescape(kvp[i_kvp].substring(clau.length,kvp[i_kvp].length));
	}
	return null;
}

//http://stackoverflow.com/questions/1144783/replacing-all-occurrences-of-a-string-in-javascript
function ReplaceAll(s, find, replace) 
{
	return s.replace(new RegExp(find, 'g'), replace);
}

/*Aquesta funció fa un subconjunt del que fa encodeURIComponent(), que hem 
  observat que remplaça les lletres accentuades per caràcters unicode i això no va bé.*/
function DonaCadenaPerValorDeFormulari(s)
{
	s=ReplaceAll(s, "&", "%26");
	s=ReplaceAll(s, "=", "%3D");
	s=ReplaceAll(s, "\\?", "%3F");  //http://stackoverflow.com/questions/889957/escaping-question-mark-in-regex-javascript
	return s;
}

/*Copied from http://www.w3schools.com/dom/dom_loadxmldoc.asp    finalment no la necessito.
function loadXMLString(txt) 
{
var xmlDoc;
	if (window.DOMParser)
	{
		var parser=new DOMParser();
		xmlDoc=parser.parseFromString(txt,"text/xml");
	}
	else // code for IE
   	{
		xmlDoc=new ActiveXObject("Microsoft.XMLDOM");
		xmlDoc.async=false;
		xmlDoc.loadXML(txt); 
	}
	return xmlDoc;
}*/

var PendingToken="";
var ActionAfterSignIn=null;
var ParamActionAfterSignIn=null;
var ChangeLang=true;  //Change language following user preferences?

function AnalitzarParametresURL()
{
var clau=new Array("USER=", "PASSWORD=", "EMAIL=", "LANGUAGE=", "TOKEN=", "TOKEN_DESC=", "PAGE=", "TARGET_TITLE=", "TARGET_CODE=", "TARGET_CODESPACE=", "SHARE_BORROWER_1=", "ACCESS_TOKEN_TYPE=");
var newpage="";
var email, target_title="", target_code="", target_code_space="", share_borrower_1="", access_token_type="";

	if (location.search && location.search.substring(0,1)=="?")
	{
		var kvp=location.search.substring(1, location.search.length).split("&");
		for (var i_kvp=0; i_kvp<kvp.length; i_kvp++)
		{
			for (var i_clau=0; i_clau<clau.length; i_clau++)
			{
				if (kvp[i_kvp].substring(0, clau[i_clau].length).toUpperCase()==clau[i_clau])
				{
					var valor=unescape(kvp[i_kvp].substring(clau[i_clau].length,kvp[i_kvp].length));
					if (i_clau==0)  //USER
						document.sign_in.user.value=valor;
					else if (i_clau==1)  //PASSWORD
						document.sign_in.pass.value=valor;
					else if (i_clau==2)  //EMAIL
						email=valor;
					else if (i_clau==3)  //LANGUAGE
					{
						var i;
						i=GetActiveLanguageIndex(valor.toLowerCase());
						if (i==-1)
							ShowInfo("long", DonaCadenaJSON(Msg_Unsupported_language)+": \""+ valor.toLowerCase()+"\".");
						else
						{
							ActiveLanguage=i;
							ChangeLang=false;
						}
					}
					else if (i_clau==4)  //TOKEN
						PendingToken=valor;
					else if (i_clau==5)  //TOKEN_DESC
						document.getElementById("execute-token-subtitle-text").innerHTML=valor;
					else if (i_clau==6)  // PAGE
						newpage=valor.toUpperCase();
					else if (i_clau==7)  // TARGET_TITLE
						target_title=valor;
					else if (i_clau==8)  // TARGET_CODE
						target_code=valor;
					else if (i_clau==9)  // TARGET_CODESPACE
						target_code_space=valor;
					else if (i_clau==10)  // SHARE_BORROWER_1
						share_borrower_1=valor;
					else if (i_clau==11)  // ACCESS_TOKEN_TYPE
					{
						access_token_type=valor;
						if (valor.toLowerCase()=="nextgeoss")
							ValidaSSONextGEOSS(true, SignInNBNextGEOSS, null);
						else if (valor.toLowerCase()=="landsense")
							ValidaSSOLandSense(true, SignInNBLandSense, null);
						else if (valor.toLowerCase()=="google")
							ValidaSSOGoogle();
						else if (valor.toLowerCase()=="debug")
							ValidaSSODebug();					
					}
					else
						ShowInfo("long", DonaCadenaJSON(Msg_Unidentified_key) +": \""+ valor+"\".");
					break;
				}
			}
		}
	}

	if (newpage!="")
	{
	
		if (newpage=="NEWPASSWORD")
			EntraANewPassword();
		else if (newpage=="NEWUSER")
			EntraANewUser(email);
		else if (newpage=="TOKEN")
			EntraAExecuteToken();
		else if (newpage=="RESETPASSWORD")
		{
			if (PendingToken=="")
			{
				ShowInfo("long", DonaCadenaJSON(Msg_Valid_token_required));
				return;
			}
			EntraAResetPassword();
		}
		else if (newpage=="MAIN")
			EntraANimmbusMain();
		else if (newpage=="ADDFEEDBACK")
		{
			if (target_title=="" || target_code=="")
			{
				ShowInfo("long", DonaCadenaJSON(Msg_TARGET_TILE_and_CODE_needed));
				return;
			}
			ActionAfterSignIn=EntraAAddFeedback;
			ParamActionAfterSignIn={"title": target_title, "code": target_code, "code_space": target_code_space, "share_borrower_1": share_borrower_1};
		}
		else
			ShowInfo("long", DonaCadenaJSON(Msg_Unidentified_page) +": \""+ newpage+"\".");
	}

}

function InitFrontPage()
{
	RevisaCrossSserverServersNB(ServersNB);
	InitHello();
	SurtDeNimmbus();
	AnalitzarParametresURL();
	ChangeLanguage(ActiveLanguage, ResourcesPerPage);
}

var TimeOutBoxCloser=0;
var CloseDropDownListOutMenu=null;
var CloseDropDownListOutSubMenu=null;

function SwitchDropDownList(menu_id, submenu_id)
{
	if (document.getElementById(submenu_id).style.visibility=="")
		document.getElementById(submenu_id).style.visibility="hidden";

	if (document.getElementById(submenu_id).style.visibility=="hidden")
	{
		document.getElementById(submenu_id).style.visibility="visible";
		//Remove menu when clicking outside: http://www.techjunkie.com/close-div-click-outside/
		CloseDropDownListOut(CloseDropDownListOutSubMenu);

		CloseDropDownListOutMenu=menu_id;
		CloseDropDownListOutSubMenu=submenu_id;

		document.body.removeEventListener('click', CloseDropDownListOutEvent, false);
		if (TimeOutBoxCloser)
			clearTimeout(TimeOutBoxCloser);
		TimeOutBoxCloser=setTimeout("document.body.addEventListener('click', CloseDropDownListOutEvent, false);", 300);
	}
	else
		CloseDropDownListOut(submenu_id);
}

function CloseDropDownListOut(id)
{
	document.body.removeEventListener('click', CloseDropDownListOut, false);
	if (id)
		document.getElementById(id).style.visibility='hidden';
}

function CloseDropDownListOutEvent(event)
{
	if (!event)
		event=window.event;
	if(event.target.id != CloseDropDownListOutMenu)
	{
		CloseDropDownListOut(CloseDropDownListOutSubMenu);
		CloseDropDownListOutSubMenu=null;		
	}
}

function DonaIDProcessDesDeRootXML(root)
{
var process, metadata, title, id;

	process=GetXMLElementByName(root, "wps", "Process");
	if (process)
	{
		metadata=GetXMLElementCollectionByName(process, "ows", "Metadata");
		if (metadata)
		{
			for (var item=0; item<metadata.length; item++)
			{
				title=GetXMLAttributeByName(metadata.item(item), "xlink", "title");
				if (title && title.value.substring(0,8)=="sync_id:")
				{
					return title.value.substring(8);
				}
			}
		}
	}
	return "";
}

function DonaIDRecursDesDeRootXML(root)
{
var process, metadata, title;

	process=GetXMLElementByName(root, "wps", "Process");
	if (process)
	{
		metadata=GetXMLElementCollectionByName(process, "ows", "Metadata");
		if (metadata)
		{
			for (var item=0; item<metadata.length; item++)
			{
				title=GetXMLAttributeByName(metadata.item(item), "xlink", "title");
				if (title && title.value.substring(0,7)=="obj_id:")
				{
					return title.value.substring(7);
				}
			}
		}
	}
	return "";
}

//En alguns casos poso un msg_id i msg_desc per comunicar coses.
//p.ex un NB_RESOURCE:CREATE pot dir que el recurs no es crea perquè ja existeix.
function MostraMissatgeDesDeRootProcesXML(root)
{
var process_succeeded, process, metadata, title;

	process_succeeded=GetXMLElementByName(root, "wps", "ProcessSucceeded");
	if (process_succeeded)
	{
		process=GetXMLElementByName(root, "wps", "Process");
		if (process)
		{
			metadata=GetXMLElementCollectionByName(process, "ows", "Metadata");
			if (metadata)
			{
				for (var item=0; item<metadata.length; item++)
				{
					title=GetXMLAttributeByName(metadata.item(item), "xlink", "title");
					if (title && title.value.substring(0,9)=="msg_desc:")
					{
						ShowInfo("long", title.value.substring(9));
						return true;
					}
				}
			}
		}
	}
	return false;
}

function TiraAPantallaRespostaSiNoEntenc(root, no_usat)
{
	//Si no entenc el document el tiro sencer a la finestra
	if (root.xml)
	{
		ShowInfo("long", "<xmp>"+root.xml+"</xmp>");
		UpdateLastServer();
		return;
	}
	if (XMLSerializer)
	{
		var serializer = new XMLSerializer();   
		ShowInfo("long", "<xmp>"+serializer.serializeToString(root)+"</xmp>");		
		UpdateLastServer();
		return;
	}
	ShowInfo("long", DonaCadenaJSON(Msg_Server_answer_cannot_be_shown));
	UpdateLastServer();
	return;
}

function DonaRootXML(doc, no_usat)
{
	if (!doc || !doc.documentElement)
	{
		
		ShowInfo("long", DonaCadenaJSON(Msg_Server_answer_cannot_be_identified));
		UpdateLastServer();
		return null;
	}
	return doc.documentElement;
}

function AnalitzaExceptionReport(root, no_usat)
{
var exception_error;

	exception_error=GetXMLElementByName(root, "ows", "ExceptionText");
	if (exception_error)
	{
		ShowInfo("long", exception_error.childNodes[0].nodeValue);
		UpdateLastServer();
		return true;
	}
	//Si no trobo text, potser encara trovaré el codi
	exception_error=GetXMLElementByName(root, "ows", "Exception");
	if (exception_error)
	{
		exception_error=GetXMLAttributeByName(exception_error, null, "exceptionCode");
		if (exception_error && exception_error.value)
		{
			ShowInfo("long", exception_error.value);
			UpdateLastServer();
			return true;
		}
	}
	return false;
}


var ajaxExecuteNB;

var TimeOutDonaResposta=0;

function AvaluaResposta(doc, nom_funcio)
{
var root, id_proces, id_obj;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return;
	}

	if (AnalitzaExceptionReport(root, document))
	{
		RemoveInfo("permanent");
		return;
	}

	id_obj=DonaIDRecursDesDeRootXML(root);  //La execució de NB_RESOURCE:CREATE dona l'ID de recurs que s'està en procés de crear.
	if (id_obj!="")
	{
		//Exploro si pot ser que hi hagi un missatge de resposta immediata
		if (MostraMissatgeDesDeRootProcesXML(root))
		{
			RemoveInfo("permanent");
			return;
		}
		IdResourceToSaveChanges=id_obj;		
	}

	id_proces=DonaIDProcessDesDeRootXML(root);
	if (id_proces!="")
	{
		//ShowInfo("long", "Process id:"+id_proces);
		if (TimeOutDonaResposta)
			clearTimeout(TimeOutDonaResposta);
		TimeOutDonaResposta=setTimeout("EvaluateGetReturnProcess(\""+id_proces+"\", \""+nom_funcio+"\")", 1300);
		return;
	}

	RemoveInfo("permanent");
	TiraAPantallaRespostaSiNoEntenc(root, document);
	return;
}

function DiguesOKIEntraANimmbusCallBack()
{
	ShowInfo("short", DonaCadenaJSON(Msg_Ok));
	window.onbeforeunload = ConfirmExit;
	if (ActionAfterSignIn)
		ActionAfterSignIn(ParamActionAfterSignIn);
	else
		EntraANimmbusMain(true);
}

function AvaluaRespostaOk(doc, nom_funcio)
{
var root, output, process_succeeded, identifier;

	RemoveInfo("permanent");

	root=DonaRootXML(doc, document);
	if (!root || AnalitzaExceptionReport(root, document))
		return;

	process_succeeded=GetXMLElementByName(root, "wps", "ProcessSucceeded");
	if (process_succeeded)
	{
		output=GetXMLElementCollectionByName(root, "wps", "Output");

		if (output && output.length)
		{
			for (var item=0; item<output.length; item++)
			{
				identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
				if (identifier && identifier.childNodes[0].nodeValue=="statusCode")
				{					
					var s=OmpleInputDesDeWPSLiteralOutput(output.item(item));
					if (s=="uncreated")
					{
						//Cal crear l'usuari i esperar fins que sigui fet per entrar.
						UpdateLastServer();
						SignUpNB("DiguesOKIEntraANimmbusCallBack");
						return;		
					}
				}
			}
		}

		fn=window[nom_funcio];
		if (typeof fn === "function")
			fn(); 
		else 
			alert("AvaluaRespostaOk(doc, nom_funcio) error in parameter \"nom_funcio\": "+ nom_funcio +" is not a function.");
		UpdateLastServer();
		return;
	}

	TiraAPantallaRespostaSiNoEntenc(root, document);
	return;
}

function InitHello()
{
	hello.init({
		//google: '281597821362-tkj1tngjiiuul47m6dkhrorrsdqomahu.apps.googleusercontent.com',
		landsense: '920b7ffa-1d18-b836-8ff3-514042772543@as.landsense.eu',
		nextgeoss: '@!27B7.E085.07A1.6DE7!0001!F5E4.0B8E!0008!7BBE.671A.BD2B.6459'
	}, {redirect_uri: ((location.pathname.charAt(location.pathname.length-1)=='/') ? location.pathname.substring(0, location.pathname.length-1) : location.pathname)});
	document.getElementById("landsense-button").disabled=false;
	document.getElementById("nextgeoss-button").disabled=false;
}

/* Called when Google Javascript API Javascript is loaded
 The "normal" prodedure indicated here: https://developers.google.com/identity/sign-in/web/sign-in
 is not applicable because the user does not have control and Google takes precedence to any other kind
 of identification forcing immediate validation on google systems. Instead, the procedure described here 
 (and adopted by us):
 http://usefulangle.com/post/55/google-login-javascript-api allow for creating a botton that the user
 is free to select among other offered alternatives.
 The instructions includes the ay to register in google console: https://console.developers.google.com
 both the API key for google+ API and the Credentials for the NiMMBus web application.*/

function HandleGoogleApiLibrary() 
{
	// Load "client" & "auth2" libraries
	gapi.load('client:auth2', {
		callback: function() {
			// Initialize client library
			// clientId & scope is provided => automatically initializes auth2 library
			gapi.client.init({
		    	apiKey: 'AIzaSyBSTYA3cOVJ1fuVGBrJXT8gsrRvFjp74x8',
		    	clientId: '281597821362-tkj1tngjiiuul47m6dkhrorrsdqomahu.apps.googleusercontent.com',
		    	scope: 'https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/plus.me'
			}).then(
				// On success
				function(success) {
			  		// After library is successfully loaded then enable the login button
					document.getElementById("google-button").disabled=false;
				}, 
				// On error
				function(error) {
					alert(DonaCadenaJSON(Msg_Error_loading_Google_libraries));
			  	}
			);
		},
		onerror: function() {
			// Failed to load libraries
			alert(DonaCadenaJSON(Msg_Error_loading_Google_libraries));
		}
	});
}

var AccessToken="";
var AccessTokenType="";
var AccessTokenExpires=0; //Only populated and needed for nextgeoss

function parseJwt(token) 
{
	var base64Url = token.split(".")[1];
	var base64 = base64Url.replace("-", "+").replace("_", "/");
	return JSON.parse(window.atob(base64));
}

function OmpleHelloAccessTokenIType(access_token_type)
{
	try
	{
		var authResponse=hello(access_token_type).getAuthResponse();
		if (!authResponse || !authResponse.access_token)
			return 0;
		if (authResponse.access_token!=AccessToken || AccessTokenType!=access_token_type)
		{
			var jwt = parseJwt(authResponse.id_token);
	
			// https://github.com/kjur/jsrsasign/wiki/Tutorial-for-JWT-verification
	
			if (access_token_type=="nextgeoss")
				document.sign_in.user.value=decode_utf8(jwt.user_name);  //Sembla que nextgeoss que ho diferent i envia el nom del utf8. En canvi landsense ho fa "normal".
			else
				document.sign_in.user.value=jwt.name;
			AccessToken = authResponse.access_token;
			AccessTokenType = access_token_type;
		}
		return authResponse.expires;
	}
	catch (err)
	{
		alert("Error: " +err.message);
	}
}

function SignInNBNextGEOSS()
{
	OmpleHelloAccessTokenIType("nextgeoss");
	SignInNB();
}

function SignInNBLandSense()
{
	OmpleHelloAccessTokenIType("landsense");
	SignInNB();
}

function ValidaSSO(popup, f_callback, pending_ajax_req)
{
	if (AccessTokenType=="landsense")
	{
		ValidaSSOLandSense(popup, f_callback, pending_ajax_req);
		return;
	}
	if (AccessTokenType=="nextgeoss")
	{
		ValidaSSONextGEOSS(popup, f_callback, pending_ajax_req);
		return;
}
}

// Click on login button
function ValidaSSOLandSense(popup, f_callback, pending_ajax_req)
{
	document.getElementById("landsense-button").disabled=true;

	hello("landsense").login({redirect_uri: location.pathname, scope: "openid profile email", display: (popup ? "popup" : "none")}).then(
		function(success) {
			//alert("success");
			//console.log("Success login LandSense: " + success);
			if (f_callback)
				f_callback();
			if (pending_ajax_req)
				pending_ajax_req.doReqAutenticated();
			document.getElementById("landsense-button").disabled=false;
		},
		// On error
		function(error) {
			alert(DonaCadenaJSON(Msg_LandSense_login_failed) + error.error.message);
			document.getElementById("landsense-button").disabled=false;
		}
	);
}

function ValidaSSONextGEOSS(popup, f_callback, pending_ajax_req)
{
	document.getElementById("nextgeoss-button").disabled=true;

	/*The automatic regeneration of the token in the background happens every 10 minutes (wrong timing since token expires in 5 minutes only). 
	To make the situation worse, the automatically generated new token does not work in the server side, so I have to force reauthentification using 
	'force: true'. Then, I cannot relay on the expiration of the new automatic token that I get from hello.getAutoResponse() and I will save the old 
	expiration date and relay on it. (JM) 2018-07-05*/
	hello("nextgeoss").login({redirect_uri: ((location.pathname.charAt(location.pathname.length-1)=='/') ? location.pathname.substring(0, location.pathname.length-1) : location.pathname), scope: "open_id profile email user_name", display: (popup ? "popup" : "none"), force: true}).then(
		function(success) {
			//alert("success");
			//console.log("Success login NextGEOSS: " + success);
			AccessTokenExpires=success.authResponse.expires;
			if (f_callback)
				f_callback();
			if (pending_ajax_req)
				pending_ajax_req.doReqAutenticated();
			document.getElementById("nextgeoss-button").disabled=false;
		},
		// On error
		function(error) {
			alert(DonaCadenaJSON(Msg_NextGEOSS_login_failed) + error.error.message);
			document.getElementById("nextgeoss-button").disabled=false;
		}
	);
}

// Click on login button
function ValidaSSODebug()
{
	document.getElementById("sso-debug-button").disabled=true;

	document.sign_in.user.value="Debug"
	AccessToken = "1234-5678-1234-5678";
	AccessTokenType = "debug";
	document.getElementById("sso-debug-button").disabled=false;
	SignInNB();
}


// Click on login button
function ValidaSSOGoogle() 
{
	document.getElementById("google-button").disabled=true;
			
	// API call for Google login
	gapi.auth2.getAuthInstance().signIn().then(
		// On success
		function(success) {
			// API call to get user information
			gapi.client.request({ path: 'https://www.googleapis.com/plus/v1/people/me' }).then(
				// On success
				function(success) {
					var user_info = JSON.parse(success.body);
					//console.log(user_info);
					document.sign_in.user.value=user_info.displayName;

					//user_info.id;
					//user_info.gender;
					//user_info.image.url;
					//emails[0].value;

					//Extret de: https://github.com/google/google-api-javascript-client/issues/239
					AccessToken = gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().id_token;
					AccessTokenType = "google";
					//console.log("ID Token: " + AccessToken);

					//$("#google-button").hide();  No cal així si retrocedeixo funciona.
					document.getElementById("google-button").disabled=false;

					SignInNB();
				},
				// On error
				function(error) {
					document.getElementById("google-button").disabled=false;

					alert(DonaCadenaJSON(Msg_Google_Account_info_not_retrieved));
				}
			);
		},
		// On error
		function(error) {
			document.getElementById("google-button").disabled=false;
			alert(DonaCadenaJSON(Msg_Google_login_failed));
		}
	);
};


function AfegeixCredencialsToken(ajax)
{
	if (AccessToken.length)
	{
		ajax.setRequestHeader("nb-access-token", AccessToken);  //Eliminar aquest
		ajax.setRequestHeader("Authorization", "Bearer " + AccessToken);
		ajax.setRequestHeader("nb-access-token-type", AccessTokenType);
	}
}

function AfegeixCredencialsUsuari(ajax, user, pass)
{
	if (AccessToken.length==0)
	{
		ajax.setRequestHeader("nb-user", (user==null ? document.sign_in.user.value : user.value));
		ajax.setRequestHeader("nb-password", (pass==null ? document.sign_in.pass.value : pass.value));
	}
}

function SignInNB()
{
	RemoveInfo("long");
	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_USER:VALIDATE&LANGUAGE="+LanguagesNB[ActiveLanguage]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
				, AvaluaRespostaOk, "text/xml",
				"DiguesOKIEntraANimmbusCallBack");
        ShowInfo("permanent", DonaCadenaJSON(Msg_Message_sent));
	return false;
}

function AvaluaRespostaGetReturn(doc, nom_funcio)
{
var root, output, identifier;
var fn;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return;
	}
	output=GetXMLElementCollectionByName(root, "wps", "Output");

	if (output)
	{
		for (var item=0; item<output.length; item++)
		{
			identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
			if (identifier)
			{
				var codi="";
				if (identifier.childNodes[0].nodeValue=="code")
				{					
					codi=OmpleInputDesDeWPSLiteralOutput(output.item(item));
					if (codi=="0")
					{
						RemoveInfo("permanent");
						ShowInfo("short", DonaCadenaJSON(Msg_Ok));
						UpdateLastServer();
						//uso el truco següent: http://www.sitepoint.com/call-javascript-function-string-without-using-eval
						fn=window[nom_funcio];
						if (typeof fn === "function")
							fn(); 
						else 
							alert("AvaluaRespostaGetReturn(doc, nom_funcio) error in parameter \"nom_funcio\": "+ nom_funcio +" is not a function.");
						return;
					}
					if (codi=="7")
					{
						if (TimeOutDonaResposta)
							clearTimeout(TimeOutDonaResposta);
						TimeOutDonaResposta=setTimeout("EvaluateGetReturnProcess(\""+DonaIDProcessDesDeRootXML(root)+"\", \""+nom_funcio+"\");", 500);
						return;
					}
				}
				
				if (identifier.childNodes[0].nodeValue=="description")
				{
					var s=OmpleInputDesDeWPSLiteralOutput(output.item(item));
					if (s=="")
						s=DonaCadenaJSON(Msg_Error_without_description)+ ": " +codi;

					RemoveInfo("permanent");
					ShowInfo("long", s);
					UpdateLastServer();
					return;
				}
			}
		}
	}
	RemoveInfo("permanent");
	TiraAPantallaRespostaSiNoEntenc(root, document);
	return;
}

function EvaluateGetReturnProcess(id, nom_funcio)
{
	ajaxExecuteNB=new Ajax();
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_SYNC:GETRETURN&LANGUAGE="+LanguagesNB[ActiveLanguage]+"&SYNC_ID="+id, AvaluaRespostaGetReturn, "text/xml", 
				nom_funcio);
}

function AvaluaRespostaRetrieveUserMinPreferences(doc)
{
var root, output, identifier;

	root=DonaRootXML(doc, document);
	if (!root)
		return;
	if (AnalitzaExceptionReport(root, document))
		return;

	output=GetXMLElementCollectionByName(root, "wps", "Output");

	if (output && output.length)
	{
		for (var item=0; item<output.length; item++)
		{
			identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
			if (identifier)
			{
				if (identifier.childNodes[0].nodeValue=="language" && ChangeLang)
				{					
					var s=OmpleInputDesDeWPSLiteralOutput(output.item(item));
					if (s!="")
					{
						var i;
						i=GetActiveLanguageIndex(s);
						if (i==-1)
						{
							ShowInfo("long", DonaCadenaJSON(Msg_Unsupported_language));
						}
						else
						{
							if (ActiveLanguage!=i)
							{
								ChangeLanguage(i, ResourcesPerPage);
								ShowInfo("short", DonaCadenaJSON(Msg_Language_changed_preferences));
							}
						}
					}
				}
				else if (identifier.childNodes[0].nodeValue=="name")
				{
					var s=OmpleInputDesDeWPSLiteralOutput(output.item(item));
					if (s!="")
					{
						document.account_form.name.value=s;
						document.getElementById("main-left-pannel-title-text").innerHTML=s;
					}
				}
				else if (identifier.childNodes[0].nodeValue=="obj_time")
				{
					var s=OmpleInputDesDeWPSLiteralOutput(output.item(item));
					if (s!="")
						document.getElementById("main-left-pannel-date-text").innerHTML=s.substring(0, s.indexOf("T"));
				}
			}
		}
		UpdateLastServer();
	}
	else
	{	
		TiraAPantallaRespostaSiNoEntenc(root, document);
	}
	return;
}


function RetrieveUserMinPreferences()
{
	//RemoveInfo("long");
	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_USER:RETRIEVE&LANGUAGE="+LanguagesNB[ActiveLanguage]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
				, AvaluaRespostaRetrieveUserMinPreferences, "text/xml", null);
        //ShowInfo("permanent", DonaCadenaJSON(Msg_Requesting_data_));
	return false;
}

function EliminaPublicOfAFeedback(del_item)
{
	PublicsOfAFeedback.splice(del_item, 1);	
	OmpleRecursPublicsDesDePublicsOfAFeedback();
	PublicsOfAFeedbackHaveChanged=true;	
	return;	
}

function ObreSelectorDePublicOfAFeedback(type_element, compact_element)
{
		EnumerateResources(1, {"type_enum":"resource-selector", "make_pannel_visible":true, "resource_type": "PUBLICAT"});
		return;	
}

function AfegeixPublicOfAFeedback(id_public)
{
	if (id_public==null)
		;
	/*else if (id_public=='')
		ShowInfo("short", DonaCadenaJSON(Msg_Publication_already_related_no_added_again));*/
	else
	{		
		PublicsOfAFeedback.push(id_public);
		OmpleRecursPublicsDesDePublicsOfAFeedback();
		PublicsOfAFeedbackHaveChanged=true;	
	}

	ChangePannel("feedback-resource", true);
	return;	
}

function EliminaTargetOfAFeedback(del_item)
{
	RecuperaCanvisARolesATargetsOfAFeedback();		
	TargetsOfAFeedback.splice(del_item, 1);	
	OmpleRecursTargetsDesDeTargetsOfAFeedback();
	TargetsOfAFeedbackHaveChanged=true;	
	return;	
}

function ObreSelectorDeTargetOfAFeedback(compact_element)
{
		EnumerateResources(1, {"type_enum":"resource-selector", "make_pannel_visible":true, "resource_type": ""});
		return;	
}

function AfegeixTargetOfAFeedback(id_target)
{
	if (id_target==null)  //S'ha cancel·lat d'afegir res.
		;
	/*else if (id_target=='') //S'ha seleccionat un recurs que no té sentit que se seleccioni.
		ShowInfo("short", DonaCadenaJSON(Msg_Resource_already_targeted_no_added_again));*/
	else
	{
		RecuperaCanvisARolesATargetsOfAFeedback();		
		TargetsOfAFeedback.push({"id_target": id_target, "role": "primary"});			
		OmpleRecursTargetsDesDeTargetsOfAFeedback();
		TargetsOfAFeedbackHaveChanged=true;	
	}

	ChangePannel("feedback-resource", true);
	return;	
}

function AvaluaRespostaRetrieveResourceCompacte(doc, dades)
{ 
var root, output, identifier, s, elem, citation, md_identifier, title, code=null, code_space=null, type, href=null, position=null;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return;
	}
	if (AnalitzaExceptionReport(root, document))
	{
		RemoveInfo("permanent");
		return;
	}

	output=GetXMLElementCollectionByName(root, "wps", "Output");

	if (output && output.length)
	{
		for (var item=0; item<output.length; item++)
		{
			identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
			if (identifier)
			{
				if (identifier.childNodes[0].nodeValue=="title")
					title=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="type")
					type=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="citation" || identifier.childNodes[0].nodeValue=="publication")
				{	//els puc fer junts perquè només miro els elements de la part comuna				
					citation=OmpleInputDesDeWPSComplexOutput(output.item(item));
					if (citation)
					{ 
						md_identifier=GetXMLElementByName(citation, "mcc", "MD_Identifier");
						if (md_identifier)
						{
							//CODE						
							elem=GetXMLElementByName(md_identifier, "mcc", "code");
							if (elem)
								code=DonaTextDesDeGcoCharacterString(elem);
							//NAMESPACE
							elem=GetXMLElementByName(md_identifier, "mcc", "codeSpace");
							if (elem)
								code_space=DonaTextDesDeGcoCharacterString(elem);
						}
					}
				}
				else if (identifier.childNodes[0].nodeValue=="href")
					href=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="position")
				{				
					var georss=OmpleInputDesDeWPSComplexOutput(output.item(item));
					if (georss)
						position=GetValueXMLElementByName(georss, "gml", "pos");
				}
			}
		}
		RemoveInfo("permanent");		
		compact_element_item=(dades.del_item ? dades.compact_element+"_"+dades.del_item : dades.compact_element);
		document.getElementById(compact_element_item).innerHTML="<img src=\""+DonaNomImgTipusRecurs(type, true)+"\" align=\"left\"> " + title;
		if (dades.role)
		{
			if (dades.select_role)
			{
				select_role_item=(dades.del_item ? dades.select_role+"_"+dades.del_item : dades.select_role);
				document.getElementById(compact_element_item).innerHTML+="&#8195;&#8195;&#8195;"+DonaCadenaJSON(Msg_Role)+": "+
						"<select class=\"text-input\" id=\""+select_role_item+"-feedback-resource_screen_value\" name=\""+select_role_item+"\">"+
							"<option value=\"primary\" "+((dades.role=="primary") ? " selected=\"selected\"" : "")+">"+DonaCadenaJSON(GUF_TargetRoleCode["primary"])+"</option>"+
							"<option value=\"secondary\" "+((dades.role=="secondary") ? " selected=\"selected\"" : "")+">"+DonaCadenaJSON(GUF_TargetRoleCode["secondary"])+"</option>"+
							"<option value=\"supplementary\" "+((dades.role=="supplementary") ? " selected=\"selected\"" : "")+">"+DonaCadenaJSON(GUF_TargetRoleCode["supplementary"])+"</option>"+
						"</select>";
			}
			else
				document.getElementById(compact_element_item).innerHTML+=" ("+DonaCadenaJSON(Msg_Role)+": "+
						((dades.role=="primary") ? DonaCadenaJSON(GUF_TargetRoleCode["primary"]) : "")+
						((dades.role=="secondary") ? DonaCadenaJSON(GUF_TargetRoleCode["secondary"]) : "")+	
						((dades.role=="supplementary") ? DonaCadenaJSON(GUF_TargetRoleCode["supplementary"]) : "")+")";											
		}
		if (dades.del_item && dades.del_function)
			document.getElementById(compact_element_item).innerHTML+=" <input class=\"submit_btn\" type=\"button\" value=\""+ DonaCadenaJSON(Msg_Delete) +"\" onClick=\""+dades.del_function+"("+(dades.del_item-1)+")\"/>";
		
		if ((type=="CITATION" || type=="PUBLICAT") && code)
			document.getElementById(compact_element_item).innerHTML+="<br> code: " + code + ", code_space: " + (code_space ? code_space : "");
		else if (type=="HREF" && href)
			document.getElementById(compact_element_item).innerHTML+="<br> <a href=\"" + href + "\">" + href + "</a>";			
		else if (type=="POI" && position)
			document.getElementById(compact_element_item).innerHTML+="<br> lat/long: " + position;			
		else // si no he afegit una segona linia amb més dades, la poso en blanc perquè si no lo de sota queda malament
			document.getElementById(compact_element_item).innerHTML+="<br><br>";			

		UpdateLastServer();
	}
	else
	{	
		RemoveInfo("permanent");
		TiraAPantallaRespostaSiNoEntenc(root, document);
	}
	return;
}


function AvaluaRespostaRetrieveResourceHref(doc, id)
{
var root, output, identifier;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return;
	}
	if (AnalitzaExceptionReport(root, document))
	{
		RemoveInfo("permanent");
		return;
	}

	output=GetXMLElementCollectionByName(root, "wps", "Output");

	if (output && output.length)
	{
		document.href_resource_form.title.value="";
		document.href_resource_form.href.value="";
		document.href_resource_form.reason.value="";
		//Valor per defecte de mimetype és "Other" que es marca amb CadenaBuida
		SeleccionaSelectDesDeValor(document.href_resource_form.mimetype, "");
				
		for (var item=0; item<output.length; item++)
		{
			identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
			if (identifier)
			{
				if (identifier.childNodes[0].nodeValue=="title")
					document.href_resource_form.title.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="href")
					document.href_resource_form.href.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="mimetype")
				{					
					SeleccionaSelectDesDeValor(document.href_resource_form.mimetype, 
							OmpleInputDesDeWPSLiteralOutput(output.item(item)));
				}
				else if (identifier.childNodes[0].nodeValue=="reason")
					document.href_resource_form.reason.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="rights")
				{
					var rights=OmpleInputDesDeWPSLiteralOutput(output.item(item));
					document.getElementById("href-resource_btn").style.display=(rights.indexOf("W")==-1) ? 'none' : 'inline';
					document.getElementById("href-resource-exit_btn").style.display=(rights.indexOf("W")==-1) ? 'inline' : 'none';
					document.getElementById("href-resource-close_btn").style.display=(rights.indexOf("W")==-1) ? 'none' : 'inline';
					document.getElementById("href-resource-delete_btn").style.display=(rights.indexOf("O")==-1) ? 'none' : 'inline';
					if (rights.indexOf("W")==-1)
						document.getElementById("href-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_Hyperlink_detailed_description_no_modification);
				}
			}
		}
		RemoveInfo("permanent");
		IdResourceToSaveChanges=id;
		TargetsOfAFeedback.length=0;
		TargetsOfAFeedbackHaveChanged=false;
		PublicsOfAFeedback.length=0;
		PublicsOfAFeedbackHaveChanged=false;	
		UpdateLastServer();
	}
	else
	{	
		RemoveInfo("permanent");
		TiraAPantallaRespostaSiNoEntenc(root, document);
	}
	return;
}

function AvaluaRespostaRetrieveResourcePoi(doc, id)
{
var root, output, identifier, s, georss;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return;
	}
	if (AnalitzaExceptionReport(root, document))
	{
		RemoveInfo("permanent");
		return;
	}

	output=GetXMLElementCollectionByName(root, "wps", "Output");

	if (output && output.length)
	{
		document.poi_resource_form.title.value="";
		document.poi_resource_form.lat.value="";
		document.poi_resource_form.long.value="";
		document.poi_resource_form.elevation.value="";
		document.poi_resource_form.reason.value="";
		document.poi_resource_form.pos_accur.value=""
	
		for (var item=0; item<output.length; item++)
		{
			identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
			if (identifier)
			{
				if (identifier.childNodes[0].nodeValue=="title")
					document.poi_resource_form.title.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="position")
				{					
					georss=OmpleInputDesDeWPSComplexOutput(output.item(item));
					if (georss)
					{
						s=GetValueXMLElementByName(georss, "gml", "pos");
						if (s && -1!=s.indexOf(" "))
						{
							document.poi_resource_form.lat.value=s.substring(0,s.indexOf(" "));
							document.poi_resource_form.long.value=s.substring(s.indexOf(" ")+1, s.length);
						}
					}
				}	
				else if (identifier.childNodes[0].nodeValue=="elevation")
				{
					georss=OmpleInputDesDeWPSComplexOutput(output.item(item));
					if (georss)
					{
						s=GetValueXMLElementByName(georss, "georss", "elev");
						if (s)
							document.poi_resource_form.elevation.value=s;
					}
				}
				else if (identifier.childNodes[0].nodeValue=="reason")
					document.poi_resource_form.reason.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="pos_accuracy")
					document.poi_resource_form.pos_accur.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="rights")
				{
					var rights=OmpleInputDesDeWPSLiteralOutput(output.item(item));
					document.getElementById("poi-resource_btn").style.display=(rights.indexOf("W")==-1) ? 'none' : 'inline';
					document.getElementById("poi-resource-exit_btn").style.display=(rights.indexOf("W")==-1) ? 'inline' : 'none';
					document.getElementById("poi-resource-close_btn").style.display=(rights.indexOf("W")==-1) ? 'none' : 'inline';
					document.getElementById("poi-resource-delete_btn").style.display=(rights.indexOf("O")==-1) ? 'none' : 'inline';
					if (rights.indexOf("W")==-1)
						document.getElementById("poi-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_PoI_detailed_description_no_modification);
				}
			}
		}
		RemoveInfo("permanent");
		IdResourceToSaveChanges=id;
		TargetsOfAFeedback.length=0;
		TargetsOfAFeedbackHaveChanged=false;
		PublicsOfAFeedback.length=0;
		PublicsOfAFeedbackHaveChanged=false;	
		UpdateLastServer();
	}
	else
	{	
		RemoveInfo("permanent");
		TiraAPantallaRespostaSiNoEntenc(root, document);
	}
	return;
}

function AvaluaRespostaRetrieveResourceFeedback(doc, id)
{
var root, output, identifier, s, feedback_item, user_comment;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return;
	}
	if (AnalitzaExceptionReport(root, document))
	{
		RemoveInfo("permanent");
		return;
	}

	var guf=GetRetrieveResourceFeedbackOutputs(root);

	if (!guf)
	{	
		RemoveInfo("permanent");
		TiraAPantallaRespostaSiNoEntenc(root, document);
		return;
	}
	
	TargetsOfAFeedback.length=0;
	TargetsOfAFeedbackHaveChanged=false;
	if (guf.target)
	{	
		for (var item=0; item<guf.target.length; item++)
		{	//Intento deduir si tinc IdNimmbus (que sempre l'hauria de trobar)
			if (guf.target[item].identifier)
			{
  			for (var item2=0; item2<guf.target[item].identifier.length; item2++)
  			{
  				if (guf.target[item].identifier[item2].codeSpace=="http://www.opengis.uab.cat/nimmbus/resourceId")
  				{
  					TargetsOfAFeedback[item]={"id_target": guf.target[item].identifier[item2].code, "role": guf.target[item].role};  					
  					break;
  				}
  			}
			} 			
 			if (TargetsOfAFeedback.length!=item+1) 	//cas molt estrany que no he trobat id NiMMbus
 				ShowInfo("long", DonaCadenaJSON(Msg_Target_without_NiMMbus_id));
		}
	}
	OmpleRecursTargetsDesDeTargetsOfAFeedback();
	
	if (guf.title)
		document.feedback_resource_form.title.value=guf.title;
	else
		document.feedback_resource_form.title.value="";
	if (guf.purpose)
		document.feedback_resource_form.reason.value=guf.purpose;
	else
		document.feedback_resource_form.reason.value="";		
	if (guf.abstract)
		document.feedback_resource_form.abstract.value=guf.abstract;
	else
		document.feedback_resource_form.abstract.value="";
	if (guf.contactRole)
		SeleccionaSelectDesDeValor(document.feedback_resource_form.contactRole, guf.contactRole);
	if (guf.comment)
		document.feedback_resource_form.comment.value=guf.comment;
	else
		document.feedback_resource_form.comment.value="";
	if (guf.motivation)
		SeleccionaSelectDesDeValor(document.feedback_resource_form.motivation, guf.motivation);
	else //Valor per defecte és undefined, que es marca amb CadenaBuida
		SeleccionaSelectDesDeValor(document.feedback_resource_form.motivation, "");
	//if (guf.rating) -> dins la funció ja es mira i, si no, es marca tot a indefinit! (sino veuria "la darrera" puntuació!)
		SeleccionaRadioDesDeValor(document.feedback_resource_form.rating, guf.rating);
	/* Ara sempre que entrem a CREAR un nou FB, el rating està indefeinit (encara que el darrer cop hagués vist un element
	que si tenia rating. El que encara NO es pot fer es posar un altre cop a indefinit un rating d'un FB pel que si havia definit
	un valor, però això és estrany de voler fer, per tant ho deixem així. */
	
	PublicsOfAFeedback.length=0;
	PublicsOfAFeedbackHaveChanged=false;
	if (guf.public)
	{	
		for (var item=0; item<guf.public.length; item++)
		{	//Intento deduir si tinc IdNimmbus (que sempre l'hauria de trobar)
			if (guf.public[item].identifier)
			{
  			for (var item2=0; item2<guf.public[item].identifier.length; item2++)
  			{
  				if (guf.public[item].identifier[item2].codeSpace=="http://www.opengis.uab.cat/nimmbus/resourceId")
  				{
  					PublicsOfAFeedback[item]=guf.public[item].identifier[item2].code;  					
  					break;
  				}
  			}
			} 			
 			if (PublicsOfAFeedback.length!=item+1) 	//cas molt estrany que no he trobat id NiMMbus
 				ShowInfo("long", DonaCadenaJSON(Msg_Public_without_NiMMbus_id));
		}
	}
	OmpleRecursPublicsDesDePublicsOfAFeedback();

	if (guf.rights)
	{
		var rights=guf.rights;
		document.getElementById("feedback-resource_btn").style.display=(rights.indexOf("W")==-1) ? 'none' : 'inline';
		document.getElementById("feedback-resource-exit_btn").style.display=(rights.indexOf("W")==-1) ? 'inline' : 'none';
		document.getElementById("feedback-resource-close_btn").style.display=(rights.indexOf("W")==-1) ? 'none' : 'inline';
		document.getElementById("feedback-resource-delete_btn").style.display=(rights.indexOf("O")==-1) ? 'none' : 'inline';
		if (rights.indexOf("W")==-1)
			document.getElementById("feedback-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_FB_item_detailed_description_no_modification);
	}
	RemoveInfo("permanent");
	IdResourceToSaveChanges=id;	
	UpdateLastServer();

	return;
}

function AvaluaRespostaRetrieveResourceCitation(doc, id)
{
var root, output, identifier, s, elem, citation, md_identifier, onlineResource;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return;
	}
	if (AnalitzaExceptionReport(root, document))
	{
		RemoveInfo("permanent");
		return;
	}

	output=GetXMLElementCollectionByName(root, "wps", "Output");

	if (output && output.length)
	{
		document.citation_resource_form.title.value="";
		document.citation_resource_form.edition.value="";
		document.citation_resource_form.edition_date.value="";		
		document.citation_resource_form.id_code.value="";
		document.citation_resource_form.id_namespace.value="";
		document.citation_resource_form.series_name.value="";
		document.citation_resource_form.series_issue.value="";
		document.citation_resource_form.series_page.value="";		
		document.citation_resource_form.url_link.value="";
		document.citation_resource_form.url_descrip.value="";
		//Valor per defecte "undefined"
		SeleccionaSelectDesDeValor(document.citation_resource_form.function_code, "undefined");
						
		for (var item=0; item<output.length; item++)
		{
			identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
			if (identifier)
			{
				if (identifier.childNodes[0].nodeValue=="title")
					document.citation_resource_form.title.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="citation")
				{					
					citation=OmpleInputDesDeWPSComplexOutput(output.item(item));
					if (citation)
					{ 
						//EDITION						
						elem=GetXMLElementByName(citation, "cit", "edition");
						if (elem)
							document.citation_resource_form.edition.value=DonaTextDesDeGcoCharacterString(elem);
						
						//EDITION_DATE						
						elem=GetXMLElementByName(citation, "cit", "editionDate");
						if (elem)
							document.citation_resource_form.edition_date.value=DonaDataDesDeGcoDateTime(elem);
						
						//identifier
						md_identifier=GetXMLElementByName(citation, "mcc", "MD_Identifier");
						if (md_identifier)
						{
							//CODE						
							elem=GetXMLElementByName(md_identifier, "mcc", "code");
							if (elem)
								document.citation_resource_form.id_code.value=DonaTextDesDeGcoCharacterString(elem);
							//NAMESPACE
							elem=GetXMLElementByName(md_identifier, "mcc", "codeSpace");
							if (elem)
								document.citation_resource_form.id_namespace.value=DonaTextDesDeGcoCharacterString(elem);
						}
						
						//series
						series=GetXMLElementByName(citation, "cit", "series");
						if (series)
						{
							//NAME						
							elem=GetXMLElementByName(series, "cit", "name");
							if (elem)
								document.citation_resource_form.series_name.value=DonaTextDesDeGcoCharacterString(elem);
							//ISSUE_ID
							elem=GetXMLElementByName(series, "cit", "issueIdentification");
							if (elem)
								document.citation_resource_form.series_issue.value=DonaTextDesDeGcoCharacterString(elem);
							//PAGE
							elem=GetXMLElementByName(series, "cit", "page");
							if (elem)
								document.citation_resource_form.series_page.value=DonaTextDesDeGcoCharacterString(elem);
						}
						
						//other_citation_details						
						elem=GetXMLElementByName(citation, "cit", "otherCitationDetails");
						if (elem)
							document.citation_resource_form.other_cit_details.value=DonaTextDesDeGcoCharacterString(elem);

						//online_resource
						onlineResource=GetXMLElementByName(citation, "cit", "CI_OnlineResource");
						if (onlineResource)
						{					
							//LINK
							elem=GetXMLElementByName(onlineResource, "cit", "linkage");
							if (elem)
								document.citation_resource_form.url_link.value=DonaTextDesDeGcoCharacterString(elem);
							//DESCRIPTION
							elem=GetXMLElementByName(onlineResource, "cit", "description");
							if (elem)
								document.citation_resource_form.url_descrip.value=DonaTextDesDeGcoCharacterString(elem);
							//FUNCTION
							elem=GetXMLElementByName(onlineResource, "cit", "function");
							if (elem)
								SeleccionaSelectDesDeValor(document.citation_resource_form.function_code, 
												DonaTextDesDeCodeList(elem, "cit", "CI_OnLineFunctionCode"));														
						}
					}
				}	
				else if (identifier.childNodes[0].nodeValue=="rights")
				{
					var rights=OmpleInputDesDeWPSLiteralOutput(output.item(item));
					document.getElementById("citation-resource_btn").style.display=(rights.indexOf("W")==-1) ? 'none' : 'inline';
					document.getElementById("citation-resource-exit_btn").style.display=(rights.indexOf("W")==-1) ? 'inline' : 'none';
					document.getElementById("citation-resource-close_btn").style.display=(rights.indexOf("W")==-1) ? 'none' : 'inline';
					document.getElementById("citation-resource-delete_btn").style.display=(rights.indexOf("O")==-1) ? 'none' : 'inline';
					if (rights.indexOf("W")==-1)
						document.getElementById("citation-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_Citation_detailed_description_no_modification);
				}
			}
		}
		RemoveInfo("permanent");
		IdResourceToSaveChanges=id;
		TargetsOfAFeedback.length=0;	
		TargetsOfAFeedbackHaveChanged=false;
		PublicsOfAFeedback.length=0;
		PublicsOfAFeedbackHaveChanged=false;	
		UpdateLastServer();
	}
	else
	{	
		RemoveInfo("permanent");
		TiraAPantallaRespostaSiNoEntenc(root, document);
	}
	return;
}

function AvaluaRespostaRetrieveResourcePublication(doc, id)
{
var root, output, identifier, s, elem, publication, md_identifier, onlineResource;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return;
	}
	if (AnalitzaExceptionReport(root, document))
	{
		RemoveInfo("permanent");
		return;
	}

	output=GetXMLElementCollectionByName(root, "wps", "Output");

	if (output && output.length)
	{
		document.publication_resource_form.title.value="";
		document.publication_resource_form.edition.value="";
		document.publication_resource_form.edition_date.value="";		
		document.publication_resource_form.id_code.value="";
		document.publication_resource_form.id_namespace.value="";
		document.publication_resource_form.url_link.value="";
		document.publication_resource_form.url_descrip.value="";
		//Valor per defecte "undefined"
		SeleccionaSelectDesDeValor(document.publication_resource_form.function_code, "undefined");
		document.publication_resource_form.abstract.value="";
		//Valor per defecte "undefined"
		SeleccionaSelectDesDeValor(document.publication_resource_form.category_code, "undefined");
						
		for (var item=0; item<output.length; item++)
		{
			identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
			if (identifier)
			{
				if (identifier.childNodes[0].nodeValue=="title")
					document.publication_resource_form.title.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="publication")
				{					
					publication=OmpleInputDesDeWPSComplexOutput(output.item(item));
					if (publication)
					{ 
						//EDITION						
						elem=GetXMLElementByName(publication, "cit", "edition");
						if (elem)
							document.publication_resource_form.edition.value=DonaTextDesDeGcoCharacterString(elem);
						
						//EDITION_DATE						
						elem=GetXMLElementByName(publication, "cit", "editionDate");
						if (elem)
							document.publication_resource_form.edition_date.value=DonaDataDesDeGcoDateTime(elem);
						
						//identifier
						md_identifier=GetXMLElementByName(publication, "mcc", "MD_Identifier");
						if (md_identifier)
						{
							//CODE						
							elem=GetXMLElementByName(md_identifier, "mcc", "code");
							if (elem)
								document.publication_resource_form.id_code.value=DonaTextDesDeGcoCharacterString(elem);
							//NAMESPACE
							elem=GetXMLElementByName(md_identifier, "mcc", "codeSpace");
							if (elem)
								document.publication_resource_form.id_namespace.value=DonaTextDesDeGcoCharacterString(elem);
						}
						
						//series
						series=GetXMLElementByName(publication, "cit", "series");
						if (series)
						{
							//NAME						
							elem=GetXMLElementByName(series, "cit", "name");
							if (elem)
								document.publication_resource_form.series_name.value=DonaTextDesDeGcoCharacterString(elem);
							//ISSUE_ID
							elem=GetXMLElementByName(series, "cit", "issueIdentification");
							if (elem)
								document.publication_resource_form.series_issue.value=DonaTextDesDeGcoCharacterString(elem);
							//PAGE
							elem=GetXMLElementByName(series, "cit", "page");
							if (elem)
								document.publication_resource_form.series_page.value=DonaTextDesDeGcoCharacterString(elem);
						}
						
						//other_citation_details						
						elem=GetXMLElementByName(publication, "cit", "otherCitationDetails");
						if (elem)
							document.publication_resource_form.other_cit_details.value=DonaTextDesDeGcoCharacterString(elem);

						//online_resource
						onlineResource=GetXMLElementByName(publication, "cit", "CI_OnlineResource");
						if (onlineResource)
						{					
							//LINK
							elem=GetXMLElementByName(onlineResource, "cit", "linkage");
							if (elem)
								document.publication_resource_form.url_link.value=DonaTextDesDeGcoCharacterString(elem);
							//DESCRIPTION
							elem=GetXMLElementByName(onlineResource, "cit", "description");
							if (elem)
								document.publication_resource_form.url_descrip.value=DonaTextDesDeGcoCharacterString(elem);
							//FUNCTION
							elem=GetXMLElementByName(onlineResource, "cit", "function");
							if (elem)
								SeleccionaSelectDesDeValor(document.publication_resource_form.function_code, 
												DonaTextDesDeCodeList(elem, "cit", "CI_OnLineFunctionCode"));
						}
						
						//ABSTRACT
						elem=GetXMLElementByName(publication, "qcm", "abstract");
						if (elem)
							document.publication_resource_form.abstract.value=DonaTextDesDeGcoCharacterString(elem);	
												
						//CATEGORY
						category=GetXMLElementByName(publication, "qcm", "category");
						if (category)
						{					
								SeleccionaSelectDesDeValor(document.publication_resource_form.category_code, 
												DonaTextDesDeCodeList(category, "qcm", "QCM_PublicationCategoryCode"));
						}					
					}
				}	
				else if (identifier.childNodes[0].nodeValue=="rights")
				{
					var rights=OmpleInputDesDeWPSLiteralOutput(output.item(item));
					document.getElementById("publication-resource_btn").style.display=(rights.indexOf("W")==-1) ? 'none' : 'inline';
					document.getElementById("publication-resource-exit_btn").style.display=(rights.indexOf("W")==-1) ? 'inline' : 'none';
					document.getElementById("publication-resource-close_btn").style.display=(rights.indexOf("W")==-1) ? 'none' : 'inline';
					document.getElementById("publication-resource-delete_btn").style.display=(rights.indexOf("O")==-1) ? 'none' : 'inline';
					if (rights.indexOf("W")==-1)
						document.getElementById("publication-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_Publication_detailed_description_no_modification);
				}
			}
		}
		RemoveInfo("permanent");
		IdResourceToSaveChanges=id;
		TargetsOfAFeedback.length=0;	
		TargetsOfAFeedbackHaveChanged=false;
		PublicsOfAFeedback.length=0;
		PublicsOfAFeedbackHaveChanged=false;	
		UpdateLastServer();
	}
	else
	{	
		RemoveInfo("permanent");
		TiraAPantallaRespostaSiNoEntenc(root, document);
	}
	return;
}

function PopulateCompactDescriptionResource(id, compact_element, role, select_role, del_item, del_function)
{
	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_RESOURCE:RETRIEVE&LANGUAGE="+LanguagesNB[ActiveLanguage]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
				+"&RESOURCE="+id, AvaluaRespostaRetrieveResourceCompacte, "text/xml", 
				{"compact_element": compact_element, "role": role, "select_role": select_role, "del_item": del_item, "del_function": del_function});
        ShowInfo("permanent", DonaCadenaJSON(Msg_Requesting_data_));
}

function EditResource(query, type)
{	
var id=DonaValorDeFormulari("RESOURCE", query, true);
var AvaluaRespostaRetrieveResource;

	if (id==null)
	{
		ShowInfo("long", DonaCadenaJSON(Msg_Cannot_found_resource_identifier));
		return;
	}
	
	if (type=="HREF")
	{
		AvaluaRespostaRetrieveResource=AvaluaRespostaRetrieveResourceHref;
		MostraHRefResource(id);
	}
	else if (type=="POI")
	{
		AvaluaRespostaRetrieveResource=AvaluaRespostaRetrieveResourcePoi;
		MostraPoiResource(id);
	}
	else if (type=="FEEDBACK")
	{
		AvaluaRespostaRetrieveResource=AvaluaRespostaRetrieveResourceFeedback;
		MostraFeedbackResource(id, '');
	}
	else if (type=="CITATION")
	{
		AvaluaRespostaRetrieveResource=AvaluaRespostaRetrieveResourceCitation;
		MostraCitationResource(id);
	}
	else if (type=="PUBLICAT")
	{
		AvaluaRespostaRetrieveResource=AvaluaRespostaRetrieveResourcePublication;
		MostraPublicationResource(id);
	}
	else
	{
		ShowInfo("long", DonaCadenaJSON(Msg_Unsupported_resource_type)+": "+type);
		return;
	}

	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_RESOURCE:RETRIEVE&LANGUAGE="+LanguagesNB[ActiveLanguage]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
				+"&RESOURCE="+id, AvaluaRespostaRetrieveResource, "text/xml", id);
        ShowInfo("permanent", DonaCadenaJSON(Msg_Requesting_data_));
}


function DonaNomImgTipusRecurs(type, small)
{
	if (small==true)
	{
	if (type=="HREF")
			return "link36.png";
		if (type=="POI")
			return "point36.png";  
		if (type=="FEEDBACK")
			return "feedback36.png";             
		if (type=="CITATION")
			return "citation36.png";			
		if (type=="PUBLICAT")
			return "publication36.png";
	}
	if (type=="HREF")
		return "link48.png";
	if (type=="POI")
		return "point48.png";  
	if (type=="FEEDBACK")
		return "feedback48.png";             
	if (type=="CITATION")
		return "citation48.png";
	if (type=="PUBLICAT")
		return "publication48.png";
	return "";
}

var ResourcesPerPage=10;  //solució provisional a l'espera de que sigui configurable per usuari

function AvaluaRespostaEnumerateResources(doc, dades)
{
var root, s, type;
	root=DonaRootXML(doc, document);
	if (!root)
	{
		if (dades.text)
			ShowInfo("long", dades.text); 

		return;
	}
	if (AnalitzaExceptionReport(root, document))
		return;
	var owc=ParseOWSContextAtom(root);

	if (dades.make_pannel_visible)
		ChangePannel(dades.type_enum, true);

	if (dades.type_enum=="resource-selector")
	{
		if (dades.resource_type=="") //he entrat a resource-selector per escollir targets de valoracions
		{
			document.getElementById(dades.type_enum+"-title-text").innerHTML=DonaCadenaJSON(Msg_Targeted_resources);
			document.getElementById(dades.type_enum+"-subtitle-text").innerHTML=DonaCadenaJSON(Msg_List_available_resources_as_targets);
		}
		else //de moment només pot valdre "" i "PUBLICAT"
		{
			document.getElementById(dades.type_enum+"-title-text").innerHTML=DonaCadenaJSON(Msg_Related_publications);
			document.getElementById(dades.type_enum+"-subtitle-text").innerHTML=DonaCadenaJSON(Msg_List_available_publications_for_feedback);
		}
	}//else if (type_enum=="resources") no cal fer res perquè els textos ja són posats
	
	if (owc.properties.totalResults==0)
	{
		document.getElementById(dades.type_enum+"-hits-text").innerHTML="<small>"+DonaCadenaJSON(Msg_Use_New_button_to_create_resources)+"</small>";
		document.getElementById("newer-"+dades.type_enum+"_btn").disabled=true;
		document.getElementById("older-"+dades.type_enum+"_btn").disabled=true;
	}
	else
	{
		if (dades.type_enum=="resource-selector")
		{
			if (dades.resource_type=="") //he entrat a resource-selector per escollir targets de valoracions
				document.getElementById(dades.type_enum+"-hits-text").innerHTML="<input class=\"submit_btn\" type=\"button\" value=\""+ DonaCadenaJSON(Msg_Cancel) +"\" onClick=\"AfegeixTargetOfAFeedback(null)\"/>";	
			else //de moment només pot valdre "" i "PUBLICAT"
				document.getElementById(dades.type_enum+"-hits-text").innerHTML="<input class=\"submit_btn\" type=\"button\" value=\""+ DonaCadenaJSON(Msg_Cancel) +"\" onClick=\"AfegeixPublicOfAFeedback(null)\"/>";	
		}
		else //poso en blanc per no anar acumunat 1de10 en anar passant de pàgina!
			document.getElementById(dades.type_enum+"-hits-text").innerHTML="";
		// Afegeixo el text	1 de X
		document.getElementById(dades.type_enum+"-hits-text").innerHTML+="["+owc.properties.startIndex + "," +(parseInt(owc.properties.startIndex)+owc.features.length-1)+ "] "+ DonaCadenaJSON(Msg_of) + " " +  owc.properties.totalResults;
	}
	if (owc.properties.startIndex==1 || owc.properties.totalResults==0)
	{
		document.getElementById("newer-"+dades.type_enum+"_btn").disabled=true;
	}
	else
	{
		//var dades_temp=Object.assign({},dades);
		var dades_temp=JSON.parse(JSON.stringify(dades));  //duplico l'objecte
		dades_temp.make_pannel_visible=false;
		document.getElementById("newer-"+dades.type_enum+"_btn").onclick=new Function("EnumerateResources("+((owc.properties.startIndex<=ResourcesPerPage) ? 1 : owc.properties.startIndex-ResourcesPerPage)+", "+JSON.stringify(dades_temp)+");");
		document.getElementById("newer-"+dades.type_enum+"_btn").disabled=false;
	}

	if (parseInt(owc.properties.startIndex)+owc.features.length-1==owc.properties.totalResults || owc.properties.totalResults==0)
	{
		document.getElementById("older-"+dades.type_enum+"_btn").disabled=true;
	}
	else
	{
		//var dades_temp=Object.assign({},dades);
		var dades_temp=JSON.parse(JSON.stringify(dades));  //duplico l'objecte
		dades_temp.make_pannel_visible=false;		
		document.getElementById("older-"+dades.type_enum+"_btn").onclick=new Function("EnumerateResources("+(parseInt(owc.properties.startIndex)+ResourcesPerPage)+", "+JSON.stringify(dades_temp)+");");
		document.getElementById("older-"+dades.type_enum+"_btn").disabled=false;
	}
	
	s="<ol class=\"white-area-list\">";
	if (owc.features)
	{
		for (var i=0; i<owc.features.length; i++)
					{
			type=GetNimmbusTypeOfAOWCFeature(owc.features[i]);

			var object_id=owc.features[i].id.slice(owc.features[i].id.search("RESOURCE=")+9);
			object_id.slice(0,object_id.search("&")); // si darrera de RESOURCE hi ha algun paràmetre més, que comença sempre amb "&", ho elimino. Si no ho ha trobat search torna -1 i slice no fa res.
			ja_es_target_o_public=false;
			es_ell_mateix=false;

			s+="<div class=\"white-area-li\"><li class=\"white-area-li-text\"";
			if (dades.type_enum=="resources")
				s+=" onClick=\"EditResource(\'"+owc.features[i].id+"\', \'"+type+"\');\"";
			else if (dades.type_enum=="resource-selector")
			{	
				if (dades.resource_type=="") //he entrat a resource-selector per escollir targets de valoracions
				{	//comprovo si aquest target ja forma part de la valoració o si és ell mateix, i en cas que sí ho indico i no l'afegeixo onclick
					for (var item=0; item<TargetsOfAFeedback.length; item++)
					{
						if (TargetsOfAFeedback[item].id_target==object_id)
						{
							ja_es_target_o_public=true;
							break;
						}
						if (IdResourceToSaveChanges==object_id)
						{
							es_ell_mateix=true;
							break;
						}						
					}
					if (ja_es_target_o_public || es_ell_mateix)				
						;//s+=" onClick=\"AfegeixTargetOfAFeedback(\'\');\"";  No fem res
					else
						s+=" onClick=\"AfegeixTargetOfAFeedback(\'"+object_id+"\');\"";
				}
				else //de moment només pot valdre "" i "PUBLICAT"
				{	//comprovo si aquest target ja forma part de la valoració, i en cas que sí ho indico i no l'afegeixo onclick
					for (var item=0; item<PublicsOfAFeedback.length; item++)
					{
						if (PublicsOfAFeedback[item]==object_id)
						{
							ja_es_target_o_public=true;
							break;
						}
					}
					if (ja_es_target_o_public)				
						;//s+=" onClick=\"AfegeixPublicOfAFeedback(\'\');\"";  No fem res
					else
						s+=" onClick=\"AfegeixPublicOfAFeedback(\'"+object_id+"\');\"";
				}
			}
							
			s+="><img class=\"white-area-li-img\" src=\"";
			s+=DonaNomImgTipusRecurs(type, false);
			s+="\"><strong>" +owc.features[i].properties.authors[0].name+"</strong> "+DonaDataISOComAText(owc.features[i].properties.updated)+"<br/>";
			
			if (type=="HREF")
				s+=" <a class=\"white-area-li-text-link\" href=\""+owc.features[i].properties.links.enclosures[0].href+"\" target=\"_blank\" onClick=\"StopPropagationClick(event);return true;\">"+owc.features[i].properties.title+"</a>";
			else if (type=="POI")
				s+=owc.features[i].properties.title+" (lat/long: "+ owc.features[i].geometry.coordinates[1]+","+owc.features[i].geometry.coordinates[0]+")";
			else if (type=="FEEDBACK" || type=="CITATION" || type=="PUBLICAT")
				s+=owc.features[i].properties.title;
      
      if (dades.type_enum=="resources")
      {
				s+="<br/><span class=\"white-area-li-shadow\"> ";
				s+="<a class=\"white-area-li-shadow-link\" id=\"fb-resource-"+i+"\" onClick=\"MostraFeedbackList(event, \'"+owc.features[i].id+"\', \'"+type+"\');\">"+DonaCadenaJSON(Msg_Feedback)+"</a>&nbsp;&nbsp;&nbsp; ";
    	                  		
				if (owc.features[i].properties.rights && owc.features[i].properties.rights.indexOf("S")!=-1)
					s+="<a class=\"white-area-li-shadow-link\" id=\"share-resource-"+i+"\" onClick=\"MostraShareResource(event, \'"+owc.features[i].id+"\', \'"+type+"\');\">"+DonaCadenaJSON(Msg_Share)+"</a>&nbsp;&nbsp;&nbsp; ";
				s+="<a class=\"white-area-li-shadow-link\" id=\"tag-resource-"+i+"\" onClick=\"MostraTagResource(event, \'"+owc.features[i].id+"\');\">"+DonaCadenaJSON(Msg_Tag)+"</a></span>";
			}		
			else if (dades.type_enum=="resource-selector")			
			{
				if (ja_es_target_o_public)
				{
					if (dades.resource_type=="") //he entrat a resource-selector per escollir targets de valoracions
						s+="<br/><i>"+DonaCadenaJSON(Msg_Resource_already_targeted)+"</i>";
					else //de moment només pot valdre "" i "PUBLICAT"
						s+="<br/><i>"+DonaCadenaJSON(Msg_Publication_already_related)+"</i>";					
				}
				else if (es_ell_mateix) //només pot passar als targets que no es trii a ell, per les publics d'un target el enumerate només mostra publlics i per tant mai és ell mateix (que és un target)
					s+="<br/><i>"+DonaCadenaJSON(Msg_Feedback_item_selecting_targets_for)+"</i>";
			}			
			s+="</li></div>";
		}
	}
	s+="</ol>";
	
	document.getElementById(dades.type_enum+"-list").innerHTML=s;

	RemoveInfo("permanent");
	UpdateLastServer();
	return;
}

var ajaxExecuteNBResource;

function EnumerateResources(start_index, dades)
{
	var s;
	
	RemoveInfo("long");		

	s="";
	if (dades.type_enum=="resource-selector" && dades.resource_type!="")
		s="&TYPE="+dades.resource_type;		
	else if (dades.type_enum=="resources")
	{ 
		if (document.getElementById("resource-type_screen_value").selectedIndex>0)
			//miro el que hi ha seleccionat a la dropdown-list resource-type. Només m'interessa si selectedIndex>1 perquè -1 indica que no hi ha selecció i 0 és "Tots"
			s="&TYPE="+document.getElementById("resource-type_screen_value").options[document.getElementById("resource-type_screen_value").selectedIndex].value;	

		if (document.getElementById("owner-type_screen_value").selectedIndex>0)
			//miro el que hi ha seleccionat a la dropdown-list owner-type. Només m'interessa si selectedIndex>1 perquè -1 indica que no hi ha selecció i 0 és "Tots"
			s=s+"&OWNER="+document.getElementById("owner-type_screen_value").options[document.getElementById("owner-type_screen_value").selectedIndex].value;	
	}
	/*else
		s="";*/

	ajaxExecuteNBResource=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNBResource, null, null);
	ajaxExecuteNBResource.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_RESOURCE:ENUMERATE&LANGUAGE="+LanguagesNB[ActiveLanguage]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
				+"&STARTINDEX="+start_index+"&COUNT="+ResourcesPerPage+s, AvaluaRespostaEnumerateResources, "text/xml", dades);
        ShowInfo("permanent", DonaCadenaJSON(Msg_Requesting_resource_list_));
	return false;
}

function AvaluaRespostaRetrieveUserData(doc, no_usat)
{
var root, output, identifier;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return;
	}
	if (AnalitzaExceptionReport(root, document))
	{
		RemoveInfo("permanent");
		return;
	}

	output=GetXMLElementCollectionByName(root, "wps", "Output");

	if (output && output.length)
	{
		for (var item=0; item<output.length; item++)
		{
			identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
			if (identifier)
			{
				if (identifier.childNodes[0].nodeValue=="language")
				{					
					var s=OmpleInputDesDeWPSLiteralOutput(output.item(item));
					if (s!="")
					{
						for (var i=0; i<LanguagesNB.length; i++)
						{
							if (LanguagesNB[i]==s)
							{
								if (ActiveLanguage!=i)
								{
									ChangeLanguage(i, ResourcesPerPage);
									document.account_form.language.selectedIndex=ActiveLanguage;
									ShowInfo("short", DonaCadenaJSON(Msg_Language_changed_preferences));
								}
								break;
							}
						}
					}
				}
				else if (identifier.childNodes[0].nodeValue=="email")
					document.account_form.email.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="name")
					document.account_form.name.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="bio")
					document.account_form.bio.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
			}
		}
		RemoveInfo("permanent");
		UpdateLastServer();
	}
	else
	{	
		RemoveInfo("permanent");
		TiraAPantallaRespostaSiNoEntenc(root, document);
	}
	return;
}

function RetrieveUserData()
{
	RemoveInfo("long");
	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_USER:RETRIEVE&LANGUAGE="+LanguagesNB[ActiveLanguage]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
				, AvaluaRespostaRetrieveUserData, "text/xml", null);
        ShowInfo("permanent", DonaCadenaJSON(Msg_Requesting_data_));
	return false;
}

function ChangePannel(id, add_hash)
{
var i_pannel, 
	pannel=[{"id": "front-page", "parent": null, "title": Msg_NiMMbus_login}, 
		{"id": "reset-pass-page", "parent": null, "title": Msg_NiMMbus_reset_pwd}, 
		{"id": "new-pass-page", "parent": null, "title": Msg_NiMMbus_reset_pwd}, 
		{"id": "new-user-page", "parent": null, "title": Msg_SignUp_NiMMbus},
		{"id": "execute-token-page", "parent": null, "title": Msg_NiMMbus},
		//{"id": "new-user-page", "parent": null, "title": {"cat": "Registra't al NiMMbus", "spa": "Regístrese en NiMMbus", "eng": "Sign up for NiMMbus"}},
		{"id": "main-page", "parent": null, "title": Msg_NiMMbus},
		{"id": "account", "parent": "main-page", "title": Msg_NiMMbus_account}, 
		{"id": "href-resource", "parent": "main-page", "title": Msg_NiMMbus}, 
		{"id": "poi-resource", "parent": "main-page", "title": Msg_NiMMbus}, 
		{"id": "feedback-resource", "parent": "main-page", "title": Msg_NiMMbus_Feedback}, 
		{"id": "citation-resource", "parent": "main-page", "title": Msg_NiMMbus_Citation}, 
		{"id": "publication-resource", "parent": "main-page", "title": Msg_NiMMbus_Publication}, 
		{"id": "resources", "parent": "main-page", "title": Msg_NiMMbus}, 
		{"id": "resource-selector", "parent": "main-page", "title": Msg_NiMMbus_Resources}, 
		{"id": "feedback", "parent": "main-page", "title": Msg_NiMMbus_Feedbacks}, 
		{"id": "share", "parent": "main-page", "title": Msg_NiMMbus_Share}
		/*, {"id": "tag", "parent": "main-page", "title": Msg_NiMMbus} */];
	
	for (var i in pannel)
	{ 
		if (id==pannel[i].id)
		{
			i_pannel=i;
			break;
		}
	}

	for (var i in pannel)
	{ 
		if (i!=i_pannel)
		{
			if (pannel[i].id==pannel[i_pannel].parent)
				;  //Evito apagar el pare del id escollit.
			else
			{
				document.getElementById(pannel[i].id).style.visibility='hidden';
				if (pannel[i].parent && pannel[i].parent!=pannel[i_pannel].parent)  //Evito apagar el pare que és el mateix pare que l'escollit.
					document.getElementById(pannel[i].parent).style.visibility='hidden';
			}
		}
		else 
		{
		  document.title = DonaCadenaJSON(pannel[i_pannel].title);
			document.getElementById(pannel[i_pannel].id).style.visibility='visible';
			if (pannel[i_pannel].parent)
				document.getElementById(pannel[i_pannel].parent).style.visibility='visible';
		}
	}

	
	if (add_hash)
		location.hash=id;
	window.scrollTo(0, 0);
}

function MostraAccount(es_nou)
{
	NewUserChangeTimeOut=0;
	document.account_form.new_user.value=document.sign_in.user.value;
	document.account_form.email.value="";
	document.account_form.email.value="";
	document.account_form.name.value="";
	document.account_form.bio.value="";
	document.account_form.current_pass="";
	document.account_form.new_pass="";
	document.account_form.new_pass_valid="";
	document.account_form.language.selectedIndex=ActiveLanguage;
	
	RetrieveUserData();
	if (es_nou)
	{
		document.getElementById("current_pass_fieldset").style.display='none';
		document.getElementById("new_user_fieldset").style.display='none';
		document.getElementById("new_pass_fieldset").style.display='none';
		document.getElementById("new_pass_valid_fieldset").style.display='none';
		document.getElementById("account-close_btn").style.display='none';
	}
	else
	{
		document.getElementById("current_pass_fieldset").style.display='table';
		document.getElementById("new_user_fieldset").style.display='table';
		document.getElementById("new_pass_fieldset").style.display='table';
		document.getElementById("new_pass_valid_fieldset").style.display='table';
		document.getElementById("account-close_btn").style.display='inline';
	}
	ChangePannel("account", true);
}

var IdResourceToSaveChanges="";
var TargetsOfAFeedback=[];
var TargetsOfAFeedbackHaveChanged=false;
var	PublicsOfAFeedback=[];
var PublicsOfAFeedbackHaveChanged=false;	

function MostraHRefResource(id)
{
	ChangePannel("href-resource", true);
	IdResourceToSaveChanges=id;
	TargetsOfAFeedback.length=0;
	TargetsOfAFeedbackHaveChanged=false;
	PublicsOfAFeedback.length=0;
	PublicsOfAFeedbackHaveChanged=false;	

	document.getElementById("href-resource-exit_btn").style.display='none';
	if (id=="")
	{
		document.getElementById("href-resource-title-text").innerHTML=DonaCadenaJSON(Msg_New_Hyperlink);
		document.getElementById("href-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_Define_hyperlink_characteristics);
		document.getElementById("href-resource_btn").value=DonaCadenaJSON(Msg_Create);
		document.getElementById("href-resource-delete_btn").style.display='none';
	}
	else
	{
		document.getElementById("href-resource-title-text").innerHTML=DonaCadenaJSON(Msg_Hyperlink);
		document.getElementById("href-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_Modify_hyperlink_characteristics);
		document.getElementById("href-resource_btn").value=DonaCadenaJSON(Msg_Save_changes);
		document.getElementById("href-resource-delete_btn").style.display='inline';
	}
}

function MostraPoiResource(id)
{
	ChangePannel("poi-resource", true);
	IdResourceToSaveChanges=id;
	TargetsOfAFeedback.length=0;
	TargetsOfAFeedbackHaveChanged=false;
	PublicsOfAFeedback.length=0;
	PublicsOfAFeedbackHaveChanged=false;	

	//document.getElementById("long-poi-resource_alert").style.display='none';
	//document.getElementById("lat-poi-resource_alert").style.display='none';
	document.getElementById("elevation-poi-resource_alert").style.display='none';
	document.getElementById("reason-poi-resource_alert").style.display='none';
	document.getElementById("poi-resource-exit_btn").style.display='none';
	if (id=="")
	{
		document.getElementById("poi-resource-title-text").innerHTML=DonaCadenaJSON(Msg_New_PoI);
		document.getElementById("poi-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_Define_PoI_characteristics);
		document.getElementById("poi-resource_btn").value=DonaCadenaJSON(Msg_Create);
		document.getElementById("poi-resource-delete_btn").style.display='none';
	}
	else
	{
		document.getElementById("poi-resource-title-text").innerHTML=DonaCadenaJSON(Msg_PoI);
		document.getElementById("poi-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_Modify_PoI_characteristics);
		document.getElementById("poi-resource_btn").value=DonaCadenaJSON(Msg_Save_changes);
		document.getElementById("poi-resource-delete_btn").style.display='inline';
	}
}

function OmpleRecursTargetsDesDeTargetsOfAFeedback()
{
	document.getElementById("target_feedback-resource_compact_list").innerHTML="";		
	if (TargetsOfAFeedback.length==0)
		return;		

	for (var item=0; item<TargetsOfAFeedback.length; item++)
	{
		document.getElementById("target_feedback-resource_compact_list").innerHTML+="<div id=\""+"target_feedback-resource_compact_list"+"_"+(item+1)+"\"></div>";
		PopulateCompactDescriptionResource(TargetsOfAFeedback[item].id_target, "target_feedback-resource_compact_list", TargetsOfAFeedback[item].role, "targetRole", (item+1), "EliminaTargetOfAFeedback");
	}
	return;
}

function OmpleRecursPublicsDesDePublicsOfAFeedback()
{
	document.getElementById("public_feedback-resource_compact_list").innerHTML="";		
	if (PublicsOfAFeedback.length==0)
		return;		

	for (var item=0; item<PublicsOfAFeedback.length; item++)
	{
		document.getElementById("public_feedback-resource_compact_list").innerHTML+="<div id=\""+"public_feedback-resource_compact_list"+"_"+(item+1)+"\"></div>";
		PopulateCompactDescriptionResource(PublicsOfAFeedback[item], "public_feedback-resource_compact_list", null, null, (item+1), "EliminaPublicOfAFeedback");
	}
	return;
}

function MostraFeedbackResource(id, target)
{	
	TargetsOfAFeedbackHaveChanged=false;
	if (id=='')
	{
		TargetsOfAFeedback.length=0;
		//Estic creant un FB nou, per tant he de posar el rating a indefinit perquè si no em queda el de la darrer FB que he obert, i en aquest cas no interessa (per si vull fer un comment SENSE rating!)
		SeleccionaRadioDesDeValor(document.feedback_resource_form.rating, "");
	}
		
	if (id=='' && target==null)  //Marca de que estic afegit un feedback a un target seleccionat 
	{
		TargetsOfAFeedback[0]={"id_target": IdResourceToSaveChanges, "role": "primary"};		
		TargetsOfAFeedbackHaveChanged=true; //Si no no s'enviarà el text "TARGET_1=... en el CREATE
	}
	else
	{
		if  (target && target!='')
		{
			TargetsOfAFeedback[0]={"id_target": target, "role": "primary"};
			TargetsOfAFeedbackHaveChanged=true; //Si no no s'enviarà el text "TARGET_1=... en el CREATE
		}
	}
	OmpleRecursTargetsDesDeTargetsOfAFeedback();
	ChangePannel("feedback-resource", true);

	IdResourceToSaveChanges=id;
	
	document.getElementById("feedback-resource-exit_btn").style.display='none';
	if (id=="")
	{
		document.getElementById("feedback-resource-title-text").innerHTML=DonaCadenaJSON(Msg_New_feedback);
		document.getElementById("feedback-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_Define_feedback_characteristics);
		document.getElementById("share-anonymous-feedback-resource_fieldset").style.display='inline'
		document.getElementById("feedback-resource_btn").value=DonaCadenaJSON(Msg_Create);
		document.getElementById("feedback-resource-delete_btn").style.display='none';
	}
	else
	{
		document.getElementById("feedback-resource-title-text").innerHTML=DonaCadenaJSON(Msg_Feedback);
		document.getElementById("feedback-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_Modify_feedback_characteristics);
		document.getElementById("share-anonymous-feedback-resource_fieldset").style.display='none'
		document.getElementById("feedback-resource_btn").value=DonaCadenaJSON(Msg_Save_changes);
		document.getElementById("feedback-resource-delete_btn").style.display='inline';
	}
}

function SurtDeAddFeedbackCallBack()
{
	//DetermineCitationID
	ShowInfo("short", DonaCadenaJSON(Msg_Citation_created));
	RetrieveUserMinPreferences();
	EnumerateResources(1, {"type_enum":"resources", "make_pannel_visible":false});
	MostraFeedbackResource('', null);
}

function AvaluaRespostaCreaTargetNoNecessari(doc)
{
var root, id_proces, id_obj;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return null;
	}

	if (AnalitzaExceptionReport(root, document))
	{
		RemoveInfo("permanent");
		return null;
	}

	process_succeeded=GetXMLElementByName(root, "wps", "ProcessSucceeded");
	if (process_succeeded)
	{
		//Si ha retornat de manera immediata amb una ProcessSucceeded vol dir que no calia crear cap target. Es podria comprobar més bé mirant is "msg_id:" és 99 però no em cal.
		id_obj=DonaIDRecursDesDeRootXML(root);
		RemoveInfo("permanent");
		return id_obj;
	}
	return "";
}

function AvaluaRespostaRetrieveTarget(doc, nom_funcio)
{
var target_id;
	//Determina si la resposta ha estat "error" "ja existeix" i puc obtenir el target_id
	target_id=AvaluaRespostaCreaTargetNoNecessari(doc);
	if (target_id==null)  // El fitxer doc no és ni tant sols un xml que es pugui entendre.
		return;
	if (target_id=="")
		AvaluaResposta(doc, nom_funcio);  //El recurs no existia i està en procés de creació
	else
	{
		RetrieveUserMinPreferences();
		EnumerateResources(1, {"type_enum":"resources", "make_pannel_visible":false});
		MostraFeedbackResource('', target_id);  //el recurs existeix i es pot afegir el feedback sobre ell sense esperar.
	}
}

//Funció inspirada en SendCitationResourceChanges() però molt més automàtica.
function EntraAAddFeedback(target)
{
	ActionAfterSignIn=TancaFinestraNimmbus;
	ParamActionAfterSignIn=null;

        ShowInfo("permanent", DonaCadenaJSON(Msg_Citation_sent));
	ajaxExecuteNB=new Ajax();	
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_RESOURCE:CREATE&LANGUAGE="+LanguagesNB[document.account_form.language.selectedIndex]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
				+"&TYPE=CITATION"+"&TITLE="+target.title+
				"&ID_CODE="+target.code+"&ID_NAMESPACE="+target.code_space+
				"&URL_LINK=&URL_DESCRIP=&URL_FUNCTION="+(target.share_borrower_1!="" ? "&SHARE_BORROWER_1="+target.share_borrower_1 : ""), AvaluaRespostaRetrieveTarget, "text/xml", 
				"SurtDeAddFeedbackCallBack");
	return false;
}

function MostraCitationResource(id)
{
	ChangePannel("citation-resource", true);
	IdResourceToSaveChanges=id;
	TargetsOfAFeedback.length=0;
	TargetsOfAFeedbackHaveChanged=false;
	PublicsOfAFeedback.length=0;
	PublicsOfAFeedbackHaveChanged=false;

	document.getElementById("citation-resource-exit_btn").style.display='none';
	if (id=="")
	{
		document.getElementById("citation-resource-title-text").innerHTML=DonaCadenaJSON(Msg_New_citation);
		document.getElementById("citation-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_Define_citation_characteristics);
		document.getElementById("citation-resource_btn").value=DonaCadenaJSON(Msg_Create);
		document.getElementById("citation-resource-delete_btn").style.display='none';
	}
	else
	{
		document.getElementById("citation-resource-title-text").innerHTML=DonaCadenaJSON(Msg_Citation);
		document.getElementById("citation-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_Modify_citation_characteristics);
		document.getElementById("citation-resource_btn").value=DonaCadenaJSON(Msg_Save_changes);
		document.getElementById("citation-resource-delete_btn").style.display='inline';
	}
}

function MostraPublicationResource(id)
{
	ChangePannel("publication-resource", true);
	IdResourceToSaveChanges=id;
	TargetsOfAFeedback.length=0;
	TargetsOfAFeedbackHaveChanged=false;
	PublicsOfAFeedback.length=0;
	PublicsOfAFeedbackHaveChanged=false;

	document.getElementById("publication-resource-exit_btn").style.display='none';
	if (id=="")
	{
		document.getElementById("publication-resource-title-text").innerHTML=DonaCadenaJSON(Msg_New_publication);
		document.getElementById("publication-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_Define_publication_characteristics);
		document.getElementById("publication-resource_btn").value=DonaCadenaJSON(Msg_Create);
		document.getElementById("publication-resource-delete_btn").style.display='none';
	}
	else
	{
		document.getElementById("publication-resource-title-text").innerHTML=DonaCadenaJSON(Msg_Publication);
		document.getElementById("publication-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_Modify_publication_characteristics);
		document.getElementById("publication-resource_btn").value=DonaCadenaJSON(Msg_Save_changes);
		document.getElementById("publication-resource-delete_btn").style.display='inline';
	}
}

function MostraShareResource(event, query, type)
{
var id=DonaValorDeFormulari("RESOURCE", query, true);

	StopPropagationClick(event);
	IdResourceToSaveChanges=id;
	TargetsOfAFeedback.length=0;
	TargetsOfAFeedbackHaveChanged=false;
	PublicsOfAFeedback.length=0;
	PublicsOfAFeedbackHaveChanged=false;

	RetrieveShareAuthorizedList(type);
	EnumerateShareResource(id);

	ChangePannel("share", true);
}

/*This function draws the "Feedback items" form.*/
function MostraFeedbackList(event, query, type)
{
var id=DonaValorDeFormulari("RESOURCE", query, true);

	StopPropagationClick(event);
	IdResourceToSaveChanges=id;
	//Quan fem el botó afegir ja es posarà a 1 i amb el ID que toca
	TargetsOfAFeedback.length=0;  
	TargetsOfAFeedbackHaveChanged=false;
	PublicsOfAFeedback.length=0;
	PublicsOfAFeedbackHaveChanged=false;
	
	EnumerateFeedbackResource(id);
	document.getElementById("feedback_target_compact_descrip").innerHTML="";		
	PopulateCompactDescriptionResource(id, "feedback_target_compact_descrip", null, null, null, null);

	ChangePannel("feedback", true);
}

function MostraTagResource(event, query)
{
var id=DonaValorDeFormulari("RESOURCE", query, true);

	StopPropagationClick(event);

	//IdResourceToSaveChanges=id;

	alert("Sorry, not implemented yet");
	
	//NewUserChangeTimeOut=0;
	//RetrieveUserData();
	//ChangePannel("tag", true);
}

function AvaluaRespostaShareEnumerate(doc, id)
{
var root, output, identifier, text_current_share_list, has_anonymous=false;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return;
	}
	if (AnalitzaExceptionReport(root, document))
	{
		RemoveInfo("permanent");
		return;
	}

	output=GetXMLElementCollectionByName(root, "wps", "Output");

	text_current_share_list="";

	//Aquest és una mica especial donat que si no hi ha outputs també té sentit la resposta.
	for (var item=0; output && item<output.length; item++)
	{
		identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
		if (identifier)
		{
			if (identifier.childNodes[0].nodeValue=="borrower" ||
			    identifier.childNodes[0].nodeValue=="owner")
			{					
				var nb_user=OmpleInputDesDeWPSComplexOutput(output.item(item))
				if (nb_user)
				{
					var rights=GetValueXMLElementByName(nb_user, "nb_share", "rights");
					var user=GetValueXMLElementByName(nb_user, "nb_user", "user");
					var name=GetValueXMLElementByName(nb_user, "nb_user", "name");
					var email=GetValueXMLElementByName(nb_user, "nb_user", "email");
					if (user=="Anonymous")
						has_anonymous=true;
					if (user==document.sign_in.user.value)  //soc jo mateix.
						text_current_share_list+=user + " (<i>"+DonaCadenaJSON(Msg_Myself)+"</i>)";
					else
						text_current_share_list+=user+ " <i>" +name+ "</i>" + (email=="" ? "": " &lt;" +email+"&gt;");
					text_current_share_list += (rights.indexOf("R")==-1 ? "" : " " + DonaCadenaJSON(Msg_Read)+"<img src=\"check16.png\"/>") + (rights.indexOf("W")==-1 ? "" : " " + DonaCadenaJSON(Msg_Write)+"<img src=\"check16.png\"/>") + (rights.indexOf("S")==-1 ? "" : " " + DonaCadenaJSON(Msg_Share)+"<img src=\"check16.png\"/>") + (rights.indexOf("O")==-1 ? "" : " " + DonaCadenaJSON(Msg_Owner)+"<img src=\"check16.png\"/>");
					if (identifier.childNodes[0].nodeValue=="borrower")
						text_current_share_list+=" <a href=\'javascript:void(0);\' onclick=\'DeleteShareResource(\""+user+"\")\'><img src=\"delete16.png\" border=\"0\"/></a>"
					text_current_share_list+="<br/>";
				}
			}
		}
	}
	RemoveInfo("permanent");
	UpdateLastServer();
	document.getElementById("current_share_list").innerHTML=text_current_share_list;
	document.getElementById("current_share_fieldset").style.display=(text_current_share_list=="") ? 'none' : 'inline';
	document.getElementById("new_share_open_fieldset").style.display=(has_anonymous) ? 'none': 'inline';
	return;
}

function EnumerateShareResource(id)
{	
	if (id==null)
	{
	        ShowInfo("long", DonaCadenaJSON(Msg_Cannot_found_resource_identifier));
		return;
	}
	
	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_SHARE:ENUMERATE&LANGUAGE="+LanguagesNB[ActiveLanguage]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
				+"&RESOURCE="+id, AvaluaRespostaShareEnumerate, "text/xml", id);
        ShowInfo("permanent", DonaCadenaJSON(Msg_Requesting_data_));

	return true;
}

function AvaluaRespostaFeedbackEnumerate(doc, id)
{
var root, text_current_feedback_list;

	root=DonaRootXML(doc, document);
	if (!root)
		return;
	if (AnalitzaExceptionReport(root, document))
		return;
	var owc=ParseOWSContextAtom(root);

	ChangePannel("feedback", true);

	document.getElementById("current_feedback_fieldset").style.display=(!owc.features || owc.features.length) ? 'inline' : 'none';

	text_current_feedback_list="";
	if (owc.features)
	{
		for (var i=0; i<owc.features.length; i++)
		{
			//We are supposing that all the returned objects are of the same type: FEEDBACK
			text_current_feedback_list+=owc.features[i].properties.title;
			text_current_feedback_list+=" <input class=\"submit_btn\" type=\"button\" value=\""+ DonaCadenaJSON(Msg_Edit) +"\" onClick=\"EditResource(\'"+owc.features[i].id+"\', \'FEEDBACK\')\"/>";
			text_current_feedback_list+="<br/>";			
		}
	}
	document.getElementById("current_feedback_list").innerHTML=text_current_feedback_list;

	RemoveInfo("permanent");
	UpdateLastServer();
	return;
}

function EnumerateFeedbackResource(id)
{	
	if (id==null)
	{
	        ShowInfo("long", DonaCadenaJSON(Msg_Cannot_found_resource_identifier));
		return;
	}
	
	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_RESOURCE:ENUMERATE&LANGUAGE="+LanguagesNB[ActiveLanguage]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
				+"&TYPE=FEEDBACK&TARGET="+id, AvaluaRespostaFeedbackEnumerate, "text/xml", id);
        ShowInfo("permanent", DonaCadenaJSON(Msg_Requesting_data_));

	return true;
}

function AvaluaRespostaShareAuthorized(doc, no_usat)
{
var root, output, identifier, nb_user;
var user, name, email;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return;
	}
	if (AnalitzaExceptionReport(root, document))
	{
		RemoveInfo("permanent");
		return;
	}

	output=GetXMLElementCollectionByName(root, "wps", "Output");

	//En aquest punt esborro el contingut del select si n'hi havia.
	while (document.share_form.new_share_select.options.length)
		document.share_form.new_share_select.options[0]=null;

	//Aquest és una mica especial donat que si no hi ha outputs també té sentit la resposta.
	for (var item=0; output && item<output.length; item++)
	{
		identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
		if (identifier)
		{
			if (identifier.childNodes[0].nodeValue=="authorized")
			{					
				var nb_user=OmpleInputDesDeWPSComplexOutput(output.item(item))
				if (nb_user)
				{
					user=GetValueXMLElementByName(nb_user, "nb_user", "user");
					name=GetValueXMLElementByName(nb_user, "nb_user", "name");
					email=GetValueXMLElementByName(nb_user, "nb_user", "email");
					document.share_form.new_share_select.options[document.share_form.new_share_select.options.length]=new Option(user+ "  " +name+ "  " +(email=="" ? "": "<" +email+">"), user);
				}
			}
		}
	}
	RemoveInfo("permanent");
	UpdateLastServer();
	return;
}

function RetrieveShareAuthorizedList(type)
{	
	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_SHARE:AUTHORIZED&LANGUAGE="+LanguagesNB[ActiveLanguage]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
				+"&TYPE="+type, AvaluaRespostaShareAuthorized, "text/xml", null);
        //En aquest cas no dic res: ShowInfo("permanent", DonaCadenaJSON(Msg_Requesting_data_));

	return true;
}

function SurtDeAddShareCallBack()
{
	ShowInfo("short", DonaCadenaJSON(Msg_Added));
	EnumerateShareResource(IdResourceToSaveChanges);
}

function AddShareResource(tothom)
{	
	if (IdResourceToSaveChanges=="")
	{
	        ShowInfo("long", DonaCadenaJSON(Msg_Cannot_found_resource_identifier));
		return;
	}
	if (tothom)
	{
		ajaxExecuteNB=new Ajax();
		AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
		ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_SHARE:ADD&LANGUAGE="+LanguagesNB[ActiveLanguage]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
				+"&RESOURCE="+IdResourceToSaveChanges+"&BORROWER=Anonymous&RIGHTS=R", AvaluaResposta, "text/xml", "SurtDeAddShareCallBack");
	}
	else
	{
		if (document.share_form.new_share.value=="")
		{
			ShowInfo("long", DonaCadenaIdNoPotSerBuit("new_share_screen"));
			return false;
		}
		ajaxExecuteNB=new Ajax();
		AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
		ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_SHARE:ADD&LANGUAGE="+LanguagesNB[ActiveLanguage]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
				+"&RESOURCE="+IdResourceToSaveChanges+"&BORROWER="+document.share_form.new_share.value+"&RIGHTS=R"+(document.share_form.W.checked ? "W":"")+(document.share_form.S.checked ? "S":""), AvaluaResposta, "text/xml", 
				"SurtDeAddShareCallBack");
	}
        ShowInfo("permanent", DonaCadenaJSON(Msg_Adding_));

	return true;
}

function SurtDeDeleteShareCallBack()
{
	ShowInfo("short", DonaCadenaJSON(Msg_Deleted));
	EnumerateShareResource(IdResourceToSaveChanges);
}

function DeleteShareResource(user)
{	
	if (IdResourceToSaveChanges=="")
	{
	        ShowInfo("long", DonaCadenaJSON(Msg_Cannot_found_resource_identifier));
		return;
	}
	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_SHARE:DELETE&LANGUAGE="+LanguagesNB[ActiveLanguage]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
				+"&RESOURCE="+IdResourceToSaveChanges+"&BORROWER="+user, AvaluaResposta, "text/xml", 
				"SurtDeDeleteShareCallBack");
        ShowInfo("permanent", DonaCadenaJSON(Msg_Deleting_));

	return false;
}


function ShowShareAuthorizedList()
{
	if (document.share_form.new_share_select.options.length)
		document.getElementById("new_share_select").style.display='inline';
}

function HideShareAuthorizedList()
{
	document.getElementById("new_share_select").style.display='none';
}

function SelectionShareAuthorizedList()
{
	if (document.share_form.new_share_select.selectedIndex!=-1)
		document.share_form.new_share.value=document.share_form.new_share_select.options[document.share_form.new_share_select.selectedIndex].value;
}

function SendHRefResourceChanges()
{
var s,s2;
	if (document.href_resource_form.href.value=="")
	{
		ShowInfo("long", DonaCadenaIdNoPotSerBuit("href-href-resource_screen"));
		return false;
	}
	if (document.href_resource_form.title.value=="")
	{
		ShowInfo("long", DonaCadenaIdNoPotSerBuit("title-href-resource_screen"));
		return false;
	}
	RemoveInfo("long");
	if (IdResourceToSaveChanges=="")
	{
		s="CREATE";
		s2="";
	        ShowInfo("permanent", DonaCadenaJSON(Msg_Resource_sent));
	}
	else
	{
		s="MODIFY";
		s2="&RESOURCE="+IdResourceToSaveChanges;
	        ShowInfo("permanent", DonaCadenaJSON(Msg_Modifications_sent));
	}
	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_RESOURCE:"+s+"&LANGUAGE="+LanguagesNB[document.account_form.language.selectedIndex]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
				+"&TYPE=HREF"+"&HREF="+DonaCadenaPerValorDeFormulari(document.href_resource_form.href.value)+"&MIMETYPE="+document.href_resource_form.mimetype.value+"&TITLE="+DonaCadenaPerValorDeFormulari(document.href_resource_form.title.value)+
				"&REASON="+DonaCadenaPerValorDeFormulari(document.href_resource_form.reason.value)+s2, AvaluaResposta, "text/xml", 
				"SurtDeHRefResourceChangesCallBack");
	return false;
}

function SendPoiResourceChanges()
{
var s,s2;
	if (document.poi_resource_form.long.value=="")
	{
		ShowInfo("long", DonaCadenaIdNoPotSerBuit("long-poi-resource_screen"));
		return false;
	}
	if (document.poi_resource_form.lat.value=="")
	{
		ShowInfo("long", DonaCadenaIdNoPotSerBuit("lat-poi-resource_screen"));
		return false;
	}
	if (document.poi_resource_form.title.value=="")
	{
		ShowInfo("long", DonaCadenaIdNoPotSerBuit("title-poi-resource_screen"));
		return false;
	}
	RemoveInfo("long");
	if (IdResourceToSaveChanges=="")
	{
		s="CREATE";
		s2="";
	        ShowInfo("permanent", DonaCadenaJSON(Msg_Resource_sent));
	}
	else
	{
		s="MODIFY";
		s2="&RESOURCE="+IdResourceToSaveChanges;
	        ShowInfo("permanent", DonaCadenaJSON(Msg_Modifications_sent));
	}
	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_RESOURCE:"+s+"&LANGUAGE="+LanguagesNB[document.account_form.language.selectedIndex]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
				+"&TYPE=POI"+"&POSITION=<gml:Point><gml:pos>" + document.poi_resource_form.lat.value+ " " +document.poi_resource_form.long.value+ "</gml:pos></gml:Point>" + (document.poi_resource_form.elevation.value=="" ? "" : "&ELEVATION="+document.poi_resource_form.elevation.value) + "&TITLE="+DonaCadenaPerValorDeFormulari(document.poi_resource_form.title.value)+
				"&REASON="+DonaCadenaPerValorDeFormulari(document.poi_resource_form.reason.value)+"&POS_ACCURACY="+DonaCadenaPerValorDeFormulari(document.poi_resource_form.pos_accur.value)+s2, AvaluaResposta, "text/xml", 
				"SurtDePoiResourceChangesCallBack");
	return false;
}

function RecuperaCanvisARolesATargetsOfAFeedback()
{
		for (var item=0; item<TargetsOfAFeedback.length; item++)
		{
			var role_temp;
			role_temp=DonaCadenaCodelistDeSelect(eval("document.feedback_resource_form.targetRole_"+(item+1)));
			
			if (TargetsOfAFeedback[item].role!=role_temp)
			{
				TargetsOfAFeedback[item].role=role_temp;
				TargetsOfAFeedbackHaveChanged=true;
			}
		}	
		return;
}

function SendFeedbackResourceChanges()
{
var s,s2;
	if (document.feedback_resource_form.title.value=="")
	{
		ShowInfo("long", DonaCadenaIdNoPotSerBuit("title-feedback-resource_screen"));
		return false;
	}
	RemoveInfo("long");
	if (IdResourceToSaveChanges=="")
	{
		s="CREATE";
		s2=(document.feedback_resource_form.share_1.checked) ? "&SHARE_BORROWER_1=Anonymous" : "";
	        ShowInfo("permanent", DonaCadenaJSON(Msg_Resource_sent));
	}
	else
	{
		s="MODIFY";
		s2="&RESOURCE="+IdResourceToSaveChanges;
	        ShowInfo("permanent", DonaCadenaJSON(Msg_Modifications_sent));
	}
	
	//Miro si hi han hagut canvis en els rols dels quals jo no m'he enterat (si hi ha canvis ja es posa a true)
	RecuperaCanvisARolesATargetsOfAFeedback();
	if (TargetsOfAFeedbackHaveChanged)
	{
		if (TargetsOfAFeedback.length)
		{
			for (var item=0; item<TargetsOfAFeedback.length; item++)
					s2+="&TARGET_"+(item+1)+"="+TargetsOfAFeedback[item].id_target+"&TARGET_ROLE_"+(item+1)+"="+TargetsOfAFeedback[item].role;
		}
		else //abans n'hi havia i ara no, escriure TARGET_1 immplica que si hi havia targets d'aquesta valoració, s'esborraran
			s2+="&TARGET_1=";
	}

	if (PublicsOfAFeedbackHaveChanged)
	{
		if (PublicsOfAFeedback.length)
		{
			for (var item=0; item<PublicsOfAFeedback.length; item++)
					s2+="&PUB_"+(item+1)+"="+PublicsOfAFeedback[item];
		}
		else //abans n'hi havia i ara no, escriure PUB_1 immplica que si hi havia publicacions d'aquesta valoració, s'esborraràn
			s2+="&PUB_1=";
	}

	ajaxExecuteNB=new Ajax();	
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_RESOURCE:"+s+"&LANGUAGE="+LanguagesNB[document.account_form.language.selectedIndex]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
				+"&TYPE=FEEDBACK"+"&TITLE="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.title.value)+
				"&REASON="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.reason.value)+"&ABSTRACT="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.abstract.value)+
				"&CONTACT_ROLE="+DonaCadenaCodelistDeSelect(document.feedback_resource_form.contactRole)+"&COMMENT="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.comment.value)+
				"&MOTIVATION="+DonaCadenaCodelistDeSelect(document.feedback_resource_form.motivation)+"&RATING="+DonaCadenaCodelistDeRadio(document.feedback_resource_form.rating)+s2, AvaluaResposta, "text/xml", 
				"SurtDeFeedbackResourceChangesCallBack");
			
/*
alert(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_RESOURCE:"+s+"&LANGUAGE="+LanguagesNB[document.account_form.language.selectedIndex]+
"&TYPE=FEEDBACK"+"&TITLE="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.title.value)+
			"&REASON="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.reason.value)+"&ABSTRACT="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.abstract.value)+
				"&CONTACT_ROLE="+DonaCadenaCodelistDeSelect(document.feedback_resource_form.contactRole)+"&COMMENT="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.comment.value)+
				"&MOTIVATION="+DonaCadenaCodelistDeSelect(document.feedback_resource_form.motivation)+"&RATING="+DonaCadenaCodelistDeRadio(document.feedback_resource_form.rating)+s2, AvaluaResposta, "text/xml", 
				"SurtDeFeedbackResourceChangesCallBack");*/
				
	return false;
}

function SendCitationResourceChanges()
{
var s,s2;
	if (document.citation_resource_form.title.value=="")
	{
		ShowInfo("long", DonaCadenaIdNoPotSerBuit("title-citation-resource_screen"));
		return false;
	}
	RemoveInfo("long");
	if (IdResourceToSaveChanges=="")
	{
		s="CREATE";
		s2="";
	        ShowInfo("permanent", DonaCadenaJSON(Msg_Resource_sent));
	}
	else
	{
		s="MODIFY";
		s2="&RESOURCE="+IdResourceToSaveChanges;
	        ShowInfo("permanent", DonaCadenaJSON(Msg_Modifications_sent));
	}
	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_RESOURCE:"+s+"&LANGUAGE="+LanguagesNB[document.account_form.language.selectedIndex]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
				+"&TYPE=CITATION"+"&TITLE="+DonaCadenaPerValorDeFormulari(document.citation_resource_form.title.value)+
				"&EDITION="+DonaCadenaPerValorDeFormulari(document.citation_resource_form.edition.value)+"&EDITION_DATE="+DonaCadenaPerValorDeFormulari(document.citation_resource_form.edition_date.value)+
				"&ID_CODE="+DonaCadenaPerValorDeFormulari(document.citation_resource_form.id_code.value)+"&ID_NAMESPACE="+DonaCadenaPerValorDeFormulari(document.citation_resource_form.id_namespace.value)+
				"&SERIES_NAME="+DonaCadenaPerValorDeFormulari(document.citation_resource_form.series_name.value)+"&SERIES_ISSUE_ID="+DonaCadenaPerValorDeFormulari(document.citation_resource_form.series_issue.value)+
				"&SERIES_PAGE="+DonaCadenaPerValorDeFormulari(document.citation_resource_form.series_page.value)+"&OTHER_CIT_DETAILS="+DonaCadenaPerValorDeFormulari(document.citation_resource_form.other_cit_details.value)+
				"&URL_LINK="+DonaCadenaPerValorDeFormulari(document.citation_resource_form.url_link.value)+"&URL_DESCRIP="+DonaCadenaPerValorDeFormulari(document.citation_resource_form.url_descrip.value)+
				"&URL_FUNCTION="+DonaCadenaCodelistDeSelect(document.citation_resource_form.function_code)+s2, AvaluaResposta, "text/xml", 
				"SurtDeCitationResourceChangesCallBack");
	return false;
}

function SendPublicationResourceChanges()
{
var s,s2;
	if (document.publication_resource_form.title.value=="")
	{
		ShowInfo("long", DonaCadenaIdNoPotSerBuit("title-publication-resource_screen"));
		return false;
	}
	RemoveInfo("long");
	if (IdResourceToSaveChanges=="")
	{
		s="CREATE";
		s2="";
	        ShowInfo("permanent", DonaCadenaJSON(Msg_Resource_sent));
	}
	else
	{
		s="MODIFY";
		s2="&RESOURCE="+IdResourceToSaveChanges;
	        ShowInfo("permanent", DonaCadenaJSON(Msg_Modifications_sent));
	}
	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_RESOURCE:"+s+"&LANGUAGE="+LanguagesNB[document.account_form.language.selectedIndex]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
				+"&TYPE=PUBLICAT"+"&TITLE="+DonaCadenaPerValorDeFormulari(document.publication_resource_form.title.value)+
				"&EDITION="+DonaCadenaPerValorDeFormulari(document.publication_resource_form.edition.value)+"&EDITION_DATE="+DonaCadenaPerValorDeFormulari(document.publication_resource_form.edition_date.value)+
				"&ID_CODE="+DonaCadenaPerValorDeFormulari(document.publication_resource_form.id_code.value)+"&ID_NAMESPACE="+DonaCadenaPerValorDeFormulari(document.publication_resource_form.id_namespace.value)+
				"&SERIES_NAME="+DonaCadenaPerValorDeFormulari(document.publication_resource_form.series_name.value)+"&SERIES_ISSUE_ID="+DonaCadenaPerValorDeFormulari(document.publication_resource_form.series_issue.value)+
				"&SERIES_PAGE="+DonaCadenaPerValorDeFormulari(document.publication_resource_form.series_page.value)+"&OTHER_CIT_DETAILS="+DonaCadenaPerValorDeFormulari(document.publication_resource_form.other_cit_details.value)+
				"&URL_LINK="+DonaCadenaPerValorDeFormulari(document.publication_resource_form.url_link.value)+"&URL_DESCRIP="+DonaCadenaPerValorDeFormulari(document.publication_resource_form.url_descrip.value)+
				"&URL_FUNCTION="+DonaCadenaCodelistDeSelect(document.publication_resource_form.function_code)+"&CATEGORY="+DonaCadenaCodelistDeSelect(document.publication_resource_form.category_code)+
				"&ABSTRACT="+DonaCadenaPerValorDeFormulari(document.publication_resource_form.abstract.value)+s2, AvaluaResposta, "text/xml", 
				"SurtDePublicationResourceChangesCallBack");
	return false;
}

function SendResourceDelete(type)
{
var SurtDeResourceDeleteCallBack, s;

	s=DonaCadenaJSON(Msg_Sure_completely_delete_);

	if (type=="HREF")
		s+=DonaCadenaJSON(Msg_this_Hyperlink);
	else if (type=="POI")
		s+=DonaCadenaJSON(Msg_this_PoI);
	else if (type=="FEEDBACK")
		s+=DonaCadenaJSON(Msg_this_feedback_item);
	else if (type=="CITATION")
		s+=DonaCadenaJSON(Msg_this_citation);
	else if (type=="PUBLICAT")
		s+=DonaCadenaJSON(Msg_this_publication);
	else
	{
	        ShowInfo("long", DonaCadenaJSON(Msg_Unidentified_resource_type));
		return false;
	}
	s+="?";

	if (false==confirm(s))
		return false;

	if (type=="HREF")
		SurtDeResourceDeleteCallBack="SurtDeHRefResourceDeleteCallBack"
	else if (type=="POI")
		SurtDeResourceDeleteCallBack="SurtDePoiResourceDeleteCallBack"
	else if (type=="FEEDBACK")
		SurtDeResourceDeleteCallBack="SurtDeFeedbackResourceDeleteCallBack"
	else if (type=="CITATION")
		SurtDeResourceDeleteCallBack="SurtDeCitationResourceDeleteCallBack"
	else if (type=="PUBLICAT")
		SurtDeResourceDeleteCallBack="SurtDePublicationResourceDeleteCallBack"
	else
		return false;

	RemoveInfo("long");
	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_RESOURCE:DELETE&LANGUAGE="+LanguagesNB[document.account_form.language.selectedIndex]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
				+"&RESOURCE="+IdResourceToSaveChanges,
				 AvaluaResposta, "text/xml", SurtDeResourceDeleteCallBack);
        ShowInfo("permanent", DonaCadenaJSON(Msg_Request_sent));
	return false;
}

function SurtDeHRefResourceChanges(avis)
{
	if (avis)
	{
		if (false==confirm(DonaCadenaJSON(Msg_Exit_without_saving_changes)))
			return false;
	}
	ChangePannel("resources", true);
}

function SurtDeHRefResourceChangesCallBack()
{
	ShowInfo("short", DonaCadenaJSON(Msg_Changes_sent));
	SurtDeHRefResourceChanges(false);
	EnumerateResources(1, {"type_enum":"resources", "make_pannel_visible":true});
}

function SurtDeHRefResourceDeleteCallBack()
{
	ShowInfo("short", DonaCadenaJSON(Msg_Hyperlink_deleted));
	SurtDeHRefResourceChanges(false);
	EnumerateResources(1, {"type_enum":"resources", "make_pannel_visible":true});
}

function SurtDePoiResourceChanges(avis)
{
	if (avis)
	{
		if (false==confirm(DonaCadenaJSON(Msg_Exit_without_saving_changes)))
			return false;
	}
	ChangePannel("resources", true);
}

function SurtDePoiResourceChangesCallBack()
{
	ShowInfo("short", DonaCadenaJSON(Msg_Changes_sent));
	SurtDePoiResourceChanges(false);
	EnumerateResources(1, {"type_enum":"resources", "make_pannel_visible":true});
}

function SurtDePoiResourceDeleteCallBack()
{
	ShowInfo("short", DonaCadenaJSON(Msg_PoI_deleted));
	SurtDePoiResourceChanges(false);
	EnumerateResources(1, {"type_enum":"resources", "make_pannel_visible":true});
}

function GetPoiFromDeviceCallBack(position) 
{
var d;
	setTimeout("RemoveInfo('permanent');ShowInfo('short', DonaCadenaJSON(Msg_Done));", 1200);
	
	document.poi_resource_form.long.value=position.coords.longitude;
	/*document.getElementById("long-poi-resource_alert").style.display='inline';
	document.getElementById("long-poi-resource_alert").innerHTML=DonaCadenaJSON(Msg_Accuracy)+": "+position.coords.accuracy+" m";*/
	document.poi_resource_form.lat.value=position.coords.latitude;
	/*document.getElementById("lat-poi-resource_alert").style.display='inline';
	document.getElementById("lat-poi-resource_alert").innerHTML=DonaCadenaJSON(Msg_Accuracy)+": "+position.coords.accuracy+" m";*/
	document.poi_resource_form.pos_accur.value=position.coords.accuracy+"m";

	if (position.coords.altitude)
	{
		document.poi_resource_form.elevation.value=position.coords.altitude;
		document.getElementById("elevation-poi-resource_alert").style.display='inline';
		if (position.coords.coords.altitudeAccuracy)
			document.getElementById("elevation-poi-resource_alert").innerHTML=DonaCadenaJSON(Msg_Accuracy)+": "+position.coords.coords.altitudeAccuracy+" m";
	}
	document.getElementById("reason-poi-resource_alert").style.display='inline';
	d = new Date(position.timestamp);
	document.getElementById("reason-poi-resource_alert").innerHTML=DonaCadenaJSON(Msg_Got_it_at) + ": " + DonaDataJSComAText(d) +". ";
	if (position.coords.speed && position.coords.speed!=0.0)
	{
		document.getElementById("reason-poi-resource_alert").innerHTML+=DonaCadenaJSON(Msg_Speed)+": "+position.coords.speed*3.6 + " km/h. ";
		if (position.coords.heading)
			document.getElementById("reason-poi-resource_alert").innerHTML+=DonaCadenaJSON(Msg_Heading)+": "+position.coords.heading + ".";
	}
}

function GetPoiFromDeviceErrorCallBack(error)
{
	switch (error.code) 
	{
		case error.PERMISSION_DENIED:
			ShowInfo("long", DonaCadenaJSON(Msg_Geolocation_denied));
			break;
	        case error.POSITION_UNAVAILABLE:
			ShowInfo("long", DonaCadenaJSON(Msg_Geolocation_unavailable));
			break;
        	case error.TIMEOUT:
			ShowInfo("long", DonaCadenaJSON(Msg_Geolocation_timed_out));
			break;
		case error.UNKNOWN_ERROR:
		default:
			ShowInfo("long", DonaCadenaJSON(Msg_Geolocation_unkown_error));
			break;
	}
}

var TimeOutGPS=0;

function GetPoiFromDevice()
{
	if (navigator.geolocation) 
	{
		ShowInfo("permanent", DonaCadenaJSON(Msg_Geolocation_trying));
		navigator.geolocation.getCurrentPosition(GetPoiFromDeviceCallBack, GetPoiFromDeviceErrorCallBack);		
		if (TimeOutGPS)
			clearTimeout(TimeOutGPS);
		TimeOutGPS=setTimeout("ShowInfo('short', DonaCadenaJSON(Msg_Trying_get_more_accuracy));navigator.geolocation.getCurrentPosition(GetPoiFromDeviceCallBack, GetPoiFromDeviceErrorCallBack, {maximumAge:600000, timeout:12000, enableHighAccuracy: true});", 1800);
	}
	else 
		ShowInfo("long", DonaCadenaJSON(Msg_Geolocation_not_supported));
}

function SurtDeFeedbackResourceChanges(avis)
{
	if (avis)
	{
		if (false==confirm(DonaCadenaJSON(Msg_Exit_without_saving_changes)))
			return false;
	}
	//Si cal ja he enviat els canvis en els targets
	TargetsOfAFeedbackHaveChanged=false;
	PublicsOfAFeedbackHaveChanged=false;
	
	if (ActionAfterSignIn==TancaFinestraNimmbus)
		ActionAfterSignIn(ParamActionAfterSignIn);
	else
		ChangePannel("resources", true);
}

function SurtDeFeedbackResourceChangesCallBack()
{
	ShowInfo("short", DonaCadenaJSON(Msg_Changes_sent));
	SurtDeFeedbackResourceChanges(false);
	EnumerateResources(1, {"type_enum":"resources", "make_pannel_visible":true});
}

function SurtDeFeedbackResourceDeleteCallBack()
{
	ShowInfo("short", DonaCadenaJSON(Msg_Feedback_deleted));
	SurtDeFeedbackResourceChanges(false);
	EnumerateResources(1, {"type_enum":"resources", "make_pannel_visible":true});
}

function SurtDeCitationResourceChanges(avis)
{
	if (avis)
	{
		if (false==confirm(DonaCadenaJSON(Msg_Exit_without_saving_changes)))
			return false;
	}
	ChangePannel("resources", true);
}

function SurtDeCitationResourceChangesCallBack()
{
	ShowInfo("short", DonaCadenaJSON(Msg_Changes_sent));
	SurtDeCitationResourceChanges(false);
	EnumerateResources(1, {"type_enum":"resources", "make_pannel_visible":true});
}

function SurtDeCitationResourceDeleteCallBack()
{
	ShowInfo("short", DonaCadenaJSON(Msg_Citation_deteled));
	SurtDeCitationResourceChanges(false);
	EnumerateResources(1, {"type_enum":"resources", "make_pannel_visible":true});
}

function SurtDePublicationResourceChanges(avis)
{
	if (avis)
	{
		if (false==confirm(DonaCadenaJSON(Msg_Exit_without_saving_changes)))
			return false;
	}
	ChangePannel("resources", true);
}

function SurtDePublicationResourceChangesCallBack()
{
	ShowInfo("short", DonaCadenaJSON(Msg_Changes_sent));
	SurtDePublicationResourceChanges(false);
	EnumerateResources(1, {"type_enum":"resources", "make_pannel_visible":true});
}

function SurtDePublicationResourceDeleteCallBack()
{
	ShowInfo("short", DonaCadenaJSON(Msg_Publication_deteled));
	SurtDePublicationResourceChanges(false);
	EnumerateResources(1, {"type_enum":"resources", "make_pannel_visible":true});
}

function EntraAAccountCallBack()
{
	document.sign_in.user.value=document.sign_up.user.value;
	document.sign_in.pass.value=document.sign_up.pass.value; 
	document.sign_up.user.value="";
	document.sign_up.pass.value=""; 
	document.getElementById("main-left-pannel-date-text").innerHTML=DonaCadenaJSON(Msg_Today);

	EntraANimmbus(true);
	MostraAccount(true);
}

function SignUpNB(name_fn_callback)
{
	RemoveInfo("long");
	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, document.sign_up.user, document.sign_up.pass);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_USER:CREATE&LANGUAGE="+LanguagesNB[ActiveLanguage]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_up.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_up.pass.value)
				, AvaluaResposta, "text/xml", name_fn_callback);
        ShowInfo("permanent", DonaCadenaJSON(Msg_Message_sent));
	return false;
}

function EntraANewAccountCallBack()
{
	//document.getElementById("new-user-page").style.visibility="hidden";
	document.sign_in.user.value=document.new_user_form.new_user.value;
	document.sign_in.pass.value=document.new_user_form.new_pass.value; 
	document.sign_up.user.value="";
	document.sign_up.pass.value=""; 
	document.getElementById("main-left-pannel-date-text").innerHTML=DonaCadenaJSON(Msg_Today);

	EntraANimmbus(true);
	MostraAccount(true);
}

function SendNewUserNB()
{
var s;
	RemoveInfo("long");

	if (PendingToken=="")
		s="";
	else
		s="&TOKEN="+PendingToken;

	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, document.new_user_form.new_user, document.new_user_form.new_pass);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_USER:CREATE&LANGUAGE="+LanguagesNB[ActiveLanguage]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.new_user_form.new_user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.new_user_form.new_pass.value)
				+"&EMAIL="+DonaCadenaPerValorDeFormulari(document.new_user_form.email.value)+s, AvaluaResposta, "text/xml", "EntraANewAccountCallBack");
        ShowInfo("permanent", DonaCadenaJSON(Msg_Message_sent));
	return false;
}

function TancaFinestraNimmbus()
{
	window.onbeforeunload=null;
	window.close();
}

function EntraANimmbus(es_nou)
{
	//document.getElementById("front-page").style.visibility="hidden";
	//document.getElementById("main-page").style.visibility="visible";
	//ChangePannel("main-page", true);
	if (es_nou)
		document.getElementById("new-resource").style.display="none";
	document.getElementById("main-left-pannel-title-text").innerHTML=document.sign_in.user.value;  //This is going to be replaced by the name and surname latter.
	document.getElementById("main-left-pannel-subtitle-text").innerHTML=document.sign_in.user.value;
}

function EntraANimmbusMain()
{
	EntraANimmbus(false);
	RetrieveUserMinPreferences();
	EnumerateResources(1, {"type_enum":"resources", "make_pannel_visible":true});
}

function EntraAResetPassword()
{
	//document.getElementById("front-page").style.visibility="hidden";
	//document.getElementById("reset-pass-page").style.visibility="visible";
	ChangePannel("reset-pass-page",true);
}

function EntraANewPassword()
{
	//document.getElementById("front-page").style.visibility="hidden";
	//document.getElementById("new-pass-page").style.visibility="visible";
	ChangePannel("new-pass-page",true);
}

function EntraANewUser(email)
{
	//document.getElementById("front-page").style.visibility="hidden";
	//document.getElementById("new-user-page").style.visibility="visible";
	ChangePannel("new-user-page",true);	
	document.new_user_form.email.value=email;
}

function EntraAExecuteToken()
{
	//document.getElementById("front-page").style.visibility="hidden";
	//document.getElementById("execute-token-page").style.visibility="visible";
	ChangePannel("execute-token-page",true);	
	if (document.getElementById("execute-token-subtitle-text").innerHTML!="")
	        document.title = document.getElementById("execute-token-subtitle-text").innerHTML;
	ajaxExecuteNB=new Ajax();
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_TOKEN:EXECUTE&LANGUAGE="+LanguagesNB[ActiveLanguage]+
				"&TOKEN="+PendingToken+"&USER="+document.sign_in.user.value, AvaluaResposta, "text/xml", 
				"SurtDeExecuteTokenCallBack");
        ShowInfo("permanent", DonaCadenaJSON(Msg_Requesting));
}

function EntraAIdentificioNimmbus()
{
	ChangePannel("front-page", true);
}

function SurtDeExecuteTokenCallBack()
{
	//document.getElementById("execute-token-page").style.visibility="hidden";
	EntraAIdentificioNimmbus();
}

function SurtDeResetPasswordCallBack()
{
	//document.getElementById("reset-pass-page").style.visibility="hidden";
	EntraAIdentificioNimmbus();
}

function SurtDeNewPasswordCallBack()
{
	//document.getElementById("new-pass-page").style.visibility="hidden";
	EntraAIdentificioNimmbus();
}

function SurtDeNimmbus()
{
	SurtDeAccount();
	//document.getElementById("main-page").style.visibility="hidden";
	//document.getElementById("resources").style.visibility="hidden";
	EntraAIdentificioNimmbus();
	//window.scrollTo(0, 0);
}

function SurtDeAccount()
{
	ChangePannel("resources", false);
	document.getElementById("new_user_alert").style.display="none";
	document.getElementById("current_pass_alert").style.display="none";
	document.getElementById("new_pass_alert").style.display="none";
	document.getElementById("new_pass_valid_alert").style.display="none";
	document.getElementById("new-resource").style.display="inline";
	AccessToken="";
	AccessTokenType="";
}

/*function SurtDeShare()
{
	ChangePannel("resources", true);
	return false;
}*/

function SurtIRetornaAResources()
{
	ChangePannel("resources", true);
	return false;
}

function SurtDeAccountCallBack()
{
	if (document.account_form.new_pass.value!="")
		document.sign_in.pass.value=document.account_form.new_pass.value;
	if (document.sign_in.user.value!=document.account_form.new_user.value)
		document.sign_in.user.value=document.account_form.new_user.value;
	document.getElementById("main-left-pannel-title-text").innerHTML=document.account_form.name.value;

	ChangeLanguage(ActiveLanguage=document.account_form.language.selectedIndex, ResourcesPerPage);
	ShowInfo("short", DonaCadenaJSON(Msg_Changes_sent));
	SurtDeAccount();
	if (ActionAfterSignIn)
		ActionAfterSignIn(ParamActionAfterSignIn);
	else
		ChangePannel("resources", true);
}

function SendAccountChanges()
{
	if (NewUserChangeTimeOut)
		clearTimeout(NewUserChangeTimeOut);
	if (document.account_form.current_pass.value!="" && document.account_form.current_pass.value!=document.sign_in.pass.value)
	{
		ShowInfo("long", DonaCadenaJSON(Msg_Current_pwd_not_match_provided));
		return false;
	}
	if (document.account_form.new_pass.value!="" && document.account_form.new_pass.value!=document.account_form.new_pass_valid.value)
	{
		ShowInfo("long", DonaCadenaJSON(Msg_New_pwd_not_match_validation));
		return false;
	}
	RemoveInfo("long");
	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_USER:MODIFY&LANGUAGE="+LanguagesNB[document.account_form.language.selectedIndex]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
				+"&NEW_USER="+((document.account_form.new_user.value==document.sign_in.user.value) ? "" : DonaCadenaPerValorDeFormulari(document.account_form.new_user.value))+"&NEW_PASSWORD="+DonaCadenaPerValorDeFormulari(document.account_form.new_pass.value)+
				"&EMAIL="+DonaCadenaPerValorDeFormulari(document.account_form.email.value)+"&NAME="+DonaCadenaPerValorDeFormulari(document.account_form.name.value)+"&BIO="+DonaCadenaPerValorDeFormulari(document.account_form.bio.value), AvaluaResposta, "text/xml", 
				"SurtDeAccountCallBack");
        ShowInfo("permanent", DonaCadenaJSON(Msg_Message_sent));
	return false;
}

function SendPasswordReset()
{
	ajaxExecuteNB=new Ajax();
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_USER:RESETPASSWORD&LANGUAGE="+LanguagesNB[ActiveLanguage]+
				"&USER="+DonaCadenaPerValorDeFormulari(document.reset_pass_form.user.value), AvaluaResposta, "text/xml", 
				"SurtDeResetPasswordCallBack");
        ShowInfo("permanent", DonaCadenaJSON(Msg_Searching_));
	return false;
}

function SendNewPasswordToken()
{
	ajaxExecuteNB=new Ajax();
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_TOKEN:EXECUTE&LANGUAGE="+LanguagesNB[ActiveLanguage]+
				"&TOKEN="+PendingToken+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.new_pass_form.new_pass.value), AvaluaResposta, "text/xml", 
				"SurtDeNewPasswordCallBack");
        ShowInfo("permanent", DonaCadenaJSON(Msg_Changing_));
	return false;
}

function GetWPSProcessIdentifierName(root)
{
var process, identifier;
	process=GetXMLElementByName(root, "wps", "Process");
	if (process)
	{
		identifier=GetXMLElementByName(process, "ows", "Identifier");
		if (identifier)
			return identifier.childNodes[0].nodeValue;
	}
	return null;
}


var NewUserChangeTimeOut=0;
var NewPassChangeTimeOut=0;

function EscriuStatusAElement(doc, user_pass)
{
var root, output, identifier, process_name;
var elem;

	elem=document.getElementById(user_pass.alert_id);
	root=DonaRootXML(doc, document);
	if (!root || AnalitzaExceptionReport(root, document))
	{
		NewUserChangeTimeOut=0;
		NewPassChangeTimeOut=0;
		elem.style.display="none";
		return;
	}

	process_name=GetWPSProcessIdentifierName(root);
	output=GetXMLElementCollectionByName(root, "wps", "Output");

	if (process_name && output && output.length)
	{
		for (var item=0; item<output.length; item++)
		{
			identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
			if (identifier && identifier.childNodes[0].nodeValue=="statusCode")
			{					
				var s=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				if (s!="")
				{
					if (process_name=="NB_USER:AVAILABLE")
					{
						if (s=="available")
							elem.innerHTML=DonaCadenaJSON(Msg_Available_);
						else if (s=="empty")
							elem.innerHTML=DonaCadenaJSON(Msg_Username_cannot_be_blank);
						else if (s=="same")
							elem.innerHTML=DonaCadenaJSON(Msg_Username_is_what_you_have);
						else if (s=="taken")
							elem.innerHTML=DonaCadenaJSON(Msg_Username_already_taken);							
						UpdateLastServer();
					}
					else if (process_name=="NB_USER:GOODPASSWORD")
					{
						if (s=="strong")
							elem.innerHTML=DonaCadenaJSON(Msg_Strong);
						else if (s=="medium")
							elem.innerHTML=DonaCadenaJSON(Msg_Medium);
						else if (s=="weak")
							elem.innerHTML=DonaCadenaJSON(Msg_Weak);
						else if (s=="user")
							elem.innerHTML=DonaCadenaJSON(Msg_Cannot_contain_username);							
						else if (s=="short")
							elem.innerHTML=DonaCadenaJSON(Msg_Too_short);							
						CheckPassValidCorrectness(user_pass.pass_valid_alert_id, user_pass.pass, user_pass.pass_valid);
						UpdateLastServer();
					}
					else
					{
						alert("Known process id: "+ process_name);
						TiraAPantallaRespostaSiNoEntenc(root, document);
						elem.style.display="none";
					}
				}
			}
		}
	}
	else
	{
		TiraAPantallaRespostaSiNoEntenc(root, document);
		elem.style.display="none";
	}
	NewUserChangeTimeOut=0;
	NewPassChangeTimeOut=0;
	return;
}


function CheckNewUserCorrectness(alert_id, new_user, user)
{
	elem=document.getElementById(alert_id);
	elem.style.display="inline";
	elem.innerHTML=DonaCadenaJSON(Msg_Checking);
	var user_pass = {alert_id:alert_id};
	ajaxExecuteNB=new Ajax();
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_USER:AVAILABLE&LANGUAGE="+LanguagesNB[document.account_form.language.selectedIndex]+"&USER="+DonaCadenaPerValorDeFormulari(user)+
				"&NEW_USER="+DonaCadenaPerValorDeFormulari(new_user), EscriuStatusAElement, "text/xml", 
				user_pass);
}

function NewUserInputChange()
{
	if (NewUserChangeTimeOut==0)
		NewUserChangeTimeOut=setTimeout("CheckNewUserCorrectness(\"new_user_alert\", document.account_form.new_user.value, document.sign_in.user.value);",1500);
}

function NewUserUserInputChange()
{
	if (document.new_user_form.new_user.value=="")
	{
		document.getElementById("new-user_new_user_alert").style.display="none";
		return;
	}
	if (NewUserChangeTimeOut==0)
		NewUserChangeTimeOut=setTimeout("CheckNewUserCorrectness(\"new-user_new_user_alert\", document.new_user_form.new_user.value, \"\");",1500);
}

function SignUpUserInputChange()
{
	if (document.sign_up.user.value=="")
	{
		document.getElementById("sign_up_user_alert").style.display="none";
		return;
	}
	if (NewUserChangeTimeOut==0)
		NewUserChangeTimeOut=setTimeout("CheckNewUserCorrectness(\"sign_up_user_alert\", document.sign_up.user.value, \"\");",1500);
}

function CheckNewPassCorrectness(pass_alert_id, pass_valid_alert_id, user, pass, pass_valid)
{
	elem=document.getElementById(pass_alert_id);
	if (pass=="")
	{
		NewPassChangeTimeOut=0;
		elem.style.display="none";
		return;
	}
	elem.style.display="inline";
	elem.innerHTML=DonaCadenaJSON(Msg_Checking);
	var user_pass = {alert_id:pass_alert_id, pass_valid_alert_id:pass_valid_alert_id, pass:pass, pass_valid:pass_valid};
	ajaxExecuteNB=new Ajax();
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_USER:GOODPASSWORD&LANGUAGE="+LanguagesNB[document.account_form.language.selectedIndex]+"&USER="+DonaCadenaPerValorDeFormulari(user) +
				"&PASSWORD="+DonaCadenaPerValorDeFormulari(pass), EscriuStatusAElement, "text/xml", user_pass);
}

function NewPassInputChange()
{
	if (NewPassChangeTimeOut==0)
		NewPassChangeTimeOut=setTimeout("CheckNewPassCorrectness(\"new_pass_alert\", \"new_pass_valid_alert\", (document.account_form.new_user.value==\"\") ? document.sign_in.user.value : document.account_form.new_user.value, document.account_form.new_pass.value, document.account_form.new_pass_valid.value);",1500);
}

function NewPassNewPassInputChange()
{
	if (NewPassChangeTimeOut==0)
		NewPassChangeTimeOut=setTimeout("CheckNewPassCorrectness(\"new-pass_new_pass_alert\", \"new-pass_new_pass_valid_alert\", \"Cadena$$Improbable\", document.new_pass_form.new_pass.value, document.new_pass_form.new_pass_valid.value);",1500);
}

function NewUserPassInputChange()
{
	if (NewPassChangeTimeOut==0)
		NewPassChangeTimeOut=setTimeout("CheckNewPassCorrectness(\"new-user_new_pass_alert\", \"new-user_new_pass_valid_alert\", \"Cadena$$Improbable\", document.new_user_form.new_pass.value, document.new_user_form.new_pass_valid.value);",1500);
}

function SignUpPassInputChange()
{
	if (NewPassChangeTimeOut==0)
		NewPassChangeTimeOut=setTimeout("CheckNewPassCorrectness(\"sign_up_pass_alert\", \"sign_up_pass_valid_alert\", document.sign_up.user.value, document.sign_up.pass.value, document.sign_up.pass_valid.value);",1500);
}

var PassValidChangeTimeOut=0;

function CheckPassValidCorrectness(alert_id, pass, pass_valid)
{
	if (pass=="" || pass_valid=="") 
	{
		document.getElementById(alert_id).style.display="none";
	}
	else
	{
		document.getElementById(alert_id).style.display="inline";

		if (pass==pass_valid)
			document.getElementById(alert_id).innerHTML=DonaCadenaJSON(Msg_Ok);
		else
			document.getElementById(alert_id).innerHTML=DonaCadenaJSON(Msg_Pwd_verification_error);
	}
	PassValidChangeTimeOut=0;
	return;
}

function PassValidInputChange()
{
	if (PassValidChangeTimeOut==0)
		PassValidChangeTimeOut=setTimeout("CheckPassValidCorrectness(\"new_pass_valid_alert\", document.account_form.new_pass.value, document.account_form.new_pass_valid.value);",1500);
}


function NewPassPassValidInputChange()
{
	if (PassValidChangeTimeOut==0)
		PassValidChangeTimeOut=setTimeout("CheckPassValidCorrectness(\"new-pass_new_pass_valid_alert\", document.new_pass_form.new_pass.value, document.new_pass_form.new_pass_valid.value);",1500);
}

function NewUserPassValidInputChange()
{
	if (PassValidChangeTimeOut==0)
		PassValidChangeTimeOut=setTimeout("CheckPassValidCorrectness(\"new-user_new_pass_valid_alert\", document.new_user_form.new_pass.value, document.new_user_form.new_pass_valid.value);",1500);
}

function SignUpPassValidInputChange()
{
	if (PassValidChangeTimeOut==0)
		PassValidChangeTimeOut=setTimeout("CheckPassValidCorrectness(\"sign_up_pass_valid_alert\", document.sign_up.pass.value, document.sign_up.pass_valid.value);",1500);
}

var CurrentPassChangeTimeOut=0;

function CheckCurrentPassCorrectness()
{
	if (document.account_form.current_pass.value=="") 
	{
		document.getElementById("new_pass_alert").style.display="none";
	}
	else
	{
		document.getElementById("current_pass_alert").style.display="inline";
	
		if (document.account_form.current_pass.value==document.sign_in.pass.value)
			document.getElementById("current_pass_alert").innerHTML=DonaCadenaJSON(Msg_Ok);
		else
			document.getElementById("current_pass_alert").innerHTML=DonaCadenaJSON(Msg_Wrong_pwd);
	}
	CurrentPassChangeTimeOut=0;
	return;
}

function CurrentPassInputChange()
{
	if (CurrentPassChangeTimeOut==0)
		CurrentPassChangeTimeOut=setTimeout("CheckCurrentPassCorrectness();",1500);
}

</script>

<script async defer src="https://apis.google.com/js/api.js" onload="this.onload=function(){};HandleGoogleApiLibrary()" onreadystatechange="if (this.readyState === 'complete') this.onload()"></script>

</head>


<body onLoad="InitFrontPage();">

<div class="long-note-outer">
<div id="long-note" class="note-inner"></div>
</div>

<div class="short-note-outer">
<div id="short-note" class="note-inner"></div>
</div>

<!-- *** IDENTIFICATION FRONT PAGE *** -->

<div id="front-page">

<div class="front-bg">
<img src="topoorto.jpg" style="display: block;">
</div>


<div class="front-welcome-text">
<h1 id="front-welcome-text-title" style="line-height: normal; margin: 0px">Benvinguts al NiMMbus.</h1>
<p id="front-welcome-text-subtitle" style="margin: 10px"></p>
<br>
<img src="NiMMbus.png" style="display: block;">
<table><tr><td><img src="nextgeoss36.png" style="display: block;"><img src="prj730329.png" style="display: block;"></td><td><img src="OGC_WPS_GUF.png" width="100" style="display: block;"></td></tr></table>
<br>
<table style="width: 100%"><tr><td style="text-align: left; width: 27%"><p class="front-conditions-text"><a id="welcome-terms_of_use" href="TermsOfUse.htm" style="color: #CCD6DD">Terms_of_use</a></p></td>
	<td style="text-align: center; width: 33%"><p class="front-conditions-text"><a id="welcome-privacy_statement" href="PrivacyStatement.htm" style="color: #CCD6DD">Privacy_Statement</a></p></td>
	<td style="text-align: right"><p id="welcome-last_updated" class="front-conditions-text"><i>Last_updated_October_2_2018</i></p></td></tr></table>
</div>

<div class="front-language">
<a class="dropdown-language" id="dropdown-language" onClick="SwitchDropDownList('dropdown-language', 'front-language-list');">
<span id="front-language-lang">
Language: English
</span>
<b class="caret"></b>
</a>
</div>

<div id="front-language-list" class="dropdown-list" style="left: 85%; top: 70px; width: 70px; height: 70px;">
<div class="dropdown-caret">
<span class="caret-outer"></span>
<span class="caret-inner"></span>
</div>
<a class="dropdown-list_active" onClick="ChangeLanguage(0, ResourcesPerPage);SwitchDropDownList('dropdown-language', 'front-language-list');">
Català</a>
<a class="dropdown-list_active" onClick="ChangeLanguage(1, ResourcesPerPage);SwitchDropDownList('dropdown-language', 'front-language-list');">
Español</a>
<a class="dropdown-list_active" onClick="ChangeLanguage(2, ResourcesPerPage);SwitchDropDownList('dropdown-language', 'front-language-list');">
English</a>
</div>

<div class="white-area" style="left: 50%; top: 275px; width: 306px; height: 80px;">
<form id="sign_in" name="sign_in" class="packet_paragraph" method="get" onSubmit="return SignInNB();">
<h2 id="front-signin-nimmbus-lang" class="white-area-title"></h2>
<p class="packet_paragraph"><input id="sign_in_user" type="text" size="80" maxlength="79" class="text-input" style="width: 296px;" name="user" value="" placeholder="Username" autocomplete="on"></p>
<p class="packet_paragraph"><input id="sign_in_pass" type="password" size="50" maxlength="39" class="text-input" name="pass" value="" style="width: 140px;" placeholder="Password">
<input id="sign_in_btn" class="submit_btn" type="submit" value="Sign in"></p>
<p class="packet_paragraph"><a id="sign_in_forgot" class="text_button" onClick="EntraAResetPassword();">Forgot password?</a></p>
</form>
</div>

<div class="white-area" style="left: 50%; top: 463px; width: 306px; height: 130px;">
<form id="sign_up" name="sign_up" class="packet_paragraph" method="get" onSubmit='return SignUpNB("EntraAAccountCallBack");'>
<h2 id="front-signup-lang" class="white-area-title">New to NiMMbus? Sign up:</h2>
<p id="sign_up_user_alert" class="packet_paragraph" style="display: none;"></p>
<p class="packet_paragraph"><input id="sign_up_user" type="text" size="80" maxlength="79" class="text-input" style="width: 296px;" name="user" value="" placeholder="Username" onkeyup="SignUpUserInputChange();" onpaste="SignUpUserInputChange();" oninput="SignUpUserInputChange();"></p>
<p id="sign_up_pass_alert" class="packet_paragraph" style="display: none;"></p>
<p class="packet_paragraph"><input id="sign_up_pass" type="password" size="80" maxlength="39" class="text-input" style="width: 296px;" name="pass" value="" placeholder="Password" onkeyup="SignUpPassInputChange();" onpaste="SignUpPassInputChange();" oninput="SignUpPassInputChange();"></p>
<p id="sign_up_pass_valid_alert" class="packet_paragraph" style="display: none;"></p>
<p class="packet_paragraph"><input id="sign_up_pass_valid" type="password" size="80" maxlength="39" class="text-input" style="width: 296px;" name="pass_valid" value="" placeholder="Password" onkeyup="SignUpPassValidInputChange();" onpaste="SignUpPassValidInputChange();" oninput="SignUpPassValidInputChange();"></p>
<p class="packet_paragraph"><input id="sign_up_btn" class="submit_btn" type="submit" value="Sign up for NiMMbus"></p>
</form>
</div>

<div class="white-area" style="left: 50%; top: 130px; width: 306px;">
<h2 id="front-signin-external-lang" class="white-area-title"></h2>
<button id="nextgeoss-button" class="submit_btn" disabled onClick="ValidaSSONextGEOSS(true, SignInNBNextGEOSS, null);">NextGEOSS</button>
<button id="landsense-button" class="submit_btn" disabled onClick="ValidaSSOLandSense(true, SignInNBLandSense, null);">LandSense</button>
<br>
<button id="google-button" class="submit_btn" disabled onClick="ValidaSSOGoogle();">Google</button>
<button id="sso-debug-button" class="submit_btn" disabled onClick="ValidaSSODebug();" style="display: none;">Debug</button>
</div>

</div>  <!--End of id="front-page" -->


<!-- *** MAIN PAGE *** -->
<div id="main-page" style="visibility: hidden;">

<div class="front-bg" style="top: 40px;">
<img src="cloudbackgroud.jpg" style="display: block;">
</div>

<!-- *** MAIN PAGE TOP BAR *** -->

<div class="main-page-bar">
<span style="left: 100px; top:0px; position: absolute; font-size: 20px;">
<img src="nimmbus_icon.png" style="vertical-align: bottom;"/> NiMMbus<sup>Beta</sup> &nbsp;&nbsp; <img src="nextgeoss30.png" style="vertical-align: bottom;"/>
</span>

<span style="left: 85%; top:5px; position: absolute;">
<a target="_blank" href="help/help.htm"><img src="help.png" style="vertical-align: bottom;" /></a>
<a id="dropdown-settings" onClick="SwitchDropDownList('dropdown-settings', 'settings-list');" onMouseOver="document.getElementById('settings-tooltip').style.opacity='1';" onMouseOut="document.getElementById('settings-tooltip').style.opacity='0';">
<img src="gear_icon.png" style="vertical-align: bottom;" />
</a>
</span>

<span id="settings-tooltip" class="tooltip" style="left: 87%; top:34px;">
<b class="tooltip-caret"></b><br>
<span id="settings-tooltip-text" class="tooltip-text">Settings</span>
</span>

<div id="settings-list" class="dropdown-list" style="left: 86%; top: 40px; width: 70px; height: 70px;">
<div class="dropdown-caret">
<span class="caret-outer"></span>
<span class="caret-inner"></span>
</div>
<a id="settings-profile" class="dropdown-list_active" onClick="SwitchDropDownList('dropdown-settings', 'settings-list');MostraAccount(false);">
Profile</a>
<a id="settings-signout" class="dropdown-list_active" onClick="SwitchDropDownList('dropdown-settings', 'settings-list');SurtDeNimmbus();">
Sign out</a>
</div>  <!--End of id="settings-list" -->
</div>  <!--End of class="main-page-bar" -->

<!-- *** MAIN PAGE LEFT PANNEL *** -->

<div id="main-left-pannel" class="white-area" style="left: 3%; top: 45px; width: 18%; height: 150px;">

<h2 id="main-left-pannel-title-text" class="white-area-title">User</h2>
<p id="main-left-pannel-subtitle-text" class="packet_paragraph">
<p class="packet_paragraph"><span id="main-left-pannel-since-text"></span>: <span id="main-left-pannel-date-text"></span></p>

<div id="new-resource" style="position:absolute; bottom: 20px: left: 20px;">
<form id="main-left-pannel_form" name="main_left_pannel_form" method="get" onSubmit="return false">

<p></p>

<input id="new-resource_btn" class="submit_btn" type="button" value="New" onClick="SwitchDropDownList('dropdown-new-resource', 'new-resource-list');" onMouseOver="document.getElementById('new-resource-tooltip').style.opacity='1';" onMouseOut="document.getElementById('new-resource-tooltip').style.opacity='0';"/>


<span id="new-resource-tooltip" class="tooltip" style="left: -17px; top:45px;">
<b class="tooltip-caret"></b><br>
<span id="new-resource-tooltip-text" class="tooltip-text">New resource</span>
</span>

<div id="new-resource-list" class="dropdown-list" style="left: -37px; top: 53px; width: 110px; height: 100px;">
<div class="dropdown-caret">
<span class="caret-outer"></span>
<span class="caret-inner"></span>
</div>
<a id="new-resource-href" class="dropdown-list_active" onClick="SwitchDropDownList('dropdown-new-resource', 'new-resource-list'); MostraHRefResource('');"></a>
<a id="new-resource-poi" class="dropdown-list_active" onClick="SwitchDropDownList('dropdown-new-resource', 'new-resource-list'); MostraPoiResource('');"></a>
<a id="new-resource-citation" class="dropdown-list_active" onClick="SwitchDropDownList('dropdown-new-resource', 'new-resource-list'); MostraCitationResource('');"></a>
<a id="new-resource-feedback" class="dropdown-list_active" onClick="SwitchDropDownList('dropdown-new-resource', 'new-resource-list'); MostraFeedbackResource('','');"></a>
<a id="new-resource-publication" class="dropdown-list_active" onClick="SwitchDropDownList('dropdown-new-resource', 'new-resource-list'); MostraPublicationResource('');"></a>
</div>  <!--End of id="new-resource-list" -->
</form>
</div>  <!--End of id="new-resource" -->
<br> 
<br>
<br>
<!--div id="conditions-left-pannel" style="display: inline;"-->
<table class="front-conditions-text-left-pannel" style="width: 100%;"><tr><td style="text-align: left; width: 50%"><a id="left-pannel-terms_of_use" target="_blank" href="TermsOfUse.htm" style="color: #CCCCCC">Terms_of_use</a>
	<br><a id="left-pannel-privacy_statement" target="_blank" href="PrivacyStatement.htm" style="color: #CCCCCC">Privacy_Statement</a></td>
	<td style="text-align: right"><a id="left-pannel-last_updated"><i>Last_updated<br>October_2_2018</i></a></td></tr></table>
<!--/div-->
</div>  <!--End of id="main-left-pannel" -->

<!-- *** RESOURCES RIGHT PANNEL *** -->

<div id="resources" class="white-area" style="left: 25%; top: 45px; width: 60%; height: auto;">
<h2 id="resources-title-text" class="white-area-title">Resources</h2>
<form id="resources_form" name="resources_form" method="get" onSubmit="return false">

<table style="width: 100%;"><tr><td id="resources-subtitle-text">List of resources.</td>
<td align="left">
	<label class="control-label" id="resource-type_screen" for="resource-type_screen_value"></label>
	<select class="text-input" id="resource-type_screen_value" name="resource-type" onchange="EnumerateResources(1, {'type_enum':'resources', 'make_pannel_visible':true})">
	<option value="ALL" id="all-resource-type-value"></option>
	<option value="FEEDBACK" id="feedback-resource-type-value"></option>
	<option value="CITATION" id="citation-resource-type-value"></option>
	<option value="PUBLICAT" id="publicat-resource-type-value"></option>
	<option value="HREF" id="href-resource-type-value"></option>
	<option value="POI" id="poi-resource-type-value"></option>
	</select>
</td>
<td align="left">
	<label class="control-label" id="owner-type_screen" for="owner-type_screen_value"></label>
	<select class="text-input" id="owner-type_screen_value" name="owner-type" onchange="EnumerateResources(1, {'type_enum':'resources', 'make_pannel_visible':true})">
	<option value="ALL" id="all-owner-type-value"></option>
	<option value="ME" id="me-owner-type-value"></option>
	<option value="OTHERS" id="others-owner-type-value"></option>
	</select>
</td>
<td align="right"><span id="resources-hits-text">1-100 of 123</span> 

<input id="newer-resources_btn" class="submit_btn" type="button" value="<" onMouseOver="document.getElementById('newer-resources-tooltip').style.opacity='1';" onMouseOut="document.getElementById('newer-resources-tooltip').style.opacity='0';">
<input id="older-resources_btn" class="submit_btn" type="button" value=">" onMouseOver="document.getElementById('older-resources-tooltip').style.opacity='1';" onMouseOut="document.getElementById('older-resources-tooltip').style.opacity='0';">

<span id="newer-resources-tooltip" class="tooltip" style="right: 40px; top:86px;">
<b class="tooltip-caret"></b><br>
<span id="newer-resources-tooltip-text" class="tooltip-text">Newer</span>
</span>

<span id="older-resources-tooltip" class="tooltip" style="right: 0px; top:86px;">
<b class="tooltip-caret"></b><br>
<span id="older-resources-tooltip-text" class="tooltip-text">Older</span>
</span>

</td></tr></table>
</form>

<div id="resources-list" style="border-top: 1px solid #e1e8ed;"></div>
</div>  <!--End of id="resources" -->

<!-- *** RESOURCE SELECTOR *** -->

<div id="resource-selector" class="white-area" style="left: 25%; top: 45px; width: 60%; height: auto; visibility: hidden;">
<h2 id="resource-selector-title-text" class="white-area-title">Resources selector</h2>
<form id="resource_selector_form" name="resource_selector_form" method="get" onSubmit="return false">

<table style="width: 100%;"><tr><td id="resource-selector-subtitle-text">List of resources to be selected</td>
<td align="right"><span id="resource-selector-hits-text">1-10 of 12</span> 

<input id="newer-resource-selector_btn" class="submit_btn" type="button" value="<" onMouseOver="document.getElementById('newer-resource-selector-tooltip').style.opacity='1';" onMouseOut="document.getElementById('newer-resource-selector-tooltip').style.opacity='0';">
<input id="older-resource-selector_btn" class="submit_btn" type="button" value=">" onMouseOver="document.getElementById('older-resource-selector-tooltip').style.opacity='1';" onMouseOut="document.getElementById('older-resource-selector-tooltip').style.opacity='0';">

<span id="newer-resource-selector-tooltip" class="tooltip" style="right: 40px; top:86px;">
<b class="tooltip-caret"></b><br>
<span id="newer-resource-selector-tooltip-text" class="tooltip-text">Newer</span>
</span>

<span id="older-resource-selector-tooltip" class="tooltip" style="right: 0px; top:86px;">
<b class="tooltip-caret"></b><br>
<span id="older-resource-selector-tooltip-text" class="tooltip-text">Older</span>
</span>

</td></tr></table>
</form>

<div id="resource-selector-list" style="border-top: 1px solid #e1e8ed;"></div>
</div>  <!--End of id="resource-selector" -->


<!-- *** HREF DLG *** -->

<div id="href-resource" class="white-area" style="left: 25%; top: 45px; width: 60%; height: auto; visibility: hidden;">
<h2 id="href-resource-title-text" class="white-area-title">Resource</h2>
<p id="href-resource-subtitle-text">Change your basic resource and language settings.</p>

<form id="href-resource_form" name="href_resource_form" method="get" autocomplete="off" onSubmit="return SendHRefResourceChanges();">

<div id="title-href-resource_fieldset" class="control-group">
<label class="control-label" id="title-href-resource_screen" for="title-href-resource_screen_value"></label>
<div class="controls">
<input type="text" class="text-input" value="" id="title-href-resource_screen_value" name="title" style="width: 80%;" maxlength="254"/>
<p id="title-href-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="title-href-resource_fieldset" -->

<div id="href-href-resource_fieldset" class="control-group">
<label class="control-label" id="href-href-resource_screen" for="href-href-resource_screen_value"></label>
<div class="controls">
<p><input type="text" class="text-input" value="" id="href-href-resource_screen_value" name="href" maxlength="1999" style="width: 80%;"/></p>
<p id="href-href-resource_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="href-href-resource_fieldset" -->

<div id="mimetype-href-resource_fieldset" class="control-group">
<label class="control-label" id="mimetype-href-resource_screen" for="mimetype-href-resource_screen_value"></label>
<div class="controls">
<select class="text-input" id="mimetype-href-resource_screen_value" name="mimetype">
<option value="application/x-mmzx">MMZX</option>
<option value="application/x-mmz" selected="selected">MMZ</option>
<option value="application/x-zip-compressed">ZIP</option>
<option value="image/jpeg">JPEG</option>
<option value="image/png">PNG</option>
<option value="" id="other-mimetype-href-resource_value"></option>
</select>
<p id="mimetype-href-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="mimetype-href-resource_fieldset" -->

<div id="reason-href-resource_fieldset" class="control-group">
<label class="control-label" id="reason-href-resource_screen" for="reason-href-resource_screen_value"></label>
<div class="controls">
<textarea class="text-input" id="reason-href-resource_screen_value" name="reason" maxlength="1999" style="width: 80%; height: 60px;"></textarea>
<p id="reason-href-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="reason-href-resource_fieldset" -->

<div class="form-actions">
<input id="href-resource_btn" class="submit_btn" type="submit" value="Save changes" />
<input id="href-resource-delete_btn" class="submit_btn" type="button" value="Delete" onclick="SendResourceDelete('HREF');" />
<input id="href-resource-close_btn" class="submit_btn" type="button" value="Close" onclick="SurtDeHRefResourceChanges(true);" />
<input id="href-resource-exit_btn" class="submit_btn" type="button" value="Close" onclick="SurtDeHRefResourceChanges(false);" />
</div>

</form>

</div>  <!--End of id="href-resource" -->


<!-- *** POI DLG *** -->

<div id="poi-resource" class="white-area" style="left: 25%; top: 45px; width: 60%; height: auto; visibility: hidden;">
<h2 id="poi-resource-title-text" class="white-area-title"></h2>
<p id="poi-resource-subtitle-text"></p>

<form id="poi-resource_form" name="poi_resource_form" method="get" autocomplete="off" onSubmit="return SendPoiResourceChanges();">

<div id="title-poi-resource_fieldset" class="control-group">
<label class="control-label" id="title-poi-resource_screen" for="title-poi-resource_screen_value"></label>
<div class="controls">
<input type="text" class="text-input" value="" id="title-poi-resource_screen_value" name="title" style="width: 80%;" maxlength="254"/>
<p id="title-poi-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="title-poi-resource_fieldset" -->

<div id="long-poi-resource_fieldset" class="control-group">
<label class="control-label" id="long-poi-resource_screen" for="long-poi-resource_screen_value"></label>
<div class="controls">
<!--p id="long-poi-resource_alert" style="display: none;"></p-->
<p><input type="text" class="text-input" value="" id="long-poi-resource_screen_value" name="long" maxlength="20" style="width: 40%;"/> <input id="poi-gps-resource_btn" class="submit_btn" type="button" value="GPS" onClick="GetPoiFromDevice();" /></p>
<p id="long-poi-resource_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="long-poi-resource_fieldset" -->

<div id="lat-poi-resource_fieldset" class="control-group">
<label class="control-label" id="lat-poi-resource_screen" for="lat-poi-resource_screen_value"></label>
<div class="controls">
<!--p id="lat-poi-resource_alert" style="display: none;"></p-->
<p><input type="text" class="text-input" value="" id="lat-poi-resource_screen_value" name="lat" maxlength="20" style="width: 40%;"/></p>
<p id="lat-poi-resource_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="lat-poi-resource_fieldset" -->

<div id="pos-accur-poi-resource_fieldset" class="control-group">
<label class="control-label" id="pos-accur-poi-resource_screen" for="pos-accur-poi-resource_screen_value"></label>
<div class="controls">
<p><input type="text" class="text-input" value="" id="pos_accur-poi-resource_screen_value" name="pos_accur" maxlength="10" style="width: 40%;"/></p>
<p id="pos-accur-poi-resource_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="pos_accur-poi-resource_fieldset" -->

<div id="elevation-poi-resource_fieldset" class="control-group">
<label class="control-label" id="elevation-poi-resource_screen" for="elevation-poi-resource_screen_value"></label>
<div class="controls">
<p id="elevation-poi-resource_alert" style="display: none;"></p>
<p><input type="text" class="text-input" value="" id="elevation-poi-resource_screen_value" name="elevation" maxlength="20" style="width: 40%;"/></p>
<p id="elevation-poi-resource_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="elevation-poi-resource_fieldset" -->

<div id="reason-poi-resource_fieldset" class="control-group">
<label class="control-label" id="reason-poi-resource_screen" for="reason-poi-resource_screen_value"></label>
<div class="controls">
<p id="reason-poi-resource_alert" style="display: none;"></p>
<textarea class="text-input" id="reason-poi-resource_screen_value" name="reason" maxlength="1999" style="width: 80%; height: 60px;"></textarea>
<p id="reason-poi-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="reason-poi-resource_fieldset" -->

<div class="form-actions">
<input id="poi-resource_btn" class="submit_btn" type="submit" value="Save changes" />
<input id="poi-resource-delete_btn" class="submit_btn" type="button" value="Delete" onclick="SendResourceDelete('POI');" />
<input id="poi-resource-close_btn" class="submit_btn" type="button" value="Close" onclick="SurtDePoiResourceChanges(true);" />
<input id="poi-resource-exit_btn" class="submit_btn" type="button" value="Close" onclick="SurtDePoiResourceChanges(false);" />
</div>

</form>

</div>  <!--End of id="poi-resource" -->

<!-- *** FEEDBACK RESOURCE DLG *** -->

<div id="feedback-resource" class="white-area" style="left: 25%; top: 45px; width: 60%; height: auto; visibility: hidden;">
<h2 id="feedback-resource-title-text" class="white-area-title"></h2>
<p id="feedback-resource-subtitle-text"></p>

<form id="feedback-resource_form" name="feedback_resource_form" method="get" autocomplete="off" onSubmit="return SendFeedbackResourceChanges();">

<fieldset class="control-fielset-group">
<legend id="target-feedback-publication-resource"></legend>
	<p id="target_feedback-resource_compact_list" class="compact_descrip_in_FB"></p>
<input id="target_feedback-resource_compact_add_btn" class="submit_btn" type="button" value="Add" 
	onClick="ObreSelectorDeTargetOfAFeedback('target_feedback-resource_compact_list');"/>
	<p id="target_feedback-resource_compact_add_descrip" class="white-area-screen-descrip-text"></p> 
</fieldset> <!--End of id="target-feedback-publication-resource" -->

<br>
<div id="title-feedback-resource_fieldset" class="control-group">
<label class="control-label" id="title-feedback-resource_screen" for="title-feedback-resource_screen_value"></label>
<div class="controls">
<input type="text" class="text-input" value="" id="title-feedback-resource_screen_value" name="title" style="width: 80%;" maxlength="254"/>
<p id="title-feedback-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="title-feedback-resource_fieldset" -->

<div id="abstract-feedback-resource_fieldset" class="control-group">
<label class="control-label" id="abstract-feedback-resource_screen" for="abstract-feedback-resource_screen_value"></label>
<div class="controls">
<p id="abstract-feedback-resource_alert" style="display: none;"></p>
<textarea class="text-input" id="abstract-feedback-resource_screen_value" name="abstract" maxlength="1999" style="width: 80%; height: 60px;"></textarea>
<p id="abstract-feedback-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="abstract-feedback-resource_fieldset" -->

<div id="reason-feedback-resource_fieldset" class="control-group">
<label class="control-label" id="reason-feedback-resource_screen" for="reason-feedback-resource_screen_value"></label>
<div class="controls">
<p id="reason-feedback-resource_alert" style="display: none;"></p>
<textarea class="text-input" id="reason-feedback-resource_screen_value" name="reason" maxlength="1999" style="width: 80%; height: 60px;"></textarea>
<p id="reason-feedback-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="reason-feedback-resource_fieldset" -->

<div id="contactRole-feedback-resource_fieldset" class="control-group">
<label class="control-label" id="contactRole-feedback-resource_screen" for="contactRole-feedback-resource_screen_value"></label>
<div class="controls">
<select class="text-input" id="contactRole-feedback-resource_screen_value" name="contactRole">
<option value="commercialDataProducer" id="commercialDataProd-contactRole-feedback-resource_value"></option>
<option value="commercialAddedValue" id="commercialAddedValue-contactRole-feedback-resource_value"></option>
<option value="researchDataProducer" id="researchDataProd-contactRole-feedback-resource_value"></option>
<option value="researchEndUser" id="researchEndUser-contactRole-feedback-resource_value"></option>
<option value="decisionMaker" id="decisionMaker-contactRole-feedback-resource_value"></option>
<option value="generalPublic" id="generalPublic-contactRole-feedback-resource_value" selected="selected"></option>
</select>
<p id="contactRole-feedback-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="contactRole-feedback-resource_fieldset" -->

<fieldset class="control-fielset-group">
<legend id="user-comment-publication-resource"></legend>

<div id="comment-feedback-resource_fieldset" class="control-group">
<label class="control-label" id="comment-feedback-resource_screen" for="comment-feedback-resource_screen_value"></label>
<div class="controls">
<p id="comment-feedback-resource_alert" style="display: none;"></p>
	<textarea class="text-input" id="comment-feedback-resource_screen_value" name="comment" maxlength="1999" style="width: 100%; height: 60px;"></textarea>
	<p id="comment-feedback-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="comment-feedback-resource_fieldset" -->

<div id="comment-motiv-feedback-resource_fieldset" class="control-group">
<label class="control-label" id="comment-motiv-feedback-resource_screen" for="comment-motiv-feedback-resource_screen_value"></label>
<div class="controls">
<select class="text-input" id="comment-motiv-feedback-resource_screen_value" name="motivation">
<option value="" id="undefined-motivation-feedback-resource_value" selected="selected"></option>
<option value="comment" id="comment-motivation-feedback-resource_value"></option>
<option value="question" id="question-motivation-feedback-resource_value"></option>
<option value="answer" id="answer-motivation-feedback-resource_value"></option>
<option value="acceptedAnswer" id="acceptedAnswer-motivation-feedback-resource_value"></option>
<option value="response" id="response-motivation-feedback-resource_value"></option>		
<option value="justification" id="justification-motivation-feedback-resource_value"></option>
<option value="resolution" id="resolution-motivation-feedback-resource_value"></option>
<option value="moderation" id="moderation-motivation-feedback-resource_value"></option>
</select>	
	<p id="comment-motiv-feedback-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="comment-motiv-feedback-resource_fieldset" -->

</fieldset> <!-- End of id="user-comment-publication-resource" -->

<br>
<div id="rating-feedback-resource_fieldset" class="control-group">
<label class="control-label" id="rating-feedback-resource_screen" for="rating-feedback-resource_screen_value"></label>
<div class="controls">
<!--select class="text-input" id="rating-feedback-resource_screen_value" name="rating">
<option value="" id="undefined-rating-feedback-resource_value" selected="selected"></option>
<option value="1" id="oneStar-rating-feedback-resource_value"></option>
<option value="2" id="twoStars-rating-feedback-resource_value"></option>
<option value="3" id="threeStars-rating-feedback-resource_value"></option>
<option value="4" id="fourStars-rating-feedback-resource_value"></option>
<option value="5" id="fiveStars-rating-feedback-resource_value"></option>
</select-->
      <span class="starRating">
        <input id="rating-feedback-resource_value5" type="radio" name="rating" value="5">
        <label for="rating-feedback-resource_value5">5</label>
        <input id="rating-feedback-resource_value4" type="radio" name="rating" value="4">
        <label for="rating-feedback-resource_value4">4</label>
        <input id="rating-feedback-resource_value3" type="radio" name="rating" value="3">
        <label for="rating-feedback-resource_value3">3</label>
        <input id="rating-feedback-resource_value2" type="radio" name="rating" value="2">
        <label for="rating-feedback-resource_value2">2</label>
        <input id="rating-feedback-resource_value1" type="radio" name="rating" value="1" checked>
        <label for="rating-feedback-resource_value1">1</label>
        <!--input id="rating-feedback-resource_value0" type="radio" name="rating" value="0" checked>
        <label for="rating-feedback-resource_value0">0</label> <!-- indefinit -->
      </span>
<p id="rating-feedback-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="rating-feedback-resource_fieldset" -->

<fieldset class="control-fielset-group">
<legend id="public-feedback-publication-resource"></legend>
	<p id="public_feedback-resource_compact_list" class="compact_descrip_in_FB"></p>
<input id="public_feedback-resource_compact_add_btn" class="submit_btn" type="button" value="Add" 
	onClick="ObreSelectorDePublicOfAFeedback('public_feedback-resource_compact_list');"/>
	<p id="public_feedback-resource_compact_add_descrip" class="white-area-screen-descrip-text"></p> 
</fieldset> <!--End of id="public-feedback-publication-resource" -->

<div id="share-anonymous-feedback-resource_fieldset" class="control-group">
<label class="control-label" id="share-anonymous-feedback-resource_screen" for="share-anonymous-feedback-resource_screen_value"></label>
<div class="controls">
<p id="share-anonymous-feedback-resource_alert" style="display: none;"></p>
<input type="checkbox" id="share-anonymous-feedback-resource_screen_value" name="share_1" checked="checked"/>
<p id="share-anonymous-feedback-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="share-anonymous-feedback-resource_fieldset" -->

<div class="control-group">
<label class="control-label" id="pub_feedback-resource_compact_screen" for="feedback-resource_pub_compact_value"></label>
<div class="controls">
<p id="pub_feedback-resource_compact_descrip"></p>
</div>
</div>  <!--End of id="pub_feedback-resource_compact_descrip" -->

<div class="form-actions">
<input id="feedback-resource_btn" class="submit_btn" type="submit" value="Save changes" />
<input id="feedback-resource-delete_btn" class="submit_btn" type="button" value="Delete" onclick="SendResourceDelete('FEEDBACK');" />
<input id="feedback-resource-close_btn" class="submit_btn" type="button" value="Close" onclick="SurtDeFeedbackResourceChanges(true);" />
<input id="feedback-resource-exit_btn" class="submit_btn" type="button" value="Close" onclick="SurtDeFeedbackResourceChanges(false);" />
</div>

</form>

</div>  <!--End of id="feedback-resource" -->

<!-- *** CITATION RESOURCE DLG *** -->
<div id="citation-resource" class="white-area" style="left: 25%; top: 45px; width: 60%; height: auto; visibility: hidden;">
<h2 id="citation-resource-title-text" class="white-area-title"></h2>
<p id="citation-resource-subtitle-text"></p>

<form id="citation-resource_form" name="citation_resource_form" method="get" autocomplete="off" onSubmit="return SendCitationResourceChanges();">

<div id="title-citation-resource_fieldset" class="control-group">
<label class="control-label" id="title-citation-resource_screen" for="title-citation-resource_screen_value"></label>
<div class="controls">
<input type="text" class="text-input" value="" id="title-citation-resource_screen_value" name="title" style="width: 80%;" maxlength="254"/>
<p id="title-citation-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="title-citation-resource_fieldset" -->

<fieldset class="control-fielset-group">
<legend id="edition-citation-resource"></legend>
	
	<div id="edition-citation-resource_fieldset" class="control-group">
	<label class="control-label" id="edition-citation-resource_screen" for="edition-citation-resource_screen_value"></label>
	<div class="controls">
	<input type="text" class="text-input" value="" id="edition-citation-resource_screen_value" name="edition" style="width:100%;" maxlength="29"/>
	<p id="edition-citation-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="edition-citation-resource_fieldset" -->
	
	<div id="edition-date-citation-resource_fieldset" class="control-group">
	<label class="control-label" id="edition-date-citation-resource_screen" for="edition-date-citation-resource_screen_value"></label>
	<div class="controls">
	<input type="date" class="text-input" id="edition-date-citation-resource_screen_value" name="edition_date" style="width:100%;" maxlength="29"/>
	<p id="edition-date-citation-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="edition-date-citation-resource_fieldset" -->
</fieldset> <!--End of id="edition-citation-resource" -->	

<fieldset class="control-fielset-group">
<legend id="identifier-citation-resource"></legend>

<div id="id-code-citation-resource_fieldset" class="control-group">
<label class="control-label" id="id-code-citation-resource_screen" for="id-code-citation-resource_screen_value"></label>
<div class="controls">
<p id="id-code-citation-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="id-code-citation-resource_screen_value" name="id_code" maxlength="254" style="width: 100%;"/>
	<p id="id-code-citation-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="id-code-citation-resource_fieldset" -->

<div id="id-namespace-citation-resource_fieldset" class="control-group">
<label class="control-label" id="id-namespace-citation-resource_screen" for="id-namespace-citation-resource_screen_value"></label>
<div class="controls">
<p id="id-namespace-citation-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="id-namespace-citation-resource_screen_value" name="id_namespace" maxlength="254" style="width: 100%;"/>
	<p id="id-namespace-citation-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="id-namespace-citation-resource_fieldset" -->
</fieldset> <!--End of id="identifier-citation-resource" -->	

<fieldset class="control-fielset-group">
<legend id="series-citation-resource"></legend>

	<div id="series-name-citation-resource_fieldset" class="control-group">
	<label class="control-label" id="series-name-citation-resource_screen" for="series-name-citation-resource_screen_value"></label>
	<div class="controls">
	<p id="series-name-citation-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="series-name-citation-resource_screen_value" name="series_name" maxlength="254" style="width: 100%;"/>
	<p id="series-name-citation-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	
	</div>  <!--End of id="series-name-citation-resource_fieldset" -->
	<div id="series-issue-citation-resource_fieldset" class="control-group">
	<label class="control-label" id="series-issue-citation-resource_screen" for="series-issue-citation-resource_screen_value"></label>
	<div class="controls">
	<p id="series-issue-citation-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="series-issue-citation-resource_screen_value" name="series_issue" maxlength="39" style="width: 100%;"/>
	<p id="series-issue-citation-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	
	</div>  <!--End of id="series-issue-citation-resource_fieldset" -->
	<div id="series-page-citation-resource_fieldset" class="control-group">
	<label class="control-label" id="series-page-citation-resource_screen" for="series-page-citation-resource_screen_value"></label>
	<div class="controls">
	<p id="series-page-citation-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="series-page-citation-resource_screen_value" name="series_page" maxlength="14" style="width: 100%;"/>
	<p id="series-page-citation-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="series-page-citation-resource_fieldset" -->

</fieldset> <!--End of id="series-citation-resource" -->	

<br>
<div id="other_cit_details-citation-resource_fieldset" class="control-group">
<label class="control-label" id="other-cit-details-citation-resource_screen" for="other_cit_details-citation-resource_screen_value"></label>
<div class="controls">
<p id="other_cit_details-citation-resource_alert" style="display: none;"></p>
<input type="text" class="text-input" id="other-cit-details-citation-resource_screen_value" name="other_cit_details" maxlength="254" style="width: 80%;"/>
<p id="other-cit-details-citation-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="other_cit_details-citation-resource_fieldset" -->

<fieldset class="control-fielset-group">
	<legend id="url-citation-resource"></legend>
	
<div id="url-link-citation-resource_fieldset" class="control-group">
<label class="control-label" id="url-link-citation-resource_screen" for="url-link-citation-resource_screen_value"></label>
<div class="controls">
<p id="url-link-citation-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="url-link-citation-resource_screen_value" name="url_link" maxlength="149" style="width: 100%;"/>
	<p id="url-link-citation-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="url-link-citation-resource_fieldset" -->

<div id="url-descrip-citation-resource_fieldset" class="control-group">
<label class="control-label" id="url-descrip-citation-resource_screen" for="url-descrip-citation-resource_screen_value"></label>
<div class="controls">
<p id="url-descrip-citation-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="url-descrip-citation-resource_screen_value" name="url_descrip" maxlength="254" style="width: 100%;"/>
	<p id="url-descrip-citation-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="url-descrip-citation-resource_fieldset" -->

<div id="url-function-citation-resource_fieldset" class="control-group">
<label class="control-label" id="url-function-citation-resource_screen" for="url-function-citation-resource_screen_value"></label>
<div class="controls">
<select class="text-input" id="url-function-citation-resource_screen_value" name="function_code">	
<option value="undefined" id="undefined-url-function-citation-resource_value"></option>
<option value="download" id="download-url-function-citation-resource_value"></option>
<option value="information" id="information-url-function-citation-resource_value"></option>
<option value="offlineAccess" id="offlineAccess-url-function-citation-resource_value"></option>
<option value="order" id="order-url-function-citation-resource_value"></option>
<option value="search" id="search-url-function-citation-resource_value"></option>
<option value="completeMetadata" id="completeMetadata-url-function-citation-resource_value"></option>
<option value="browseGraphic" id="browseGraphic-url-function-citation-resource_value"></option>
<option value="upload" id="upload-url-function-citation-resource_value"></option>
<option value="emailService" id="emailService-url-function-citation-resource_value"></option>
<option value="browsing" id="browsing-url-function-citation-resource_value"></option>
<option value="fileAccess" id="fileAccess-url-function-citation-resource_value"></option>
</select>
	<p id="url-function-citation-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="url-function-citation-resource_fieldset" -->

</fieldset>  <!--End of id="url-citation-resource" -->	

<div class="form-actions">
<input id="citation-resource_btn" class="submit_btn" type="submit" value="Save changes" />
<input id="citation-resource-delete_btn" class="submit_btn" type="button" value="Delete" onclick="SendResourceDelete('CITATION');" />
<input id="citation-resource-close_btn" class="submit_btn" type="button" value="Close" onclick="SurtDeCitationResourceChanges(true);" />
<input id="citation-resource-exit_btn" class="submit_btn" type="button" value="Close" onclick="SurtDeCitationResourceChanges(false);" />
</div>

</form>

</div>  <!--End of id="citation-resource" -->



<!-- *** PUBLICAT RESOURCE DLG *** -->
<div id="publication-resource" class="white-area" style="left: 25%; top: 45px; width: 60%; height: auto; visibility: hidden;">
<h2 id="publication-resource-title-text" class="white-area-title"></h2>
<p id="publication-resource-subtitle-text"></p>

<form id="publication-resource_form" name="publication_resource_form" method="get" autocomplete="off" onSubmit="return SendPublicationResourceChanges();">

<div id="title-publication-resource_fieldset" class="control-group">
<label class="control-label" id="title-publication-resource_screen" for="title-publication-resource_screen_value"></label>
<div class="controls">
<input type="text" class="text-input" value="" id="title-publication-resource_screen_value" name="title" style="width: 80%;" maxlength="254"/>
<p id="title-publication-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="title-publication-resource_fieldset" -->

<fieldset class="control-fielset-group">
<legend id="edition-publication-resource"></legend>
	
	<div id="edition-publication-resource_fieldset" class="control-group">
	<label class="control-label" id="edition-publication-resource_screen" for="edition-publication-resource_screen_value"></label>
	<div class="controls">
	<input type="text" class="text-input" value="" id="edition-publication-resource_screen_value" name="edition" style="width:100%;" maxlength="29"/>
	<p id="edition-publication-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="edition-publication-resource_fieldset" -->
	
	<div id="edition-date-publication-resource_fieldset" class="control-group">
	<label class="control-label" id="edition-date-publication-resource_screen" for="edition-date-publication-resource_screen_value"></label>
	<div class="controls">
	<input type="date" class="text-input" id="edition-date-publication-resource_screen_value" name="edition_date" style="width:100%;" maxlength="29"/>
	<p id="edition-date-publication-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="edition-date-publication-resource_fieldset" -->
	
</fieldset>  <!--End of id="edition-publication-resource" -->	

<fieldset class="control-fielset-group">
<legend id="identifier-publication-resource"></legend>

<div id="id-code-publication-resource_fieldset" class="control-group">
<label class="control-label" id="id-code-publication-resource_screen" for="id-code-publication-resource_screen_value"></label>
<div class="controls">
<p id="id-code-publication-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="id-code-publication-resource_screen_value" name="id_code" maxlength="254" style="width: 100%;"/>
	<p id="id-code-publication-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="id-code-publication-resource_fieldset" -->

<div id="id-namespace-publication-resource_fieldset" class="control-group">
<label class="control-label" id="id-namespace-publication-resource_screen" for="id-namespace-publication-resource_screen_value"></label>
<div class="controls">
<p id="id-namespace-publication-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="id-namespace-publication-resource_screen_value" name="id_namespace" maxlength="254" style="width: 100%;"/>
	<p id="id-namespace-publication-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="id-namespace-publication-resource_fieldset" -->

</fieldset>  <!--End of id="identifier-publication-resource" -->	

<fieldset class="control-fielset-group">
<legend id="series-publication-resource"></legend>

	<div id="series-name-publication-resource_fieldset" class="control-group">
	<label class="control-label" id="series-name-publication-resource_screen" for="series-name-publication-resource_screen_value"></label>
	<div class="controls">
	<p id="series-name-publication-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="series-name-publication-resource_screen_value" name="series_name" maxlength="254" style="width: 100%;"/>
	<p id="series-name-publication-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="series-name-publication-resource_fieldset" -->
	
	<div id="series-issue-publication-resource_fieldset" class="control-group">
	<label class="control-label" id="series-issue-publication-resource_screen" for="series-issue-publication-resource_screen_value"></label>
	<div class="controls">
	<p id="series-issue-publication-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="series-issue-publication-resource_screen_value" name="series_issue" maxlength="39" style="width: 100%;"/>
	<p id="series-issue-publication-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="series-issue-publication-resource_fieldset" -->
	
	<div id="series-page-publication-resource_fieldset" class="control-group">
	<label class="control-label" id="series-page-publication-resource_screen" for="series-page-publication-resource_screen_value"></label>
	<div class="controls">
	<p id="series-page-publication-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="series-page-publication-resource_screen_value" name="series_page" maxlength="14" style="width: 100%;"/>
	<p id="series-page-publication-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="series-page-publication-resource_fieldset" -->
	
</fieldset>  <!--End of id="series-publication-resource" -->	

<br>
<div id="other_cit_details-publication-resource_fieldset" class="control-group">
<label class="control-label" id="other-cit-details-publication-resource_screen" for="other_cit_details-publication-resource_screen_value"></label>
<div class="controls">
<p id="other_cit_details-publication-resource_alert" style="display: none;"></p>
<input type="text" class="text-input" id="other-cit-details-publication-resource_screen_value" name="other_cit_details" maxlength="254" style="width: 80%;"/>
<p id="other-cit-details-publication-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="other_cit_details-publication-resource_fieldset" -->

<fieldset class="control-fielset-group">
<legend id="url-publication-resource"></legend>

<div id="url-link-publication-resource_fieldset" class="control-group">
<label class="control-label" id="url-link-publication-resource_screen" for="url-link-publication-resource_screen_value"></label>
<div class="controls">
<p id="url-link-publication-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="url-link-publication-resource_screen_value" name="url_link" maxlength="149" style="width: 100%;"/>
	<p id="url-link-publication-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="url-link-publication-resource_fieldset" -->

<div id="url-descrip-publication-resource_fieldset" class="control-group">
<label class="control-label" id="url-descrip-publication-resource_screen" for="url-descrip-publication-resource_screen_value"></label>
<div class="controls">
<p id="url-descrip-publication-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="url-descrip-publication-resource_screen_value" name="url_descrip" maxlength="254" style="width: 100%;"/>
	<p id="url-descrip-publication-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="url-descrip-publication-resource_fieldset" -->

<div id="url-function-publication-resource_fieldset" class="control-group">
<label class="control-label" id="url-function-publication-resource_screen" for="url-function-publication-resource_screen_value"></label>
<div class="controls">
<select class="text-input" id="url-function-publication-resource_screen_value" name="function_code">	
<option value="undefined" id="undefined-url-function-publication-resource_value"></option>
<option value="download" id="download-url-function-publication-resource_value"></option>
<option value="information" id="information-url-function-publication-resource_value"></option>
<option value="offlineAccess" id="offlineAccess-url-function-publication-resource_value"></option>
<option value="order" id="order-url-function-publication-resource_value"></option>
<option value="search" id="search-url-function-publication-resource_value"></option>
<option value="completeMetadata" id="completeMetadata-url-function-publication-resource_value"></option>
<option value="browseGraphic" id="browseGraphic-url-function-publication-resource_value"></option>
<option value="upload" id="upload-url-function-publication-resource_value"></option>
<option value="emailService" id="emailService-url-function-publication-resource_value"></option>
<option value="browsing" id="browsing-url-function-publication-resource_value"></option>
<option value="fileAccess" id="fileAccess-url-function-publication-resource_value"></option>
</select>
	<p id="url-function-publication-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="url-function-publication-resource_fieldset" -->

</fieldset>  <!--End of id="url-publication-resource" -->	

<br>
<div id="abstract-publication-resource_fieldset" class="control-group">
<label class="control-label" id="abstract-publication-resource_screen" for="abstract-publication-resource_screen_value"></label>
<div class="controls">
<textarea class="text-input" id="abstract-publication-resource_screen_value" name="abstract" maxlength="1999" style="width: 80%; height: 60px;"></textarea>
<p id="abstract-publication-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="abstract-publication-resource_fieldset" -->

<div id="category-publication-resource_fieldset" class="control-group">
<label class="control-label" id="category-publication-resource_screen" for="category-publication-resource_screen_value"></label>
<div class="controls">
<select class="text-input" id="category-publication-resource_screen_value" name="category_code">	
<option value="undefined" id="undefined-category-publication-resource_value"></option>         
<option value="bookChapter" id="bookChapter-category-publication-resource_value"></option>       
<option value="book" id="book-category-publication-resource_value"></option>              
<option value="report" id="report-category-publication-resource_value"></option>            
<option value="journalArticle" id="journalArticle-category-publication-resource_value"></option>    
<option value="magazineNewspaper" id="magazineNewspaper-category-publication-resource_value"></option> 
<option value="atlasMap" id="atlasMap-category-publication-resource_value"></option>          
<option value="applicationProgram" id="applicationProgram-category-publication-resource_value"></option>
<option value="conferenceProceedings" id="conferenceProceedings-category-publication-resource_value"></option>       
<option value="multimediaContent" id="multimediaContent-category-publication-resource_value"></option> 
<option value="socialMediaComment" id="socialMediaComment-category-publication-resource_value"></option>
<option value="blogWiki" id="blogWiki-category-publication-resource_value"></option>          
<option value="webSite" id="webSite-category-publication-resource_value"></option>           
<option value="webPage" id="webPage-category-publication-resource_value"></option>           
<option value="videoAudio" id="videoAudio-category-publication-resource_value"></option>        
<option value="tutorialManual" id="tutorialManual-publication-resource_screen_value"></option>                                        
</select>
<p id="category-publication-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="category-publication-resource_fieldset" -->

<div class="form-actions">
<input id="publication-resource_btn" class="submit_btn" type="submit" value="Save changes" />
<input id="publication-resource-delete_btn" class="submit_btn" type="button" value="Delete" onclick="SendResourceDelete('PUBLICAT');" />
<input id="publication-resource-close_btn" class="submit_btn" type="button" value="Close" onclick="SurtDePublicationResourceChanges(true);" />
<input id="publication-resource-exit_btn" class="submit_btn" type="button" value="Close" onclick="SurtDePublicationResourceChanges(false);" />
</div>

</form>

</div>  <!--End of id="publication-resource" -->


<!-- *** ACCOUNT DLG *** -->

<div id="account" class="white-area" style="left: 25%; top: 45px; width: 60%; height: auto; visibility: hidden;">
<h2 id="account-title-text" class="white-area-title">Account</h2>
<p id="account-subtitle-text">Change your basic account and language settings.</p>

<form id="account_form" name="account_form" method="get" autocomplete="off" onSubmit="return SendAccountChanges();">

<div id="new_user_fieldset" class="control-group">
<label class="control-label" id="new_user_screen" for="new_user_screen_value"></label>
<div class="controls">
<p id="new_user_alert" style="display: none;"></p>
<p><input type="text" class="text-input" value="" id="new_user_screen_value" name="new_user" maxlength="79" onkeyup="NewUserInputChange();" onpaste="NewUserInputChange();" oninput="NewUserInputChange();"/></p>
<p id="new_user_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="new_user_fieldset" -->

<div id="email_fieldset" class="control-group">
<label class="control-label" id="email_screen" for="email_screen_value"></label>
<div class="controls">
<input type="text" class="text-input" id="email_screen_value" value="" name="email" style="width: 60%;" maxlength="79"/>
<p id="email_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="email_fieldset" -->

<div id="name_fieldset" class="control-group">
<label class="control-label" id="name_screen" for="name_screen_value"></label>
<div class="controls">
<input type="text" class="text-input" value="" id="name_screen_value" name="name" style="width: 60%;" maxlength="99"/>
<p id="name_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="name_fieldset" -->

<div id="bio_fieldset" class="control-group">
<label class="control-label" id="bio_screen" for="bio_screen_value"></label>
<div class="controls">
<textarea class="text-input" id="bio_screen_value" name="bio" maxlength="1999" style="width: 80%; height: 60px;"></textarea>
<p id="bio_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="name_fieldset" -->

<div id="current_pass_fieldset" class="control-group">
<label class="control-label" id="current_pass_screen" for="current_pass_screen_value"></label>
<div class="controls">
<p id="current_pass_alert" style="display: none;"></p>
<p><input type="password" class="text-input" value="" id="current_pass_screen_value" name="current_pass" maxlength="39" onkeyup="CurrentPassInputChange();" onpaste="CurrentPassInputChange();" oninput="CurrentPassInputChange();"/></p>
<p id="current_pass_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="current_pass_fieldset" -->

<div id="new_pass_fieldset" class="control-group">
<label class="control-label" id="new_pass_screen" for="new_pass_screen_value"></label>
<div class="controls">
<p id="new_pass_alert" style="display: none;"></p>
<p><input type="password" class="text-input" value="" id="new_pass_screen_value" name="new_pass" maxlength="39" onkeyup="NewPassInputChange();" onpaste="NewPassInputChange();" oninput="NewPassInputChange();"/></p>
<p id="new_pass_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="new_pass_fieldset" -->

<div id="new_pass_valid_fieldset" class="control-group">
<label class="control-label" id="new_pass_valid_screen" for="new_pass_valid_screen_value"></label>
<div class="controls">
<p id="new_pass_valid_alert" style="display: none;"></p>
<p><input type="password" class="text-input" value="" id="new_pass_valid_screen_value" name="new_pass_valid" maxlength="39" onkeyup="PassValidInputChange();" onpaste="PassValidInputChange();" oninput="PassValidInputChange();"/></p>
<p id="new_pass_valid_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="new_pass_valid_fieldset" -->

<div id="language_fieldset" class="control-group">
<label class="control-label" id="language_screen" for="language_screen_value"></label>
<div class="controls">
<select class="text-input" id="language_screen_value" name="language">
<option value="cat">Català</option>
<option value="spa">Español</option>
<option value="eng">English</option>
</select>
<p id="language_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="language_fieldset" -->

<div class="form-actions">
<input id="account_btn" class="submit_btn" type="submit" value="Save changes">
<input id="account-close_btn" class="submit_btn" type="button" value="Close" onclick="SurtDeAccount();">
</div>

</form>

</div>  <!--End of id="account" -->

<!-- *** SHARE DLG *** -->

<div id="share" class="white-area" style="left: 25%; top: 45px; width: 60%; height: auto; visibility: hidden;">
<h2 id="share-title-text" class="white-area-title"></h2>
<p id="share-subtitle-text"></p>

<form id="share_form" name="share_form" method="get" autocomplete="off" onSubmit="return SurtIRetornaAResources();">

<div class="control-group">
<label class="control-label" id="new_share_screen" for="new_share_screen_value"></label>
<div class="controls">
<p><input type="text" class="text-input" value="" id="new_share_screen_value" name="new_share" maxlength="79" onfocus="ShowShareAuthorizedList();" onblur="HideShareAuthorizedList();"/> <label id="new_share_rights_read_label" for="new_share_rights_read"></label><img src="check16.png" id="new_share_rights_read"/>, <label id="new_share_rights_write_label" for="new_share_rights_write"></label><input type="checkbox" id="new_share_rights_write" name="W" checked="checked"/>, <label id="new_share_rights_share_label" for="new_share_rights_share"></label><input type="checkbox" id="new_share_rights_share" name="S" checked="checked"/> <input id="new_share_btn" class="submit_btn" type="button" value="" onClick="AddShareResource(false);"/></p>
<p id="new_share_select" style="display:none;position:absolute;">
<select size=10 class="text-input" name="new_share_select" style="height:116px;width:250px;" onfocus="ShowShareAuthorizedList();" onblur="HideShareAuthorizedList();" onchange="SelectionShareAuthorizedList();HideShareAuthorizedList();">
</select>
</p>
<p id="new_share_descrip"></p>
</div>
</div>

<div id="new_share_open_fieldset" class="control-group">
<label class="control-label" id="new_share_open_screen"></label>
<div class="controls">
<p><label id="new_share_open_read_label" for="new_share_open_rights_read"></label> <input id="new_share_open_btn" class="submit_btn" type="button" value="" onClick="AddShareResource(true);"/></p>
<p id="new_share_open_descrip"></p>
</div>
</div>  <!--End of id="new_share_open_fieldset" -->

<div id="current_share_fieldset" class="control-group">
<label class="control-label" id="current_share_screen"></label>
<div class="controls">
<p id="current_share_list"></p>
<p id="current_share_descrip"></p>
</div>
</div>  <!--End of id="current_share_fieldset" -->

<div class="form-actions">
<input id="share-close_btn" class="submit_btn" type="submit" value="Close">
</div>

</form>

</div>  <!--End of id="share" -->


<!-- *** FEEDBACK DLG *** -->

<div id="feedback" class="white-area" style="left: 25%; top: 45px; width: 60%; height: auto; visibility: hidden;">
<h2 id="feedback-title-text" class="white-area-title"></h2>
<p id="feedback-subtitle-text"></p>

<form id="feedback_form" name="feedback_form" method="get" autocomplete="off" onSubmit="return SurtIRetornaAResources();">

<div class="control-group">
<label class="control-label" id="feedback_target_compact_screen" for="feedback_target_compact_value"></label>
<div class="controls">
<p id="feedback_target_compact_descrip"></p>
</div>
</div>

<div class="control-group">
<label class="control-label" id="new_feedback_screen" for="new_feedback_screen_value"></label>
<div class="controls">
<p><input id="new_feedback_btn" class="submit_btn" type="button" value="" onClick="MostraFeedbackResource('', null);"/></p>
<p id="new_feedback_descrip"></p>
</div>
</div>

<div id="current_feedback_fieldset" class="control-group">
<label class="control-label" id="current_feedback_screen"></label>
<div class="controls">
<p id="current_feedback_list"></p>
<p id="current_feedback_descrip"></p>
</div>
</div>  <!--End of id="current_feedback_fieldset" -->

<div class="form-actions">
<input id="feedback-close_btn" class="submit_btn" type="submit" value="Close">
</div>

</form>

</div>  <!--End of id="feedback" -->


</div>  <!--End of id="main-page" -->

<!-- *** PASSWORD RESET PAGE *** -->

<div id="reset-pass-page" class="white-area" style="left: 15%; top: 11px; width: 60%; height: auto; visibility: hidden;">
<h2 id="reset-pass-title-text" class="white-area-title">Password reset</h2>
<p id="reset-pass-subtitle-text">Find your NiMMbus account.</p>

<form id="reset-pass_form" name="reset_pass_form" method="get" autocomplete="off" onSubmit="return SendPasswordReset();">
<p><input type="text" class="text-input" value="" id="reset-pass_user_screen_value" name="user" maxlength="79" /></p>
<p id="reset-pass_user_descrip"></p>

<div class="form-actions"><input id="reset-pass_btn" class="submit_btn" type="submit" value="Search"></div>
</form>

</div>  <!--End of id="reset-pass-page" -->

<!-- *** NEW PASSWORD PAGE *** -->

<div id="new-pass-page" class="white-area" style="left: 15%; top: 11px; width: 60%; height: auto; visibility: hidden;">
<h2 id="new-pass-title-text" class="white-area-title">ChangePassword</h2>
<p id="new-pass-subtitle-text">Change password in your NiMMbus account.</p>

<form id="new-pass_form" name="new_pass_form" method="get" autocomplete="off" onSubmit="return SendNewPasswordToken();">

<div class="control-group">
<label class="control-label" id="new-pass_new_pass_screen" for="new_pass_screen_value"></label>
<div class="controls">
<p id="new-pass_new_pass_alert" style="display: none;"></p>
<p><input type="password" class="text-input" value="" id="new-pass_new_pass_screen_value" name="new_pass" maxlength="39" onkeyup="NewPassNewPassInputChange();" onpaste="NewPassNewPassInputChange();" oninput="NewPassNewPassInputChange();"/></p>
<p id="new-pass_new_pass_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="new_pass_fieldset" -->

<div class="control-group">
<label class="control-label" id="new-pass_new_pass_valid_screen" for="new-pass_new_pass_valid_screen_value"></label>
<div class="controls">
<p id="new-pass_new_pass_valid_alert" style="display: none;"></p>
<p><input type="password" class="text-input" value="" id="new-pass_new_pass_valid_screen_value" name="new_pass_valid" maxlength="39" onkeyup="NewPassPassValidInputChange();" onpaste="NewPassPassValidInputChange();" oninput="NewPassPassValidInputChange();"/></p>
<p id="new-pass_new_pass_valid_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="new_pass_valid_fieldset" -->

<div class="form-actions"><input id="new-pass_btn" class="submit_btn" type="submit" value="Search"></div>
</form>

</div>  <!--End of id="new-pass-page" -->

<!-- *** NEW USER PAGE *** -->

<div id="new-user-page" class="white-area" style="left: 15%; top: 11px; width: 60%; height: auto; visibility: hidden;">
<h2 id="new-user-title-text" class="white-area-title">New User</h2>
<p id="new-user-subtitle-text">Create your NiMMbus account.</p>

<form id="new-user_form" name="new_user_form" method="get" autocomplete="off" onSubmit="return SendNewUserNB();">

<div class="control-group">
<label class="control-label" id="new-user_new_user_screen" for="new_user_screen_value"></label>
<div class="controls">
<p id="new-user_new_user_alert" style="display: none;"></p>
<p><input type="text" class="text-input" value="" id="new-user_new_user_screen_value" name="new_user" maxlength="79" onkeyup="NewUserUserInputChange();" onpaste="NewUserUserInputChange();" oninput="NewUserUserInputChange();"/>
<p id="new-user_new_user_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>

<div class="control-group">
<label class="control-label" id="new-user_new_pass_screen" for="new-user_new_pass_screen_value"></label>
<div class="controls">
<p id="new-user_new_pass_alert" style="display: none;"></p>
<p><input type="password" class="text-input" value="" id="new-user_new_pass_screen_value" name="new_pass" maxlength="39" onkeyup="NewUserPassInputChange();" onpaste="NewUserPassInputChange();" oninput="NewUserPassInputChange();"/></p>
<p id="new-user_new_pass_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>

<div class="control-group">
<label class="control-label" id="new-user_new_pass_valid_screen" for="new-user_new_pass_valid_screen_value"></label>
<div class="controls">
<p id="new-user_new_pass_valid_alert" style="display: none;"></p>
<p><input type="password" class="text-input" value="" id="new-user_new_pass_valid_screen_value" name="new_pass_valid" maxlength="39" onkeyup="NewUserPassValidInputChange();" onpaste="NewUserPassValidInputChange();" oninput="NewUserPassValidInputChange();"/></p>
<p id="new-user_new_pass_valid_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>

<div class="control-group">
<label class="control-label" id="new-user_email_screen" for="new-user_email_screen_value"></label>
<div class="controls">
<p><input type="text" class="text-input" value="" id="new-user_email_screen_value" name="email" maxlength="79"/></p>
<p id="new-user_email_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>

<div class="form-actions"><input id="new-user_btn" class="submit_btn" type="submit" value="New"></div>
</form>

</div>  <!--End of id="new-user-page" -->

<!-- *** EXECUTE TOKEN PAGE *** -->

<div id="execute-token-page" class="white-area" style="left: 15%; top: 11px; width: 60%; height: auto; visibility: hidden;">
<h2 id="execute-token-title-text" class="white-area-title">Token</h2>
<p id="execute-token-subtitle-text"></p>
<p id="execute-token-wait-text"></p>

</div>  <!--End of id="execute-token-page" -->
</body>
</html>